{"version":3,"file":"notabug-peer.umd.js","sources":["../src/Constants.ts","../src/Schema.ts","../src/Validation.ts","../src/Config.ts","../src/Listing/ListingNode.ts","../src/GunNode.ts","../src/Thing/ThingSet.ts","../src/Thing/ThingDataNode.ts","../src/Thing/Thing.ts","../src/Query.ts","../src/Authentication.ts","../src/Tokenizer.ts","../src/Listing/ListingDefinition.ts","../src/Listing/ListingDataSource.ts","../src/Listing/ListingFilter.ts","../src/Listing/ListingSpec.ts","../src/Listing/ListingSort.ts","../src/Listing/Path.ts","../src/Listing/ListingType/TopicListing.ts","../src/Listing/ListingType/ChatListing.ts","../src/Listing/ListingType/FirehoseListing.ts","../src/Listing/ListingType/CommentedListing.ts","../src/Listing/ListingType/DomainListing.ts","../src/Listing/ListingType/CommentListing.ts","../src/Listing/SpaceSpec.ts","../src/Listing/ListingType/SpaceListing.ts","../src/Listing/ListingType/InboxListing.ts","../src/Listing/ListingType/ProfileListing.ts","../src/Listing/ListingType/index.ts","../src/Listing/ListingQuery.ts","../src/Listing/index.ts","../src/Oracle/ThingQueue.ts","../src/Oracle/Indexer.ts","../src/CommentCommand.ts","../src/Oracle/Tabulator.ts","../src/Oracle/Oracle.ts","../src/Peer.ts","../src/Page.ts","../src/notabug-peer.ts"],"sourcesContent":["const COMMAND_RE = /^ {4}~/;\nconst PREFIX = 'nab';\nconst SOUL_DELIMETER = '|~~|';\n\nconst LISTING_SIZE = 1000;\n\nconst MAX_HASH_SIZE = 64;\nconst MAX_POW_NONCE_SIZE = 64;\nconst MAX_TOPIC_SIZE = 42;\nconst MAX_AUTHOR_ALIAS_SIZE = 256;\nconst MAX_AUTHOR_ID_SIZE = 128; // ???\nconst MAX_URL_SIZE = 2048;\nconst MAX_DOMAIN_SIZE = 256;\nconst MAX_THING_KIND_SIZE = 16;\nconst MAX_THING_TITLE_SIZE = 300;\nconst MAX_THING_BODY_SIZE = 50000;\n\nconst MAX_LISTING_IDS_SIZE = 50000;\nconst MAX_LISTING_SOURCE_SIZE = 50000;\nconst MAX_LISTING_TABS_SIZE = 5000;\n\nconst MAX_LISTING_SOUL_PREFIX_SIZE = MAX_TOPIC_SIZE;\nconst MAX_LISTING_SOUL_IDENTIFIER_SIZE = MAX_AUTHOR_ID_SIZE;\nconst MAX_LISTING_SOUL_SORT_SIZE = 16;\nconst MAX_LISTING_SOUL_TYPE_SIZE = MAX_TOPIC_SIZE;\nconst MAX_LISTING_SOUL_KIND_SIZE = 16;\n\nconst CHAT_PRELOAD_ITEMS = 10;\n\nconst INDEXER =\n  'CEyKrDd1xyPXpWSV00MgvnZY2VJLHXgzCvhMeDwKTYA.yjSq0DyXzzhB_ZXr_DzfJgij3tXU0-3t0Q5bJAtZpj8';\n\nexport const Constants = {\n  COMMAND_RE,\n  PREFIX,\n  SOUL_DELIMETER,\n  LISTING_SIZE,\n  MAX_HASH_SIZE,\n  MAX_POW_NONCE_SIZE,\n  MAX_TOPIC_SIZE,\n  MAX_AUTHOR_ALIAS_SIZE,\n  MAX_AUTHOR_ID_SIZE,\n  MAX_URL_SIZE,\n  MAX_DOMAIN_SIZE,\n  MAX_THING_KIND_SIZE,\n  MAX_THING_TITLE_SIZE,\n  MAX_THING_BODY_SIZE,\n  MAX_LISTING_IDS_SIZE,\n  MAX_LISTING_SOURCE_SIZE,\n  MAX_LISTING_TABS_SIZE,\n  MAX_LISTING_SOUL_PREFIX_SIZE,\n  MAX_LISTING_SOUL_IDENTIFIER_SIZE,\n  MAX_LISTING_SOUL_SORT_SIZE,\n  MAX_LISTING_SOUL_TYPE_SIZE,\n  MAX_LISTING_SOUL_KIND_SIZE,\n  CHAT_PRELOAD_ITEMS,\n  INDEXER\n};\n","import * as R from 'ramda';\nimport Route from 'route-parser';\nimport { SchemaNodeTypeMap } from './types';\nimport { AUTH_SCHEMA } from 'gun-suppressor-sear';\nimport { Constants } from './Constants';\n\nconst definitions = {\n  ...AUTH_SCHEMA,\n  topicName: {\n    type: 'string',\n    minLength: 1,\n    maxLength: Constants.MAX_TOPIC_SIZE\n  },\n\n  TopicDay: {\n    title: 'Topic Day',\n    description: 'A single day of things in a topic',\n    soul: {\n      pattern: `${Constants.PREFIX}/topics/:topicName/days/:year/:month/:day`,\n      properties: {\n        topicName: { $ref: 'schema.json#/definitions/topicName' },\n        year: { type: 'number', minimum: 2018, maximum: 2100 },\n        month: { type: 'number', minimum: 1, maximum: 12 },\n        day: { type: 'number', minimum: 1, maximum: 31 }\n      },\n      required: ['topicName', 'year', 'month', 'day']\n    },\n    propsFromSoul: { name: 'topicName' },\n    properties: {\n      name: {\n        description: 'Deprecated as unnecessary',\n        type: 'string'\n      }\n    },\n    additionalProperties: {\n      edgeMatchesKey: true,\n      anyOf: [{ $ref: '#/definitions/ThingEdge' }, { $ref: '#/definitions/TopicEdge' }]\n    }\n  },\n\n  Topic: {\n    title: 'Topic',\n    description: 'All things in a topic',\n    soul: {\n      pattern: `${Constants.PREFIX}/topics/:topicName`,\n      properties: {\n        topicName: { $ref: 'schema.json#/definitions/topicName' }\n      },\n      required: ['topicName']\n    },\n    propsFromSoul: { name: 'topicName' },\n    properties: {\n      name: {\n        description: 'Deprecated as unnecessary',\n        type: 'string'\n      }\n    },\n    additionalProperties: {\n      edgeMatchesKey: true,\n      anyOf: [{ $ref: '#/definitions/ThingEdge' }, { $ref: '#/definitions/TopicEdge' }]\n    }\n  },\n\n  domainName: {\n    type: 'string',\n    minLength: 1,\n    maxLength: Constants.MAX_DOMAIN_SIZE\n  },\n\n  Domain: {\n    title: 'Domain',\n    description: 'All things in a domain',\n    soul: {\n      pattern: `${Constants.PREFIX}/domains/:domainName`,\n      properties: {\n        domainName: { $ref: 'schema.json#/definitions/domainName' }\n      },\n      required: ['domainName']\n    },\n    additionalProperties: {\n      edgeMatchesKey: true,\n      anyOf: [{ $ref: '#/definitions/ThingEdge' }]\n    }\n  },\n\n  url: { type: ['null', 'string'], maxLength: Constants.MAX_URL_SIZE },\n  URL: {\n    title: 'URL',\n    description: 'All things for a given URL',\n    soul: {\n      pattern: `${Constants.PREFIX}/urls/\\*url`, // eslint-disable-line no-useless-escape\n      properties: {\n        url: { $ref: 'schema.json#/definitions/url' }\n      },\n      required: ['url']\n    },\n    additionalProperties: {\n      edgeMatchesKey: true,\n      anyOf: [{ $ref: '#/definitions/ThingEdge' }]\n    }\n  },\n\n  thingId: {\n    type: 'string',\n    maxLength: Constants.MAX_HASH_SIZE\n  },\n\n  thingSoul: {\n    properties: {\n      thingId: { '#ref': '#definitions/thingId' }\n    }\n  },\n\n  ThingAllComments: {\n    title: 'Thing All Comments',\n    description: 'All comments for a given submission',\n    soul: {\n      pattern: `${Constants.PREFIX}/things/:thingId/allcomments`,\n      allOf: [{ $ref: 'schema.json#/definitions/thingSoul' }]\n    },\n    additionalProperties: {\n      edgeMatchesKey: true,\n      anyOf: [{ $ref: '#/definitions/ThingEdge' }]\n    }\n  },\n\n  ThingComments: {\n    title: 'Thing Comments',\n    description: 'Direct replies to a thing',\n    soul: {\n      pattern: `${Constants.PREFIX}/things/:thingId/comments`,\n      allOf: [{ $ref: 'schema.json#/definitions/thingSoul' }]\n    },\n    additionalProperties: {\n      edgeMatchesKey: true,\n      anyOf: [{ $ref: '#/definitions/ThingEdge' }]\n    }\n  },\n\n  timestamp: { type: ['number', 'string'] },\n  thingKind: {\n    type: 'string',\n    maxLength: Constants.MAX_THING_KIND_SIZE\n  },\n\n  Thing: {\n    title: 'Thing Reference',\n    description: 'These are submissions, comments, chat messages and wiki pages',\n    soul: {\n      pattern: `${Constants.PREFIX}/things/:thingId`,\n      allOf: [{ $ref: 'schema.json#/definitions/thingSoul' }]\n    },\n    propsFromSoul: { id: 'thingId' },\n    properties: {\n      id: { $ref: '#/definitions/thingId' },\n      kind: { '#ref': '#/definitions/thingKind' },\n      timestamp: { $ref: '#/definitions/timestamp' },\n      originalHash: { $ref: '#/definitions/thingId' },\n      data: {\n        oneOf: [\n          { $ref: '#/definitions/ThingDataEdge' },\n          { $ref: '#/definitions/ThingDataSignedEdge' }\n        ]\n      },\n      topic: {\n        anyOf: [\n          { $ref: '#/definitions/TopicEdge' },\n          {\n            description: 'Some old things had generic topic souls',\n            type: 'object',\n            additionalProperties: false,\n            properties: {\n              '#': { type: 'string', maxLength: 42 }\n            },\n            required: ['#']\n          }\n        ]\n      },\n      domain: { $ref: '#/definitions/DomainEdge' },\n      url: { $ref: '#/definitions/URLEdge' },\n      comments: { thingRelatedEdge: 'ThingComments' },\n      allcomments: { thingRelatedEdge: 'ThingAllComments' },\n      votesup: { thingRelatedEdge: 'ThingVotesUp' },\n      votesdown: { thingRelatedEdge: 'ThingVotesDown' },\n      op: { $ref: '#/definitions/ThingEdge' },\n      replyTo: { $ref: '#/definitions/ThingEdge' },\n      author: { $ref: '#/definitions/SEAAuthorEdge' }\n    },\n\n    anyOf: [\n      {\n        allOf: [\n          {\n            thingHashMatchesSoul: true\n          },\n          {\n            anyOf: [{ signedThingDataMatchesThing: true }, { thingDataMatchesOriginalHash: true }]\n          }\n        ]\n      },\n      { isLegacyThing: true },\n      {\n        additionalProperties: false,\n        description: 'Self verifying can be updated in isolation',\n        properties: {\n          id: { $ref: '#/definitions/thingId' },\n          comments: { thingRelatedEdge: 'ThingComments' },\n          allcomments: { thingRelatedEdge: 'ThingAllComments' },\n          votesup: { thingRelatedEdge: 'ThingVotesUp' },\n          votesdown: { thingRelatedEdge: 'ThingVotesDown' }\n        }\n      }\n    ]\n  },\n\n  ProofOfWorkVotes: {\n    $async: true,\n    keysAreProofsOfWork: {\n      algorithm: 'argon2d',\n      config: {\n        complexity: 6,\n        hashLength: 32,\n        timeCost: 1,\n        memoryCost: 10240,\n        parallelism: 1\n      }\n    }\n  },\n\n  ThingVotesUp: {\n    soul: {\n      pattern: `${Constants.PREFIX}/things/:thingId/votesup`,\n      allOf: [{ $ref: 'schema.json#/definitions/thingSoul' }]\n    },\n    allOf: [{ $ref: '#/definitions/ProofOfWorkVotes' }]\n  },\n\n  ThingVotesDown: {\n    soul: {\n      pattern: `${Constants.PREFIX}/things/:thingId/votesdown`,\n      allOf: [{ $ref: 'schema.json#/definitions/thingSoul' }]\n    },\n    allOf: [{ $ref: '#/definitions/ProofOfWorkVotes' }]\n  },\n\n  ThingData: {\n    title: 'Unsigned Thing Data',\n    description: 'This is the actual content of a thing',\n    soul: {\n      pattern: `${Constants.PREFIX}/things/:thingId/data`,\n      allOf: [{ $ref: 'schema.json#/definitions/thingSoul' }],\n      required: ['thingId']\n    },\n    properties: {\n      kind: { $ref: '#/definitions/thingKind' },\n      title: {\n        type: 'string',\n        minLength: 1,\n        maxLength: Constants.MAX_THING_TITLE_SIZE\n      },\n      topic: { $ref: '#/definitions/topicName' },\n      body: {\n        type: ['null', 'string'],\n        maxLength: Constants.MAX_THING_BODY_SIZE\n      },\n      author: { $ref: '#/definitions/seaAlias' },\n      authorId: { $ref: '#/definitions/seaAuthorId' },\n      opId: { $ref: '#/definitions/thingId' },\n      replyToId: { $ref: '#/definitions/thingId' },\n      domain: { $ref: '#/definitions/domainName' },\n      url: { $ref: '#/definitions/url' },\n      timestamp: { $ref: '#/definitions/timestamp' }\n    },\n    thingDataHashMatchesSoul: true\n  },\n\n  ThingDataSigned: {\n    title: 'Signed Thing Data',\n    description: 'This is the actual content of a thing, cryptographically signed',\n    soul: {\n      pattern: `${Constants.PREFIX}/things/:thingId/data~:authorId.`,\n      properties: {\n        thingId: { $ref: 'schema.json#/definitions/thingId' },\n        authorId: { $ref: 'schema.json#/definitions/seaAuthorId' }\n      },\n      required: ['thingId', 'authorId']\n    },\n    properties: {\n      kind: { sea: { $ref: 'schema.json#/definitions/thingKind' } },\n      title: {\n        sea: {\n          type: 'string',\n          minLength: 1,\n          maxLength: Constants.MAX_THING_TITLE_SIZE\n        }\n      },\n      topic: { sea: { $ref: 'schema.json#/definitions/topicName' } },\n      body: {\n        sea: {\n          type: ['null', 'string'],\n          maxLength: Constants.MAX_THING_BODY_SIZE\n        }\n      },\n      author: {\n        sea: { $ref: 'schema.json#/definitions/seaAlias' }\n      },\n      authorId: { sea: { $ref: 'schema.json#/definitions/seaAuthorId' } },\n      opId: { sea: { $ref: 'schema.json#/definitions/thingId' } },\n      replyToId: { sea: { $ref: 'schema.json#/definitions/thingId' } },\n      domain: { sea: { $ref: 'schema.json#/definitions/domainName' } },\n      url: { sea: { $ref: 'schema.json#/definitions/url' } },\n      timestamp: { sea: { $ref: 'schema.json#/definitions/timestamp' } }\n    }\n  },\n\n  ThingVoteCounts: {\n    title: 'Thing Vote Counts',\n    description: 'Aggregated counts from a tabulator',\n    soul: {\n      pattern: `${Constants.PREFIX}/things/:thingId/votecounts@~:tabulator.`,\n      properties: {\n        thingId: { $ref: 'schema.json#/definitions/thingId' },\n        tabulator: { $ref: 'schema.json#/definitions/seaAuthorId' }\n      }\n    },\n    properties: {\n      up: { sea: { type: ['number', 'string'] } },\n      down: { sea: { type: ['number', 'string'] } },\n      comment: { sea: { type: ['number', 'string'] } },\n      score: { sea: { type: ['number', 'string'] } },\n      commands: { sea: { type: ['object', 'string'] } }\n    }\n  },\n\n  ListingData: {\n    $async: true,\n    title: 'Listing Node Data',\n    description: 'Shared description of listing properties',\n    type: 'object',\n    properties: {\n      _: {\n        additionalProperties: true\n      }\n    },\n    patternProperties: {\n      '^d+$': { sea: { type: ['string', 'null', 'undefined'] } }\n    },\n\n    deleteNonNumericKeys: true,\n    deleteMetaForMissing: true\n  },\n\n  sortName: {\n    type: 'string',\n    enum: [\n      'new',\n      'old',\n      'active',\n      'top',\n      'comments',\n      'discussed',\n      'hot',\n      'best',\n      'controversial',\n      'random',\n      'firehose',\n      'chat'\n    ]\n  },\n\n  TopicListing: {\n    soul: {\n      pattern: `${Constants.PREFIX}/t/:topic/:sort@~:indexer.`,\n      required: ['topic', 'sort', 'indexer'],\n      properties: {\n        topic: { type: 'string' },\n        sort: { $ref: 'schema.json#/definitions/sortName' },\n        indexer: { $ref: 'schema.json#/definitions/seaAuthorId' }\n      }\n    },\n    allOf: [{ $ref: '#/definitions/ListingData' }]\n  },\n\n  DomainListing: {\n    soul: {\n      pattern: `${Constants.PREFIX}/domain/:domain/:sort@~:indexer.`,\n      required: ['domain', 'sort', 'indexer'],\n      properties: {\n        domain: { type: 'string' },\n        sort: { $ref: 'schema.json#/definitions/sortName' },\n        indexer: { $ref: 'schema.json#/definitions/seaAuthorId' }\n      }\n    },\n    allOf: [{ $ref: '#/definitions/ListingData' }]\n  },\n\n  ThingCommentsListing: {\n    soul: {\n      pattern: `${Constants.PREFIX}/things/:thingId/comments/:sort@~:indexer.`,\n      properties: {\n        thingId: { $ref: 'schema.json#/definitions/thingId' },\n        sort: { $ref: 'schema.json#/definitions/sortName' },\n        indexer: { $ref: 'schema.json#/definitions/seaAuthorId' }\n      }\n    },\n    allOf: [{ $ref: '#/definitions/ListingData' }]\n  },\n\n  userListingType: {\n    type: 'string',\n    enum: ['overview', 'submitted', 'comments', 'commands', 'commented']\n  },\n\n  AuthorRepliesListing: {\n    soul: {\n      pattern: `${Constants.PREFIX}/user/:authorId/replies/:type/:sort@~:indexer.`,\n      properties: {\n        authorId: { $ref: 'schema.json#/definitions/seaAuthorId' },\n        sort: { $ref: 'schema.json#/definitions/sortName' },\n        indexer: { $ref: 'schema.json#/definitions/seaAuthorId' },\n        type: { $ref: 'schema.json#/definitions/userListingType' }\n      }\n    },\n    allOf: [{ $ref: '#/definitions/ListingData' }]\n  },\n\n  AuthorProfileListing: {\n    soul: {\n      pattern: `${Constants.PREFIX}/user/:authorId/:type/:sort@~:indexer.`,\n      properties: {\n        authorId: { $ref: 'schema.json#/definitions/seaAuthorId' },\n        sort: { $ref: 'schema.json#/definitions/sortName' },\n        indexer: { $ref: 'schema.json#/definitions/seaAuthorId' },\n        type: { $ref: 'schema.json#/definitions/userListingType' }\n      }\n    },\n    allOf: [{ $ref: '#/definitions/ListingData' }]\n  },\n\n  SpaceListing: {\n    soul: {\n      pattern: `${Constants.PREFIX}/user/:authorId/spaces/:name/:sort@~:indexer.`,\n      properties: {\n        authorId: { $ref: 'schema.json#/definitions/seaAuthorId' },\n        sort: { $ref: 'schema.json#/definitions/sortName' },\n        indexer: { $ref: 'schema.json#/definitions/seaAuthorId' },\n        name: { $ref: 'schema.json#/definitions/topicName' }\n      }\n    },\n    allOf: [{ $ref: '#/definitions/ListingData' }]\n  },\n\n  AuthorComments: {\n    title: \"Author's Comments\",\n    description: 'All of an authors comments should be linked here',\n    soul: {\n      pattern: `${Constants.PREFIX}/comments~:authorId.`,\n      properties: {\n        authorId: { $ref: 'schema.json#/definitions/seaAuthorId' }\n      },\n      required: ['authorId']\n    },\n    additionalProperties: {\n      sea: {\n        edgeMatchesKey: true,\n        anyOf: [{ $ref: 'schema.json#/definitions/ThingEdge' }]\n      }\n    }\n  },\n\n  AuthorSubmissions: {\n    title: \"Author's Submissions\",\n    description: \"All of an author's submissions should be linked here\",\n    soul: {\n      pattern: `${Constants.PREFIX}/submissions~:authorId.`,\n      properties: {\n        authorId: { $ref: 'schema.json#/definitions/seaAuthorId' }\n      },\n      required: ['authorId']\n    }\n  },\n\n  AuthorThings: {\n    title: \"Author's Things\",\n    description: \"All of an author's things should be linked here\",\n    soul: {\n      pattern: `${Constants.PREFIX}/things~:authorId.`,\n      properties: {\n        authorId: { $ref: 'schema.json#/definitions/seaAuthorId' }\n      },\n      required: ['authorId']\n    },\n    additionalProperties: {\n      sea: {\n        edgeMatchesKey: true,\n        anyOf: [{ $ref: 'schema.json#/definitions/ThingEdge' }]\n      }\n    }\n  },\n\n  AuthorPages: {\n    title: 'Author Page Map',\n    description: 'Mapping of page names to things',\n    soul: {\n      pattern: `${Constants.PREFIX}/pages~:authorId.`,\n      properties: {\n        authorId: { $ref: 'schema.json#/definitions/seaAuthorId' }\n      },\n      required: ['authorId']\n    },\n    additionalProperties: {\n      sea: {\n        edgeMatchesKey: true,\n        anyOf: [{ $ref: 'schema.json#/definitions/ThingEdge' }]\n      }\n    }\n  }\n};\n\ninterface RouteMap {\n  [name: string]: any;\n}\n\nconst routes: RouteMap = R.keysIn(definitions).reduce((result: any, name: string) => {\n  const pattern = R.pathOr('', [name, 'soul', 'pattern'], definitions);\n\n  if (!pattern) return result;\n  return R.assoc(name, new Route(pattern), result);\n}, definitions);\n\nconst defsWithRoutes: SchemaNodeTypeMap = R.compose(\n  R.reduce(\n    (res, [name, route]) => R.assoc(name, R.assoc('route', route, R.prop(name, definitions)), res),\n    {}\n  ),\n  R.toPairs as (map: RouteMap) => [string, any][]\n)(routes);\n\nexport const Schema = {\n  SEAAuthor: defsWithRoutes.SEAAuthor,\n  TopicDay: defsWithRoutes.TopicDay,\n  Topic: defsWithRoutes.Topic,\n  Domain: defsWithRoutes.Domain,\n  URL: defsWithRoutes.URL,\n  ThingAllComments: defsWithRoutes.ThingAllComments,\n  ThingComments: defsWithRoutes.ThingComments,\n  Thing: defsWithRoutes.Thing,\n  ThingVotesUp: defsWithRoutes.ThingVotesUp,\n  ThingVotesDown: defsWithRoutes.ThingVotesDown,\n  ThingData: defsWithRoutes.ThingData,\n  ThingDataSigned: defsWithRoutes.ThingDataSigned,\n  ThingVoteCounts: defsWithRoutes.ThingVoteCounts,\n  TopicListing: defsWithRoutes.TopicListing,\n  DomainListing: defsWithRoutes.DomainListing,\n  ThingCommentsListing: defsWithRoutes.ThingCommentsListing,\n  AuthorRepliesListing: defsWithRoutes.AuthorRepliesListing,\n  AuthorProfileListing: defsWithRoutes.AuthorProfileListing,\n  SpaceListing: defsWithRoutes.SpaceListing,\n  AuthorComments: defsWithRoutes.AuthorComments,\n  AuthorSubmissions: defsWithRoutes.AuthorSubmissions,\n  AuthorThings: defsWithRoutes.AuthorThings,\n  AuthorPages: defsWithRoutes.AuthorPages,\n  definitions,\n  routes\n};\n","import * as R from 'ramda';\nimport objHash from 'object-hash';\nimport { createSuppressor } from 'gun-suppressor';\nimport * as sea from 'gun-suppressor-sear';\nimport { NabProtocolMsg, GunNodeType, SchemaNodeType, ThingDataNodeType } from './types';\nimport { Schema } from './Schema';\n\nconst isLegacyThing = (_schema: any, data: GunNodeType) => {\n  const dataSoul = R.pathOr('', ['data', '#'], data);\n  const newest = R.without(\n    ['comments', 'allcomments', 'votesup', 'votesdown'],\n    R.keys(R.path(['_', '>'], data))\n  )\n    .map(key => R.path(['_', '>', key], data))\n    .sort()\n    .pop();\n  const thingId = R.propOr('', 'thingId', Schema.ThingData.route.match(dataSoul));\n  const id = R.prop('id', data);\n\n  return id && id === thingId && newest && newest < 1543102814945;\n};\n\nconst thingHashMatchesSoul = (_schema: any, data: GunNodeType) => {\n  const id = R.prop('id', data);\n\n  return (\n    id &&\n    id ===\n      objHash({\n        authorId: (R.pathOr('', ['author', '#'], data) || '').substr(1) || undefined,\n        timestamp: parseInt(R.prop('timestamp', data), 10),\n        kind: R.prop('kind', data),\n        topic: R.propOr(\n          undefined,\n          'topicName',\n          Schema.Topic.route.match(R.pathOr('', ['topic', '#'], data))\n        ),\n        opId: R.propOr(\n          undefined,\n          'thingId',\n          Schema.Thing.route.match(R.pathOr('', ['op', '#'], data))\n        ),\n        replyToId: R.propOr(\n          undefined,\n          'thingId',\n          Schema.Thing.route.match(R.pathOr('', ['replyTo', '#'], data))\n        ),\n        originalHash: R.prop('originalHash', data)\n      })\n  );\n};\n\nconst signedThingDataMatches = (_schema: any, data: GunNodeType) => {\n  const authorId = (R.pathOr('', ['author', '#'], data) || '').substr(1) || undefined;\n  const signedId = R.propOr(\n    '',\n    'authorId',\n    Schema.ThingDataSigned.route.match(R.pathOr('', ['data', '#'], data))\n  );\n\n  return authorId && authorId === signedId;\n};\n\nconst thingDataMatchesOriginalHash = (_schema: any, data: GunNodeType) => {\n  const originalHash = R.prop('originalHash', data);\n  const id = R.propOr(\n    '',\n    'thingId',\n    Schema.ThingData.route.match(R.pathOr('', ['data', '#'], data))\n  );\n\n  return id && id === originalHash;\n};\n\nconst getIsThingRelatedEdge = (ajv: any) => (\n  nodeTypeName: string,\n  data: any,\n  _pSchema: any,\n  _cPath: any,\n  parentData: any\n) => {\n  const thingId = R.propOr(\n    '',\n    'thingId',\n    Schema.Thing.route.match(R.path(['_', '#'], parentData) || '')\n  );\n  const NodeType: SchemaNodeType = R.propOr(null, nodeTypeName, Schema);\n  const propThingId = R.propOr('', 'thingId', NodeType.route.match(R.propOr('', '#', data)));\n\n  if (!thingId || thingId !== propThingId) return false;\n  return ajv.compile({ $ref: `schema.json#/definitions/${nodeTypeName}Edge` })(data);\n};\n\nconst thingDataHashMatches = (_schema: any, data: any) => {\n  const record: ThingDataNodeType = R.dissoc('_', data);\n\n  record.timestamp = parseFloat(record.timestamp as string);\n  const thingId = R.propOr(\n    '',\n    'thingId',\n    Schema.ThingData.route.match(R.path(['_', '#'], data) || '')\n  );\n  return thingId && thingId === objHash(record);\n};\n\nconst isVoteValid = (argon2: any, schema: any, prefix: string, vote: string) => {\n  const { algorithm = 'argon2d', config = {} } = schema || {};\n\n  // const nonce = Buffer.hasOwnProperty('from') ? Buffer.from(vote, 'hex') : new Buffer(vote, 'hex');\n  const nonce = Buffer.from(vote, 'hex');\n  // const salt = Buffer.hasOwnProperty('from') ? Buffer.from(nonce, 'hex') : new Buffer(nonce, 'hex');\n  const salt = nonce;\n\n  const hash = argon2.hash(prefix, {\n    salt,\n    hashLength: config.hashLength,\n    timeCost: config.timeCost,\n    memoryCost: config.memoryCost,\n    parallelism: config.parallelism,\n    raw: true,\n    type: argon2[algorithm]\n  });\n  let off = 0;\n  let i;\n\n  for (i = 0; i <= config.complexity - 8; i += 8, off++) {\n    if (hash[off] !== 0) return false;\n  }\n  const mask = 0xff << (8 + i - config.complexity);\n\n  return (hash[off] & mask) === 0;\n};\n\nconst keysAreProofsOfWork = (schema: any, data: any) => {\n  const argon2 = require('argon2');\n\n  if (!argon2) return true; // in browser don't bother for now\n  const { algorithm = 'argon2d' } = schema || {};\n  const prefix = R.pathOr('', ['_', '#'], data);\n\n  if (algorithm !== 'argon2d') {\n    throw new Error('Only argon2 supported for vote hashes');\n  }\n\n  R.without(['_'], R.keysIn(data)).forEach(vote => {\n    if (!isVoteValid(argon2, schema, prefix, vote)) {\n      console.log('invalid vote', prefix, vote);\n      delete data[vote];\n    }\n  });\n  return true;\n};\n\nconst deleteNonNumericKeys = (schema: any, data: any) => {\n  const keys = R.without(['_'], R.keysIn(data));\n  const meta = R.pathOr({}, ['_', '>'], data);\n\n  keys.forEach(key => {\n    const val = parseInt(key, 10);\n\n    if (!val && val !== 0) {\n      delete meta[key];\n      delete data[key];\n    }\n  });\n  return true;\n};\n\nconst deleteMetaForMissing = (schema: any, data: any) => {\n  const keys = R.without(['_'], R.keysIn(data));\n  const meta = R.pathOr({}, ['_', '>'], data);\n  const metaKeys = R.keysIn(meta);\n  const missing = R.difference(metaKeys, keys);\n\n  if (missing.length) data['_']['>'] = R.omit(missing, meta);\n  return true;\n};\n\nconst initAjv = R.compose(\n  (ajv: any) => {\n    ajv.addKeyword('isLegacyThing', {\n      validate: isLegacyThing\n    });\n    ajv.addKeyword('thingHashMatchesSoul', {\n      validate: thingHashMatchesSoul\n    });\n    ajv.addKeyword('signedThingDataMatchesThing', {\n      validate: signedThingDataMatches\n    });\n    ajv.addKeyword('thingDataMatchesOriginalHash', {\n      validate: thingDataMatchesOriginalHash\n    });\n    ajv.addKeyword('thingRelatedEdge', {\n      validate: getIsThingRelatedEdge(ajv)\n    });\n    ajv.addKeyword('thingDataHashMatchesSoul', {\n      validate: thingDataHashMatches\n    });\n    ajv.addKeyword('keysAreProofsOfWork', {\n      validate: keysAreProofsOfWork,\n      modifying: true\n    });\n    ajv.addKeyword('deleteNonNumericKeys', {\n      validate: deleteNonNumericKeys,\n      modifying: true\n    });\n    ajv.addKeyword('deleteMetaForMissing', {\n      validate: deleteMetaForMissing,\n      modifying: true\n    });\n    return ajv;\n  },\n  sea.initAjv\n);\n\nexport const suppressor = createSuppressor({\n  definitions: Schema.definitions,\n  init: initAjv\n});\n\nconst gunWireInput = R.curry((peer, context) =>\n  context.on('in', function wireInput(this: any, msg: NabProtocolMsg) {\n    const _ = msg['_'];\n\n    delete msg['_'];\n    if ('ping' in msg || 'leech' in msg) return;\n    if (msg.put && !R.keys(msg.put).length) return;\n    const promise = peer.config.disableValidation ? Promise.resolve(msg) : suppressor.validate(msg);\n\n    promise\n      .then((validated: boolean) => {\n        if (!validated) return console.log(\"msg didn't validate\", msg);\n        msg['_'] = _;\n        return this.to.next(msg);\n      })\n      .catch((err: Error) => console.error('validate err', msg, err.stack || err));\n  })\n);\n\nexport const Validation = {\n  isLegacyThing,\n  thingHashMatchesSoul,\n  signedThingDataMatches,\n  thingDataMatchesOriginalHash,\n  getIsThingRelatedEdge,\n  thingDataHashMatches,\n  isVoteValid,\n  keysAreProofsOfWork,\n  initAjv,\n  suppressor,\n  gunWireInput\n};\n","import * as R from 'ramda';\nimport { Constants } from './Constants';\n\ntype UpdateFunction = (updates: any) => void;\ninterface ConfigType {\n  [idx: string]: string | number | UpdateFunction;\n  tabulator: string;\n  indexer: string;\n  owner: string;\n  oracleMaxStaleness: number;\n  update: UpdateFunction;\n}\n\nexport const Config: ConfigType = {\n  tabulator: Constants.INDEXER,\n  indexer: Constants.INDEXER,\n  owner: Constants.INDEXER,\n  oracleMaxStaleness: 1000 * 60 * 60,\n  update: R.compose(\n    R.map(([key, val]: [string, string]) => (Config[key] = val)),\n    R.toPairs\n  )\n};\n","import * as R from 'ramda';\nimport { query, resolve } from 'gun-scope';\nimport { Constants } from '../Constants';\nimport { Config } from '../Config';\nimport { Schema } from '../Schema';\nimport { ListingNodeRow, ListingNodeType, SortDataRow, GunScope } from '../types';\n\nconst [POS_IDX, POS_ID, POS_VAL] = [0, 1, 2, 3];\n\nconst rowsToIds = (rows: ListingNodeRow[]) =>\n  rows.map(row => ((row && row[POS_ID]) || '') as string).filter(id => !!id);\nconst rowsToItems = R.map<ListingNodeRow, SortDataRow>((R.slice(1, 3) as unknown) as (\n  row: ListingNodeRow\n) => SortDataRow);\nconst source = R.propOr('', 'source');\nconst soulFromPath = R.curry((indexer, path) => `${Constants.PREFIX}${path}@~${indexer}.`);\nconst pathFromSoul = R.compose(\n  R.replace(new RegExp(`^${Constants.PREFIX}`), ''),\n  R.replace(/@~.*\\./, '')\n);\n\nconst idToSoul = (thingId: string) => Schema.Thing.route.reverse({ thingId }) || '';\nconst idsToSouls = (ids: string[]) => ids.map(idToSoul).filter(id => !!id);\nconst soulToId = (soul: string) => R.propOr('', 'thingId', Schema.Thing.route.match(soul));\nconst soulsToIds = R.map(soulToId);\n\nfunction getRow(node: ListingNodeType, idx: string | number) {\n  const row: (string | number)[] = R.split(',', R.propOr('', `${idx}`, node));\n  row[0] = ((row[0] as string) || '').trim();\n  row[1] = parseFloat(row[1] as string);\n  row.splice(0, 0, parseInt(idx as string, 10));\n  return row as ListingNodeRow;\n}\n\nconst itemKeys = R.compose(\n  R.filter(\n    R.compose(\n      val => !!(val === 0 || val),\n      (val: string) => parseInt(val, 10)\n    )\n  ) as (keys: string[]) => string[],\n  R.keysIn as (node: ListingNodeType) => string[]\n);\n\nfunction rows(node: ListingNodeType): ListingNodeRow[] {\n  const keys = R.keysIn(node);\n  const result: ListingNodeRow[] = [];\n\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i];\n    const keyVal = parseInt(key, 10);\n    if (!keyVal && keyVal !== 0) continue;\n    result.push(getRow(node, key));\n  }\n\n  return result;\n}\n\nconst ids = R.compose(\n  rowsToIds,\n  rows\n);\n\nconst sortRows = R.sortWith([\n  R.ascend(\n    R.compose(\n      R.cond([[R.isNil, R.always(Infinity)], [R.T, parseFloat]]),\n      R.nth(POS_VAL)\n    )\n  )\n]) as (rows: ListingNodeRow[]) => ListingNodeRow[];\n\nconst sortedIds = R.compose(\n  R.map(R.nth(POS_ID) as (row: ListingNodeRow) => string | undefined),\n  sortRows,\n  R.filter(R.identity as (T: ListingNodeRow) => boolean) as (\n    rows: ListingNodeRow[]\n  ) => ListingNodeRow[],\n  rows\n);\n\nconst mapSortData = (R.addIndex(R.map) as unknown) as (\n  fn: (r: SortDataRow, i: number) => ListingNodeRow\n) => (data: SortDataRow[]) => ListingNodeRow[];\nconst itemsToRows = mapSortData(\n  (item: SortDataRow, idx: number): ListingNodeRow => [idx, item[0], item[1]]\n);\n\nasync function diffSingle(\n  node: ListingNodeType,\n  updatedItem: SortDataRow,\n  { maxSize = 1000 } = {}\n) {\n  let highestKey = -1;\n  let highestValueKey = null;\n  let highestValue = null;\n  let key: string;\n  const [updateId, updateValue] = updatedItem;\n\n  for (key in node || {}) {\n    const parsed = parseInt(key, 10);\n\n    if (!(parsed || parsed === 0)) continue;\n\n    const row: ListingNodeRow = getRow(node, key);\n    const [idx, id = null, value] = row;\n    if (id === updateId) {\n      if (updateValue === value) return null;\n      return { [`${idx}`]: updatedItem.join(',') };\n    }\n\n    if (highestValue === null || (value !== null && value > highestValue)) {\n      highestValue = value;\n      highestValueKey = idx;\n    }\n    if (idx !== null && idx > highestKey) highestKey = idx;\n  }\n\n  if (!maxSize || highestKey + 1 < maxSize) {\n    return { [`${highestKey + 1}`]: updatedItem.join(',') };\n  }\n\n  if (highestValue === null || updateValue < highestValue) {\n    return { [`${highestValueKey}`]: updatedItem.join(',') };\n  }\n\n  return null;\n}\n\nasync function diff(\n  node: ListingNodeType,\n  updatedItems: SortDataRow[] = [],\n  removeIds: string[] = [],\n  { maxSize = 1000 } = {}\n) {\n  if (updatedItems.length === 1 && !removeIds.length) {\n    return diffSingle(node, updatedItems[0], { maxSize });\n  }\n  const removed = R.indexBy(R.identity, removeIds);\n  const byId = {} as { [id: string]: ListingNodeRow };\n  const changes: ListingNodeType = {};\n  const rows: ListingNodeRow[] = [];\n  const updated = {} as { [id: string]: boolean };\n  let toReplace = [];\n  let maxIdx = 0;\n  let key;\n\n  for (key in node || {}) {\n    const parsed = parseInt(key, 10);\n\n    if (!(parsed || parsed === 0)) continue;\n    const row: ListingNodeRow = getRow(node, key);\n    const [idx, id = null, rawValue = null] = row;\n    row[POS_VAL] = rawValue === null ? null : rawValue;\n    if (id && removed[id]) row[POS_ID] = row[POS_VAL] = null;\n    if (id) byId[id] = row;\n    if (row[POS_ID]) {\n      rows.push(row);\n    } else {\n      toReplace.push(row);\n    }\n    if (idx && idx > maxIdx) maxIdx = idx;\n  }\n\n  for (let i = 0; i < updatedItems.length; i++) {\n    const [id, value] = updatedItems[i] || [null, null];\n\n    if (!id) continue;\n    const existing = byId[id];\n\n    if (existing) {\n      if (existing[POS_VAL] !== value) {\n        existing[POS_VAL] = value;\n        updated[id] = true;\n      }\n    } else {\n      const row: ListingNodeRow = [null, id, value];\n\n      rows.push(row);\n    }\n  }\n\n  const allSorted = sortRows(rows);\n  const sorted = maxSize ? allSorted.slice(0, maxSize) : allSorted;\n  const missing = maxSize ? allSorted.slice(maxSize, allSorted.length) : [];\n  const added = R.filter(row => row[POS_IDX] === null, sorted);\n\n  toReplace = toReplace.concat(R.filter(row => row[POS_IDX] !== null, missing)).reverse();\n\n  for (let i = 0; i < sorted.length; i++) {\n    const id = sorted[i][POS_ID];\n    const idx = sorted[i][POS_IDX];\n    const val = sorted[i][POS_VAL];\n\n    if (idx !== null && updated[id || '']) changes[`${idx}`] = [id, val].join(',');\n  }\n\n  const inserted = [];\n\n  while (added.length) {\n    const row = added.pop();\n    const replaced = toReplace.pop();\n    let [idx] = replaced || [null];\n\n    if (idx === null) {\n      idx = maxIdx + inserted.length + 1;\n      inserted.push(idx);\n    }\n\n    if (row) changes[`${idx}`] = [row[POS_ID], row[POS_VAL]].join(',');\n  }\n\n  while (toReplace.length) {\n    const row = toReplace.pop();\n\n    if (row && !row[POS_ID]) {\n      const idx = `${row[POS_IDX]}`;\n\n      if (node[idx] !== null) {\n        changes[idx] = null;\n        console.log('nulling', idx, node[idx]);\n      }\n    }\n  }\n\n  return R.keys(changes).length ? changes : null;\n}\n\nconst unionRows = R.compose(\n  R.uniqBy(R.nth(POS_ID)),\n  sortRows,\n  R.reduce(\n    R.concat as (a: ListingNodeRow[], b: ListingNodeRow[]) => ListingNodeRow[],\n    [] as ListingNodeRow[]\n  ),\n  R.map(rows)\n);\n\nconst rowsFromSouls = query<ListingNodeRow[]>((scope: GunScope, souls: string[]) =>\n  Promise.all(R.map(scope.get, souls)).then(unionRows)\n);\n\nconst read = query((scope: GunScope, path: string, opts: { indexer?: string }) => {\n  const { indexer = Config.indexer } = opts || {};\n\n  return rowsFromSouls(scope, [soulFromPath(indexer, path)]).then(rowsToIds);\n}, 'listingRows');\n\nconst get = query(\n  (scope: GunScope, soul: string) => (soul ? scope.get(soul).then() : resolve(null)),\n  'listing'\n);\n\nexport const ListingNode = {\n  POS_IDX,\n  POS_ID,\n  POS_VAL,\n  source,\n  get,\n  getRow,\n  itemKeys,\n  rows,\n  ids,\n  idToSoul,\n  idsToSouls,\n  soulToId,\n  soulsToIds,\n  rowsToIds,\n  rowsToItems,\n  itemsToRows,\n  sortRows,\n  sortedIds,\n  soulFromPath,\n  pathFromSoul,\n  rowsFromSouls,\n  read,\n  diff,\n  unionRows\n};\n","/* globals Gun */\nimport * as R from 'ramda';\nimport { GunNodeType } from './types';\n\ndeclare const Gun: any;\n\nconst soul = R.pathOr('', ['_', '#']) as (node: GunNodeType) => string;\nconst state = R.pathOr({}, ['_', '>']) as (node: GunNodeType) => { [key: string]: number };\n\nconst latest = R.compose(\n  R.last as (res: number[]) => number,\n  R.sortBy(R.identity),\n  R.values as (state: any) => number[],\n  state\n);\n\nconst edges = R.compose(\n  R.map(R.propOr('', '#')),\n  R.values\n);\n\nconst diff = (existing: GunNodeType, updated: GunNodeType) => {\n  const changedKeys = R.without(['_'], R.keysIn(updated)).filter(k => {\n    const newVal = updated[k];\n    const oldVal = R.prop(k, existing);\n\n    return !R.equals(newVal, oldVal) && `${newVal}` !== `${oldVal}`;\n  });\n\n  return R.pick(changedKeys, updated);\n};\n\nfunction decodeSEA(rawData: GunNodeType) {\n  const data = rawData ? { ...rawData } : rawData;\n  const soul = R.pathOr('', ['_', '#'], data);\n\n  if (!soul || !Gun.SEA || soul.indexOf('~') === -1) return rawData;\n  R.without(['_'], R.keys(data)).forEach(key => {\n    Gun.SEA.verify(\n      Gun.SEA.opt.pack(rawData[key], key, rawData, soul),\n      false,\n      (res: any) => (data[key] = Gun.SEA.opt.unpack(res, key, rawData))\n    );\n  });\n  return data;\n}\n\nexport const GunNode = { soul, state, diff, latest, edges, decodeSEA };\n","import * as R from 'ramda';\nimport { Schema } from '../Schema';\nimport { GunNode } from '../GunNode';\nimport { GunNodeType } from '../types';\n\nconst souls = GunNode.edges;\nconst ids = R.compose(\n  R.filter(R.identity as (i: any) => boolean) as (i: string[]) => string[],\n  R.map<any, string>(\n    R.compose(\n      R.prop('thingId') as (i: any) => string,\n      Schema.Thing.route.match.bind(Schema.Thing.route)\n    )\n  ),\n  GunNode.edges\n);\n\nconst union = R.compose(\n  R.dissoc('_'),\n  R.reduce(R.mergeRight, {})\n) as (nodes: GunNodeType[]) => GunNodeType;\n\nfunction dayStr(timestamp: number | null | undefined) {\n  const d = new Date(timestamp || new Date().getTime());\n  const year = d.getUTCFullYear();\n  const month = d.getUTCMonth() + 1;\n  const dayNum = d.getUTCDate();\n\n  return `${year}/${month}/${dayNum}`;\n}\n\nexport const ThingSet = { ids, union, souls, dayStr };\n","import * as R from 'ramda';\nimport { parse as parseURI } from 'uri-js';\nimport { GunNodeType } from '../types';\nimport { Constants } from '../Constants';\n\nconst kind = R.propOr('submission', 'kind');\nconst body = R.propOr('', 'body');\nconst isCommand = R.compose(\n  R.test(Constants.COMMAND_RE),\n  body\n);\nconst url = R.propOr('', 'url');\nconst topic = R.propOr('', 'topic') as (node: GunNodeType) => string;\nconst domain = R.compose(\n  urlStr => {\n    if (!urlStr) return '';\n    const parsed = parseURI(urlStr);\n\n    return (parsed.host || parsed.scheme || '').replace(/^www\\./, '');\n  },\n  url as (node: GunNodeType) => string\n);\nconst authorId = R.propOr('', 'authorId');\nconst opId = R.propOr('', 'opId');\nconst replyToId = R.propOr('', 'replyToId');\n\nexport const ThingDataNode = {\n  kind,\n  body,\n  isCommand,\n  url,\n  topic,\n  domain,\n  authorId,\n  opId,\n  replyToId\n};\n","import * as R from 'ramda';\nimport { Promise } from 'gun-scope';\nimport objHash from 'object-hash';\nimport { parse as parseURI } from 'uri-js';\nimport { Schema } from '../Schema';\nimport { ThingSet } from './ThingSet';\nimport { ThingDataNodeType, ThingNode, GunChain } from '../types';\n\nexport { ThingSet } from './ThingSet';\nexport { ThingDataNode } from './ThingDataNode';\n\nconst topicPrefixes = {\n  chatmsg: 'chat:',\n  comment: 'comments:'\n};\n\nconst soulToId = R.compose(\n  R.propOr('', 'thingId'),\n  Schema.Thing.route.match.bind(Schema.Thing.route)\n);\n\nconst soulsToIds = R.map(soulToId);\n\nconst index = R.curry((peer, thingId, data) => {\n  if (!data.topic && !data.opId) return;\n\n  if (data.opId && !data.topic) {\n    peer.gun\n      .get(Schema.Thing.route.reverse({ thingId: data.opId }))\n      .get('data')\n      .on(function recv(this: GunChain, td: ThingDataNodeType) {\n        if (!td) return;\n        index(peer, thingId, { ...data, topic: td.topic || 'all' });\n        this.off();\n      });\n    return;\n  }\n\n  const thing = peer.gun.get(Schema.Thing.route.reverse({ thingId }));\n  const dayStr = ThingSet.dayStr(data.timestamp);\n  const [year, month, day] = dayStr.split('/');\n  const topicPrefix = R.propOr('', data.kind || '', topicPrefixes);\n  const baseTopicName = data.topic.toLowerCase().trim();\n  const topicName = topicPrefix + baseTopicName;\n  const topic = peer.gun.get(Schema.Topic.route.reverse({ topicName }));\n  const topicDay = peer.gun.get(Schema.TopicDay.route.reverse({ topicName, year, month, day }));\n\n  if (!data.skipAll && data.topic !== 'all') {\n    const allname = `${topicPrefix}all`;\n    const allTopic = peer.gun.get(Schema.Topic.route.reverse({ topicName: allname }));\n    const allTopicDay = peer.gun.get(\n      Schema.TopicDay.route.reverse({\n        topicName: allname,\n        year,\n        month,\n        day\n      })\n    );\n\n    allTopic.set(thing);\n    allTopicDay.set(thing);\n  }\n\n  if (data.kind === 'submission') {\n    const urlInfo = data.url ? parseURI(data.url) : {};\n    const domainName = (data.url\n      ? (urlInfo.host || urlInfo.scheme || '').replace(/^www\\./, '')\n      : `self.${data.topic}`\n    ).toLowerCase();\n    const domain = peer.gun.get(Schema.Domain.route.reverse({ domainName }));\n\n    domain.set(thing);\n\n    if (data.url) {\n      const urlNode = peer.gun.get(Schema.URL.route.reverse({ url: data.url }));\n\n      // thing.get(\"url\").put(urlNode);\n      urlNode.set(thing);\n    }\n  }\n\n  if (data.opId) {\n    const allcomments = peer.gun.get(Schema.ThingAllComments.route.reverse({ thingId: data.opId }));\n\n    allcomments.set(thing);\n  }\n\n  if (data.replyToId || data.opId) {\n    const comments = peer.gun.get(\n      Schema.ThingComments.route.reverse({\n        thingId: data.replyToId || data.opId\n      })\n    );\n\n    comments.set(thing);\n  }\n\n  topic.set(thing);\n  topicDay.set(thing);\n});\n\nconst put = R.curry((peer, data) => {\n  data.timestamp = data.timestamp || new Date().getTime(); // eslint-disable-line\n  const originalHash = objHash(data);\n  const { timestamp, kind, topic, authorId, opId, replyToId } = data;\n  const thingId = objHash({\n    timestamp,\n    kind,\n    topic,\n    authorId,\n    opId,\n    replyToId,\n    originalHash\n  });\n\n  const node = peer.gun.get(Schema.Thing.route.reverse({ thingId }));\n  const dataSoul = authorId\n    ? Schema.ThingDataSigned.route.reverse({ thingId, authorId })\n    : Schema.ThingData.route.reverse({ thingId: originalHash });\n\n  const metaData: ThingNode = {\n    id: thingId,\n    timestamp,\n    kind,\n    originalHash,\n    data: { '#': dataSoul as string },\n    votesup: { '#': Schema.ThingVotesUp.route.reverse({ thingId }) as string },\n    votesdown: { '#': Schema.ThingVotesDown.route.reverse({ thingId }) as string },\n    allcomments: { '#': Schema.ThingAllComments.route.reverse({ thingId }) as string },\n    comments: { '#': Schema.ThingComments.route.reverse({ thingId }) as string }\n  };\n\n  if (topic) metaData.topic = { '#': Schema.Topic.route.reverse({ topicName: topic }) as string };\n  if (authorId) metaData.author = { '#': `~${authorId}` };\n  if (opId) metaData.op = { '#': Schema.Thing.route.reverse({ thingId: opId }) as string };\n  if (replyToId) {\n    metaData.replyTo = {\n      '#': Schema.Thing.route.reverse({ thingId: replyToId }) as string\n    };\n  }\n  peer.gun.get(dataSoul).put(data);\n  node.put(metaData);\n  index(peer, thingId, data);\n  return node;\n});\n\nconst submit = R.curry((peer, data) => {\n  const timestamp = data.timestamp || new Date().getTime();\n  const user = peer.isLoggedIn();\n\n  if (data.topic) data.topic = data.topic.toLowerCase().trim(); // eslint-disable-line\n  if (data.domain) data.domain = data.domain.toLowerCase().trim(); // eslint-disable-line\n  if (user) {\n    data.author = user.alias; // eslint-disable-line\n    data.authorId = user.pub; // eslint-disable-line\n  }\n\n  const thing = put(peer, { ...data, timestamp, kind: 'submission' });\n\n  if (user) {\n    const thingsSoul = Schema.AuthorThings.route.reverse({\n      authorId: user.pub\n    });\n    const submissionsSoul = Schema.AuthorSubmissions.route.reverse({\n      authorId: user.pub\n    });\n    const things = peer.gun.get(thingsSoul);\n    const submissions = peer.gun.get(submissionsSoul);\n\n    peer.gun\n      .user()\n      .get('things')\n      .put(things);\n    peer.gun\n      .user()\n      .get('submissions')\n      .put(submissions);\n    things.set(thing);\n    submissions.set(thing);\n  }\n\n  return thing;\n});\n\nconst comment = R.curry((peer, data) => {\n  const user = peer.isLoggedIn();\n\n  if (data.topic) data.topic = data.topic.toLowerCase().trim(); // eslint-disable-line\n  if (user) {\n    data.author = user.alias; // eslint-disable-line\n    data.authorId = user.pub; // eslint-disable-line\n  }\n\n  const thing = put(peer, { ...data, kind: 'comment' });\n\n  if (user) {\n    const thingsSoul = Schema.AuthorThings.route.reverse({\n      authorId: user.pub\n    });\n    const commentsSoul = Schema.AuthorComments.route.reverse({\n      authorId: user.pub\n    });\n    const things = peer.gun.get(thingsSoul);\n    const comments = peer.gun.get(commentsSoul);\n\n    peer.gun\n      .user()\n      .get('things')()\n      .put(things);\n    peer.gun\n      .user()\n      .get('comments')\n      .put(comments);\n    things.set(thing);\n    comments.set(thing);\n  }\n\n  return thing;\n});\n\nconst chat = R.curry((peer, data) => {\n  const user = peer.isLoggedIn();\n\n  if (data.topic) data.topic = data.topic.toLowerCase().trim(); // eslint-disable-line\n  if (user) {\n    data.author = user.alias; // eslint-disable-line\n    data.authorId = user.pub; // eslint-disable-line\n  }\n\n  const thing = put(peer, { ...data, kind: 'chatmsg' });\n\n  if (user) {\n    const thingsSoul = Schema.AuthorThings.route.reverse({\n      authorId: user.pub\n    });\n    const things = peer.gun.get(thingsSoul);\n\n    peer.gun\n      .user()\n      .get('things')\n      .put(things);\n    things.set(thing);\n  }\n\n  return thing;\n});\n\nconst writePage = R.curry((peer, name, body) => {\n  const user = peer.isLoggedIn();\n\n  if (!user) return Promise.reject('not logged in');\n  let thing;\n  const pagesSoul = Schema.AuthorPages.route.reverse({ authorId: user.pub });\n  const chain = peer.gun.get(pagesSoul).get(name);\n\n  return chain.then((res: ThingNode) => {\n    if (res && res.data) {\n      chain\n        .get('data')\n        .get('body')\n        .put(body);\n    } else {\n      const data = {\n        body,\n        title: name,\n        kind: 'wikipage',\n        author: user.alias,\n        authorId: user.pub\n      };\n\n      thing = put(peer, data);\n      chain.put(thing);\n    }\n  });\n});\n\nconst vote = R.curry((peer, id, kind, nonce) => {\n  const votes = peer.gun.get(\n    Schema[kind === 'up' ? 'ThingVotesUp' : 'ThingVotesDown'].route.reverse({\n      thingId: id\n    })\n  );\n\n  return votes.get(nonce).put('1');\n});\n\nexport const Thing = {\n  soulToId,\n  soulsToIds,\n  put,\n  submit,\n  comment,\n  chat,\n  writePage,\n  vote,\n  index\n};\n","import * as R from 'ramda';\nimport { scope as makeScope, query, all, resolve } from 'gun-scope';\nimport { Config } from './Config';\nimport { Schema } from './Schema';\nimport { ListingNode } from './Listing/ListingNode';\nimport {\n  CombinedThingType,\n  ThingNode,\n  GunScope,\n  GunNodeType,\n  ThingDataNodeType,\n  ThingDataMap\n} from './types';\nimport { ThingDataNode } from './Thing';\n\nconst thing = query<CombinedThingType | null>((scope, thingSoul) =>\n  scope.get(thingSoul).then((meta: ThingNode) => {\n    if (!meta || !meta.id) return null;\n    const result: CombinedThingType = {\n      id: meta.id,\n      timestamp: parseFloat(meta.timestamp as string)\n    };\n    const replyToSoul: string = R.pathOr('', ['replyTo', '#'], meta);\n    const opSoul: string = R.pathOr('', ['op', '#'], meta);\n    const opId: string = R.propOr('', 'thingId', opSoul && Schema.Thing.route.match(opSoul));\n    const replyToId: string = R.propOr(\n      '',\n      'thingId',\n      replyToSoul && Schema.Thing.route.match(replyToSoul)\n    );\n\n    if (opId) result.opId = opId;\n    if (replyToId) result.replyToId = replyToId;\n    return result;\n  })\n);\n\nconst thingDataFromSouls = R.curry((scope: GunScope, souls: string[] | null) => {\n  const ids = ListingNode.soulsToIds(souls || []);\n\n  return all<[string, ThingDataNodeType][]>(\n    R.map(id => thingData(scope, id).then(data => [id, data]), ids)\n  ).then((pairs: [string, ThingDataNodeType][]) =>\n    pairs.reduce((res, [id, data]) => R.assoc(id, data, res), {} as ThingDataMap)\n  );\n});\n\nconst thingScores = query((scope, thingId, tabulator = '') => {\n  if (!thingId) return resolve(null);\n  return scope\n    .get(\n      Schema.ThingVoteCounts.route.reverse({\n        thingId,\n        tabulator: tabulator || Config.tabulator\n      })\n    )\n    .then();\n});\n\nconst thingData = query<ThingDataNodeType | null>((scope, thingId) => {\n  return thingId ? scope.get(Schema.Thing.route.reverse({ thingId })).get('data') : resolve(null);\n});\n\nconst thingMeta = query<CombinedThingType | null>(\n  (scope, { thingSoul, tabulator, data = false, scores = false }) => {\n    if (!thingSoul) return resolve(null);\n    const id = ListingNode.soulToId(thingSoul);\n\n    return all<[CombinedThingType, GunNodeType, GunNodeType]>([\n      thing(scope, thingSoul),\n      scores ? thingScores(scope, id, tabulator) : resolve(null),\n      data ? thingData(scope, id) : resolve(null)\n    ]).then(([meta, votes, data]) => {\n      if (!meta || !meta.id) return null;\n      return { ...meta, votes, data };\n    });\n  }\n);\n\nconst thingForDisplay = query(\n  (scope, thingId, tabulator = null) =>\n    Promise.all([thingData(scope, thingId), thingScores(scope, thingId, tabulator)]).then(\n      ([data, scores]) => {\n        const opId = ThingDataNode.opId(data);\n        if (!opId) return { data, scores };\n        return thingData(scope, opId).then(opData => ({\n          data,\n          scores,\n          opData\n        }));\n      }\n    ),\n  'thing'\n);\n\nconst multiThingMeta = query((scope, params) =>\n  all(\n    R.reduce(\n      (promises, thingSoul) => {\n        if (!thingSoul) return promises;\n        promises.push(thingMeta(scope, { ...params, thingSoul }));\n        return promises;\n      },\n      [] as PromiseLike<CombinedThingType | null>[],\n      R.propOr([], 'thingSouls', params)\n    )\n  )\n);\n\nconst userPages = query(\n  (scope, authorId) => scope.get(Schema.AuthorPages.route.reverse({ authorId })),\n  'userPages'\n);\n\nconst wikiPageId = query((scope, authorId, name) => {\n  if (!authorId || !name) return resolve(null);\n  return scope\n    .get(Schema.AuthorPages.route.reverse({ authorId }))\n    .get(name)\n    .get('id');\n}, 'wikiPageId');\n\nconst wikiPage = query<ThingDataNodeType | null>((scope, authorId, name) =>\n  wikiPageId(scope, authorId, name)\n    .then(id => id && thingForDisplay(scope, id, Config.tabulator))\n    .then(R.propOr(null, 'data') as (x: any) => ThingDataNodeType | null)\n);\n\nconst userMeta = query((scope, id) => {\n  if (!id) return resolve(null);\n  return scope.get(`~${id}`).then((meta: GunNodeType) => ({\n    alias: R.prop('alias', meta),\n    createdAt: R.path(['_', '>', 'pub'], meta)\n  }));\n}, 'userMeta');\n\nconst createScope = R.curry((nab, opts) => makeScope(R.assoc('gun', nab.gun, opts || {})));\n\nexport const Query = {\n  thingMeta,\n  multiThingMeta,\n  thingScores,\n  thingData,\n  thingDataFromSouls,\n  thingForDisplay,\n  userPages,\n  wikiPageId,\n  wikiPage,\n  userMeta,\n  createScope\n};\n","import * as R from 'ramda';\n\nconst signup = R.curry(\n  (peer, username, password, opts = {}) =>\n    new Promise((ok, fail) => {\n      if (peer && peer.gun && peer.gun.user) {\n        const user = peer.gun.user();\n        user.create(\n          username,\n          password,\n          (ack: any) => {\n            if (ack.err) {\n              fail(ack.err);\n              user.leave();\n              peer.gun.user().leave();\n            } else {\n              peer.login(username, password).then(ok);\n            }\n          },\n          opts\n        );\n      } else {\n        fail('SEA is not loaded');\n      }\n    })\n);\n\nconst login = R.curry((peer, username, password) =>\n  new Promise((ok, fail) => {\n    if (peer && peer.gun && peer.gun.user) {\n      const user = peer.gun.user();\n\n      user.auth(username, password, (ack: any) =>\n        ack.err ? fail(ack.err) : ok(peer.gun.user().is)\n      );\n    } else {\n      fail('SEA is not loaded');\n    }\n  }).then(result => {\n    peer._onLogin && peer._onLogin(result); // eslint-disable-line\n    return result;\n  })\n);\n\nconst logout = (peer: any) => peer.gun.user().leave();\nconst isLoggedIn = (peer: any) => peer.gun && peer.gun.user && peer.gun.user().is;\nconst onLogin = R.curry((peer, fn) => (peer._onLogin = fn)); // eslint-disable-line\n\nexport const Authentication = {\n  signup,\n  login,\n  logout,\n  isLoggedIn,\n  onLogin\n};\n","import * as R from 'ramda';\n\nconst tokenize = (source: string) => {\n  const tokenMap = (source || '').split('\\n').reduce((def, line) => {\n    const tokens = line\n      .trim()\n      .split(' ')\n      .map(R.trim)\n      .filter(x => x);\n\n    if (!tokens.length) return def;\n    return R.assocPath(tokens, {}, def);\n  }, {});\n\n  const isPresent = (p: string | string[]) => {\n    let check = p;\n\n    if (typeof p === 'string') check = p.split(' ');\n    return check && R.path(check as string[], tokenMap);\n  };\n\n  const getValues = (p: string | string[]): string[] => R.keysIn(isPresent(p));\n  const getValue = (p: string | string[]): string | null => getValues(p)[0] || null;\n  const getLastValue = (p: string | string[]) => getValues(p).pop() || null;\n\n  const getValueChain = (p: string | string[]) => {\n    const keys = typeof p === 'string' ? p.split(' ') : p;\n    const values = [];\n    let next = 'start';\n\n    while (next) {\n      next = getValue([...keys, ...values]) || '';\n      next && values.push(next);\n    }\n\n    return values;\n  };\n\n  const getPairs = (p: string | string[]) => {\n    const keys = typeof p === 'string' ? p.split(' ') : p;\n\n    return getValues(keys).reduce((pairs: any[], key: string) => {\n      const val = getValue([...keys, key]);\n\n      return [...pairs, [key, val]];\n    }, []);\n  };\n\n  return {\n    source,\n    isPresent,\n    getValue,\n    getValues,\n    getLastValue,\n    getValueChain,\n    getPairs\n  };\n};\n\nexport const Tokenizer = { tokenize };\n","import * as R from 'ramda';\nimport { Tokenizer } from '../Tokenizer';\nimport { Config } from '../Config';\nimport { ListingDefinitionType } from '../types';\n\nconst fromSource = (source: string, ownerId = '', spaceName = '') => {\n  const tokenized = Tokenizer.tokenize(source);\n  const obj: ListingDefinitionType = { ...tokenized };\n  const { isPresent, getValue, getValues, getValueChain, getPairs } = tokenized;\n\n  [\n    obj.fromPageAuthor = ownerId,\n    obj.fromPageName = spaceName ? `space:${spaceName}` : undefined\n  ] = getValueChain('sourced from page');\n  obj.displayName = tokenized.getValue('name') || spaceName;\n  obj.indexer = getValue('tabulator') || Config.indexer;\n  obj.tabulator = getValue('tabulator') || obj.indexer;\n  obj.tabs = getPairs('tab');\n  obj.sort = getValue('sort');\n\n  // TODO: breaks with custom names\n  if (obj.sort === 'default') obj.sort = getValue('tab');\n\n  obj.uniqueByContent = !!isPresent('unique by content');\n  obj.curators = getValues('curator');\n  obj.moderators = getValues('mod');\n  obj.includeRanks = !!isPresent('show ranks');\n  obj.stickyIds = getValues('sticky');\n  obj.isIdSticky = (id: string) => !!tokenized.isPresent(['sticky', id]);\n  obj.isChat = !!isPresent('display as chat');\n  obj.submitTopics = getValues('submit to');\n  obj.submitTopic = getValue('submit to');\n  obj.chatTopic = getValue('chat in');\n\n  if (ownerId && spaceName) {\n    obj.spaceName = spaceName;\n    obj.owner = ownerId;\n    obj.useForComments = !tokenized.isPresent('comments leave space');\n    obj.basePath = `/user/${ownerId}/spaces/${spaceName}`;\n    if (obj.submitTopic) obj.submitPath = `${obj.basePath}/submit`;\n    obj.defaultTab = tokenized.getValue('tab');\n    obj.defaultTabPath = obj.defaultTab ? tokenized.getValue(['tab', obj.defaultTab]) : null;\n  }\n\n  obj.filters = {\n    functions: [],\n    allow: {\n      repliesTo: getValue('replies to author'),\n      type: getValue('type'), // TODO: this field seems redundant with kind and should be deprecated\n      ops: getValues('op'),\n      aliases: getValues('alias'),\n      authors: getValues('author'),\n      domains: getValues('domain'),\n      topics: getValues('topic'),\n      listings: getValues('listing'),\n      kinds: getValues('kind'),\n      anon: !isPresent('require signed'),\n      signed: !isPresent('require anon')\n    },\n    deny: {\n      aliases: getValues('ban alias'),\n      authors: getValues('ban author'),\n      domains: getValues('ban domain'),\n      topics: getValues('ban topic'),\n      anon: !!isPresent('require signed'),\n      signed: !!isPresent('require anon'),\n      tags: getPairs('can remove')\n    }\n  };\n\n  obj.voteFilters = {\n    functions: [],\n    upsMin: parseInt(getValue('ups above') || '', 10) || null,\n    upsMax: parseInt(getValue('ups below') || '', 10) || null,\n    downsMin: parseInt(getValue('downs above') || '', 10) || null,\n    downsMax: parseInt(getValue('downs below') || '', 10) || null,\n    scoreMin: parseInt(getValue('score above') || '', 10) || null,\n    scoreMax: parseInt(getValue('score below') || '', 10) || null\n  };\n\n  obj.censors = R.uniq(R.map<any[], string>(R.nth(1), obj.filters.deny.tags));\n  return obj;\n};\n\nexport const ListingDefinition = { fromSource };\n","import * as R from 'ramda';\nimport { ListingDefinitionType } from '../types';\n\nconst needsScores = (definition: ListingDefinitionType) =>\n  !!R.find(definition.isPresent, [\n    'sort hot',\n    'sort top',\n    'sort best',\n    'sort controversial',\n    'ups',\n    'downs',\n    'score',\n    'can remove'\n  ]);\n\nconst needsData = (definition: ListingDefinitionType) =>\n  !!R.find(definition.isPresent, [\n    'topic',\n    'domain',\n    'author',\n    'unique by content',\n    'kind',\n    'type',\n    'require signed',\n    'require anon',\n    'alias',\n    'ban domain',\n    'ban topic',\n    'ban author',\n    'ban alias'\n  ]);\n\nconst listingSource = (definition: ListingDefinitionType) => {\n  const listings = R.pathOr([], ['filters', 'allow', 'listings'], definition);\n  const { sort } = definition;\n  const listingPaths = R.map(l => `${l}/${sort}`, listings);\n\n  return { listingPaths };\n};\n\nconst topicSource = (definition: ListingDefinitionType) => {\n  const { sort } = definition;\n  const topics = R.pathOr([], ['filters', 'allow', 'topics'], definition);\n\n  if (!topics.length) topics.push('all');\n  const listingPaths = R.map(t => `/t/${t}/${sort}`, topics);\n\n  return { listingPaths };\n};\n\nconst domainSource = (definition: ListingDefinitionType) => {\n  const { sort } = definition;\n  const domains = R.pathOr([], ['filters', 'allow', 'domains'], definition);\n\n  if (!domains.length) return topicSource(definition);\n  const listingPaths = R.map(d => `/domain/${d}/${sort}`, domains);\n\n  return { listingPaths };\n};\n\nconst authorSource = (definition: ListingDefinitionType) => {\n  const { sort } = definition;\n  const authorIds = R.pathOr([], ['filters', 'allow', 'authors'], definition);\n  const type = R.path(['filters', 'allow', 'type'], definition) || 'overview';\n\n  if (!authorIds.length) return topicSource(definition);\n  const listingPaths = R.map(id => `/user/${id}/${type}/${sort}`, authorIds);\n\n  return { listingPaths };\n};\n\nconst curatorSource = (definition: ListingDefinitionType) => {\n  const { sort } = definition;\n  const curators = R.prop('curators', definition) || [];\n\n  if (!curators.length) return topicSource(definition);\n  const listingPaths = R.map(id => `/user/${id}/commented/${sort}`, curators);\n\n  return { listingPaths };\n};\n\nconst opSource = (definition: ListingDefinitionType) => {\n  const { sort } = definition;\n  const submissionIds = R.pathOr([], ['filters', 'allow', 'ops'], definition);\n\n  if (!submissionIds.length) topicSource(definition);\n  const listingPaths = R.map(id => `/things/${id}/comments/${sort}`, submissionIds);\n\n  return { listingPaths };\n};\n\nconst repliesSource = (definition: ListingDefinitionType) => {\n  const { sort } = definition;\n  const id = R.path(['filters', 'allow', 'repliesTo'], definition);\n  const type = R.path(['filters', 'allow', 'type'], definition);\n\n  const listingPaths = [`/user/${id}/replies/${type}/${sort}`];\n\n  return { listingPaths };\n};\n\nconst sources = {\n  listing: listingSource,\n  replies: repliesSource,\n  op: opSource,\n  curator: curatorSource,\n  author: authorSource,\n  domain: domainSource,\n  topic: topicSource\n};\n\nconst sourceNames = R.keys(sources);\nconst sourceName = (def: ListingDefinitionType) => R.find(def.isPresent, sourceNames) || 'topic';\nconst fromDefinition = (definition: ListingDefinitionType) => {\n  const name = sourceName(definition);\n\n  return R.mergeLeft({ name }, sources[name](definition));\n};\n\nexport const ListingDataSource = {\n  fromDefinition,\n  sources,\n  needsScores,\n  needsData\n};\n","import * as R from 'ramda';\nimport { all, resolve } from 'gun-scope';\nimport { Constants } from '../Constants';\nimport { Schema } from '../Schema';\nimport { Query } from '../Query';\nimport { ThingDataNode } from '../Thing';\nimport { ListingNode } from './ListingNode';\nimport { ListingDataSource } from './ListingDataSource';\nimport {\n  ListingDefinitionType,\n  ListingNodeRow,\n  GunScope,\n  ListingSpecType,\n  CombinedThingType\n} from '../types';\n\nconst intPath = (p: string[]) =>\n  R.compose(\n    parseInt,\n    R.pathOr('', p)\n  );\n\ntype FilterFunction = (thing: CombinedThingType) => boolean;\n\nconst fromDefinition = (definition: ListingDefinitionType) => {\n  const { filters, voteFilters, isPresent } = definition;\n  const filterFunctions: FilterFunction[] = [];\n  const voteFilterFunctions: FilterFunction[] = [];\n  const addFilter = (...fns: Function[]) =>\n    filterFunctions.push(R.compose(...(fns as [FilterFunction])));\n  const addVoteFilter = (...fns: Function[]) =>\n    voteFilterFunctions.push(R.compose(...(fns as [FilterFunction])));\n\n  if (filters.allow.aliases.length) {\n    addFilter((t: string) => !!isPresent(['alias', t]), R.path(['data', 'author']));\n  }\n  if (filters.allow.authors.length) {\n    addFilter((t: string) => !!isPresent(['author', t]), R.path(['data', 'authorId']));\n  }\n  if (filters.allow.domains.length) {\n    addFilter((t: string) => !!isPresent(['domain', t]), ThingDataNode.domain, R.prop('data'));\n  }\n\n  if (\n    filters.allow.topics.length &&\n    !R.find(\n      R.compose(\n        R.identical('all'),\n        R.last as (strs: string[]) => string,\n        R.split(':')\n      ),\n      filters.allow.topics as string[]\n    )\n  ) {\n    addFilter((item: CombinedThingType) => {\n      let topic = R.path(['data', 'topic'], item);\n      const kind = R.path(['data', 'kind'], item);\n\n      if (kind === 'chatmsg') topic = `chat:${topic}`;\n      if (kind === 'comment') topic = `comments:${topic}`;\n      return !!isPresent(['topic', topic]);\n    });\n  }\n\n  if (filters.allow.kinds.length) {\n    addFilter((kind: string) => !!isPresent(['kind', kind]), R.path(['data', 'kind']));\n  }\n  if (filters.allow.type === 'commands') {\n    addFilter(\n      R.compose(\n        R.test(Constants.COMMAND_RE),\n        R.pathOr('', ['data', 'body'])\n      )\n    );\n  }\n\n  if (filters.deny.aliases.length) {\n    addFilter((alias: string) => !isPresent(['ban', 'alias', alias]), R.path(['data', 'author']));\n  }\n  if (filters.deny.authors.length) {\n    addFilter(\n      (authorId: string) => !isPresent(['ban', 'author', authorId]),\n      R.path(['data', 'authorId'])\n    );\n  }\n  if (filters.deny.domains.length) {\n    addFilter(\n      (domain: string) => !domain || !isPresent(['ban', 'domain', domain]),\n      ThingDataNode.domain\n    );\n  }\n  if (filters.deny.topics.length) {\n    addFilter((topic: string) => !isPresent(['ban', 'topic', topic]), R.path(['data', 'topic']));\n  }\n  if (filters.deny.anon) addFilter(R.path(['data', 'authorId']));\n  if (filters.deny.signed) {\n    addFilter(\n      R.compose(\n        authorId => !authorId,\n        R.pathOr('', ['data', 'authorId'])\n      )\n    );\n  }\n\n  if (voteFilters.upsMin !== null) {\n    addVoteFilter(R.lte(voteFilters.upsMin), intPath(['votes', 'up']));\n  }\n  if (voteFilters.upsMax !== null) {\n    addVoteFilter(R.gte(voteFilters.upsMax), intPath(['votes', 'up']));\n  }\n  if (voteFilters.downsMin !== null) {\n    addVoteFilter(R.lte(voteFilters.downsMin), intPath(['votes', 'down']));\n  }\n  if (voteFilters.downsMax !== null) {\n    addVoteFilter(R.gte(voteFilters.downsMax), intPath(['votes', 'down']));\n  }\n  if (voteFilters.scoreMin !== null) {\n    addVoteFilter(R.lte(voteFilters.scoreMin), intPath(['votes', 'score']));\n  }\n  if (voteFilters.scoreMax !== null) {\n    addVoteFilter(R.gte(voteFilters.scoreMax), intPath(['votes', 'score']));\n  }\n\n  if (filters.deny.tags.length) {\n    addVoteFilter((thing: CombinedThingType) => {\n      const cmds = R.path(['votes', 'commands'], thing) || {};\n\n      return !filters.deny.tags.find(\n        ([tagName, authorId]: [string, string]) => !!R.path([authorId, 'tag', tagName], cmds)\n      );\n    });\n  }\n\n  const contentFilter = (thing: CombinedThingType) => !filterFunctions.find(fn => !fn(thing));\n  const voteFilter = (thing: CombinedThingType) => !voteFilterFunctions.find(fn => !fn(thing));\n  const thingFilter = (thing: CombinedThingType) =>\n    definition.isIdSticky(R.propOr('', 'id', thing)) || (contentFilter(thing) && voteFilter(thing));\n  return { thingFilter, contentFilter, voteFilter };\n};\n\ntype FilterFnType = (id: string) => Promise<boolean>;\n\ninterface GetRowsParams {\n  limit?: string;\n  count?: string;\n  after?: string;\n  filterFn: FilterFnType;\n}\n\nconst getFilteredRows = async (\n  scope: GunScope,\n  spec: ListingSpecType,\n  sortedRows: ListingNodeRow[],\n  params?: GetRowsParams\n): Promise<ListingNodeRow[]> => {\n  const {\n    limit: limitProp = '25',\n    count: countProp = '0',\n    after = null,\n    filterFn = R.always(resolve(true))\n  } = params || {};\n  const limit = parseInt(limitProp, 10);\n  const count = parseInt(countProp, 10) || 0;\n  const rows = sortedRows.slice();\n  const filtered: ListingNodeRow[] = [];\n  const data: any[] = [];\n  const fetchBatch = (size = 30) =>\n    all(\n      R.map(async row => {\n        let inListing = true;\n\n        if (!row[ListingNode.POS_ID]) {\n          console.log('blankRow', row);\n          return;\n        }\n\n        if (filterFn) inListing = await filterFn((row[ListingNode.POS_ID] as string) || '');\n        if (inListing) {\n          if (spec.uniqueByContent) {\n            const itemData = await Query.thingData(scope, row[ListingNode.POS_ID]);\n            const url = ThingDataNode.url(itemData);\n\n            if (\n              url &&\n              R.find(\n                R.compose(\n                  R.equals(url),\n                  ThingDataNode.url\n                ),\n                data\n              )\n            ) {\n              return;\n            }\n            data.push(itemData);\n          }\n          filtered.push(row);\n        }\n      }, rows.splice(count, size))\n    );\n\n  while (rows.length > count) {\n    const res = await fetchBatch();\n    if (limit && filtered.length >= limit) break;\n  }\n\n  return R.compose(\n    limit\n      ? (R.slice(0, limit) as (rows: ListingNodeRow[]) => ListingNodeRow[])\n      : (R.identity as (rows: ListingNodeRow[]) => ListingNodeRow[]),\n    R.sortBy(R.nth(ListingNode.POS_VAL) as (row: ListingNodeRow) => number) as (\n      row: ListingNodeRow[]\n    ) => ListingNodeRow[],\n    R.always(filtered) as () => ListingNodeRow[]\n  )();\n};\n\nconst getFilteredIds: (\n  scope: GunScope,\n  spec: ListingSpecType,\n  sortedRows: ListingNodeRow[],\n  params?: GetRowsParams\n) => Promise<string[]> = R.compose(\n  x => x.then(R.map(R.nth(ListingNode.POS_ID) as (row: ListingNodeRow) => string)),\n  getFilteredRows\n);\n\nconst thingFilter = R.curry(\n  (scope, spec, thingId): Promise<boolean> => {\n    if (spec.isIdSticky(thingId)) return resolve(true);\n\n    return Query.thingMeta(scope, {\n      tabulator: spec.tabulator,\n      thingSoul: Schema.Thing.route.reverse({ thingId }),\n      scores: ListingDataSource.needsScores(spec),\n      data: ListingDataSource.needsData(spec)\n    }).then(spec.thingFilter);\n  }\n);\n\nexport const ListingFilter = {\n  fromDefinition,\n  getFilteredRows,\n  getFilteredIds,\n  thingFilter\n};\n","import * as R from 'ramda';\nimport { query } from 'gun-scope';\nimport { Query } from '../Query';\nimport { ThingDataNode } from '../Thing';\nimport { ListingDefinition } from './ListingDefinition';\nimport { ListingDataSource } from './ListingDataSource';\nimport { ListingFilter } from './ListingFilter';\nimport { ListingSpecType, ListingDefinitionType } from '../types';\n\nconst fromSource = R.compose(\n  R.apply(R.mergeLeft) as (l: any) => ListingSpecType,\n  R.juxt([ListingFilter.fromDefinition, R.identity]),\n  R.apply(R.assoc('dataSource')) as (l: any) => ListingDefinitionType,\n  R.juxt([ListingDataSource.fromDefinition, R.identity]),\n  ListingDefinition.fromSource\n) as (source: string, ownerId?: string, spaceName?: string) => ListingSpecType;\n\nconst getSource = query<string>((scope, authorId, name, extra = '') =>\n  Query.wikiPage(scope, authorId, name).then(\n    R.compose(\n      body => `${body}\n# added by indexer\n${extra || ''}\nsourced from page ${authorId} ${name}\n`,\n      ThingDataNode.body\n    )\n  )\n);\n\nexport const ListingSpec = { fromSource, getSource };\n","import * as R from 'ramda';\nimport { query, resolve } from 'gun-scope';\nimport { Schema } from '../Schema';\nimport { Query } from '../Query';\nimport { SortDataRow, CombinedThingType } from '../types';\n\nconst [POS_ID, POS_VAL] = [0, 1];\nconst toIds = R.map(R.nth(POS_ID));\nconst sortItems = R.sortBy(R.nth(POS_VAL) as (row: SortDataRow) => number);\n\nconst voteSort = (fn: (thing: CombinedThingType | null) => number) =>\n  query<number>((scope, thingId, spec) => {\n    if (spec.isIdSticky(thingId)) return resolve(-Infinity);\n    if (R.includes(thingId, spec.filters.allow.ops)) return resolve(-Infinity);\n\n    return Query.thingMeta(scope, {\n      tabulator: spec.tabulator,\n      scores: true,\n      thingSoul: Schema.Thing.route.reverse({ thingId })\n    }).then(fn);\n  });\n\nconst timeSort = (fn: (thing: CombinedThingType | null) => number) =>\n  query<number>((scope, thingId, spec) =>\n    Query.thingMeta(scope, {\n      tabulator: spec.tabulator,\n      thingSoul: Schema.Thing.route.reverse({ thingId })\n    }).then(fn)\n  );\n\nconst sorts = {\n  new: timeSort(\n    R.compose(\n      R.multiply(-1),\n      parseInt,\n      R.propOr(0, 'timestamp')\n    )\n  ),\n  top: voteSort(\n    R.compose(\n      (x: string) => -1 * parseInt(x, 10),\n      R.pathOr('0', ['votes', 'score'])\n    )\n  ),\n  comments: voteSort(\n    R.compose(\n      (x: string) => -1 * parseFloat(x),\n      R.pathOr('0', ['votes', 'comment'])\n    )\n  ),\n  discussed: voteSort(thing => {\n    const timestamp = parseInt(R.propOr('', 'timestamp', thing), 10);\n    const score = parseInt(R.pathOr(0, ['votes', 'comment'], thing), 10);\n    const seconds = timestamp / 1000 - 1134028003;\n    const order = Math.log10(Math.max(Math.abs(score), 1));\n\n    if (!score) return 1000000000 - seconds;\n    return -1 * (order + seconds / 45000);\n  }),\n  hot: voteSort(thing => {\n    const timestamp = parseInt(R.propOr('', 'timestamp', thing), 10);\n    const score = parseInt(R.pathOr(0, ['votes', 'score'], thing), 10);\n    const seconds = timestamp / 1000 - 1134028003;\n    const order = Math.log10(Math.max(Math.abs(score), 1));\n    let sign = 0;\n\n    if (score > 0) {\n      sign = 1;\n    } else if (score < 0) {\n      sign = -1;\n    }\n    return -1 * (sign * order + seconds / 45000);\n  }),\n  best: voteSort(thing => {\n    const ups = parseInt(R.pathOr(0, ['votes', 'up'], thing), 10);\n    const downs = parseInt(R.pathOr(0, ['votes', 'down'], thing), 10);\n    const n = ups + downs;\n\n    if (n === 0) return 0;\n    const z = 1.281551565545; // 80% confidence\n    const p = ups / n;\n    const left = p + (1 / (2 * n)) * z * z;\n    const right = z * Math.sqrt((p * (1 - p)) / n + (z * z) / (4 * n * n));\n    const under = 1 + (1 / n) * z * z;\n\n    return -1 * ((left - right) / under);\n  }),\n  controversial: voteSort(thing => {\n    const ups = parseInt(R.pathOr(0, ['votes', 'up'], thing), 10);\n    const downs = parseInt(R.pathOr(0, ['votes', 'down'], thing), 10);\n\n    if (ups <= 0 || downs <= 0) return 0;\n    const magnitude = ups + downs;\n    const balance = ups > downs ? downs / ups : ups / downs;\n\n    return -1 * magnitude ** balance;\n  })\n};\n\nconst isValidSort = (sort: string) => !!(sort in sorts);\n\nexport const ListingSort = {\n  POS_ID,\n  POS_VAL,\n  sorts,\n  isValidSort,\n  toIds,\n  sortItems\n};\n","import * as R from 'ramda';\nimport Route from 'route-parser';\n\nconst splitDomains = R.compose(\n  R.sortBy(R.identity) as (i: any[]) => string[],\n  R.filter(R.identity as (i: any) => boolean),\n  R.map(R.trim),\n  R.split('+'),\n  R.toLower,\n  R.defaultTo('') as (i: string | undefined) => string\n);\n\nconst splitTopics = R.compose(\n  R.ifElse(R.prop('length'), R.identity, R.always(['all'])),\n  splitDomains\n) as (topic: string) => string[];\n\nconst withRoute = (obj: any) => R.assoc('route', new Route(obj.path), obj);\n\nexport const Path = { splitDomains, splitTopics, withRoute };\n","import * as R from 'ramda';\nimport { query } from 'gun-scope';\nimport { ListingSpecType, GunScope } from '../../types';\nimport { Config } from '../../Config';\nimport { Path } from '../Path';\nimport { ListingSpec } from '../ListingSpec';\n\nconst path = '/t/:topic/:sort';\nconst tabs = ['hot', 'new', 'discussed', 'controversial', 'top', 'firehose'];\n\nconst getSource = query<string>(\n  (scope: GunScope, { topic, sort }: { topic: string; sort: string }) => {\n    const topics = Path.splitTopics(topic);\n    const submitTo = topics[0] === 'all' ? 'whatever' : topics[0];\n\n    return ListingSpec.getSource(\n      scope,\n      Config.indexer,\n      'listing:topic',\n      [\n        `name ${topic}`,\n        `submit to ${submitTo}`,\n        `sort ${sort}`,\n        topic.indexOf(':') === -1 ? 'kind submission' : '',\n        ...R.map(topic => `topic ${topic}`, topics),\n        ...R.map(tab => `tab ${tab} /t/${topic}/${tab}`, tabs)\n      ].join('\\n')\n    );\n  }\n);\n\nconst getSpec = query<ListingSpecType>((scope, match) =>\n  getSource(scope, match).then(\n    R.pipe(\n      ListingSpec.fromSource as (source: string) => ListingSpecType,\n      R.assoc('basePath', `/t/${match.topic}`)\n    )\n  )\n);\n\nexport const TopicListing = Path.withRoute({\n  tabs,\n  path,\n  getSource,\n  getSpec\n});\n","import * as R from 'ramda';\nimport { query } from 'gun-scope';\nimport { ListingSpecType } from '../../types';\nimport { Config } from '../../Config';\nimport { Path } from '../Path';\nimport { ListingSpec } from '../ListingSpec';\nimport { TopicListing } from './TopicListing';\n\nconst path = '/t/:topic/chat';\nconst tabs = [...TopicListing.tabs, 'chat'];\n\nconst getSource = query<string>((scope, { topic, sort }) => {\n  const normalTopics = Path.splitTopics(topic);\n  const submitTo = topic === 'all' ? 'whatever' : normalTopics[0] || 'whatever';\n  const topics = R.reduce((res, topic) => [...res, `chat:${topic}`], [] as string[], normalTopics);\n  return ListingSpec.getSource(\n    scope,\n    Config.indexer,\n    'listing:chat',\n    [\n      'sort new',\n      'display as chat',\n      `submit to ${submitTo}`,\n      `sort ${sort}`,\n      ...R.map(topic => `topic ${topic}`, topics),\n      ...R.map(tab => `tab ${tab} /t/${topic}/${tab}`, tabs)\n    ].join('\\n')\n  );\n});\n\nconst getSpec = query<ListingSpecType>((scope, match) =>\n  getSource(scope, match).then(source => ListingSpec.fromSource(source))\n);\n\nexport const ChatListing = Path.withRoute({\n  path,\n  getSource,\n  getSpec\n});\n","import * as R from 'ramda';\nimport { query } from 'gun-scope';\nimport { Config } from '../../Config';\nimport { Path } from '../Path';\nimport { ListingSpec } from '../ListingSpec';\nimport { TopicListing } from './TopicListing';\n\nconst path = '/t/:topic/firehose';\nconst tabs = TopicListing.tabs;\n\nconst getSource = query<string>((scope, { topic, sort }) => {\n  const normalTopics = Path.splitTopics(topic);\n  const submitTo = topic === 'all' ? 'whatever' : normalTopics[0] || 'whatever';\n  const topics = normalTopics.reduce(\n    (res, topic) => [...res, topic, `chat:${topic}`, `comments:${topic}`],\n    [] as string[]\n  );\n\n  return ListingSpec.getSource(\n    scope,\n    Config.indexer,\n    'listing:firehose',\n    [\n      'sort new',\n      'display as chat',\n      `submit to ${submitTo}`,\n      `sort ${sort}`,\n      ...R.map(topic => `topic ${topic}`, topics),\n      ...R.map(tab => `tab ${tab} /t/${topic}/${tab}`, tabs)\n    ].join('\\n')\n  );\n});\n\nconst getSpec = query((scope, match) => getSource(scope, match).then(ListingSpec.fromSource));\n\nexport const FirehoseListing = Path.withRoute({\n  tabs,\n  path,\n  getSource,\n  getSpec\n});\n","import { query } from 'gun-scope';\nimport { Config } from '../../Config';\nimport { Path } from '../Path';\nimport { ListingSpec } from '../ListingSpec';\n\nconst path = '/user/:authorId/commented/:sort';\n\nconst getSource = query<string>((scope, { authorId, sort }) =>\n  ListingSpec.getSource(\n    scope,\n    Config.indexer,\n    'listing:commented',\n    [`curator ${authorId}`, `sort ${sort}`].join('\\n')\n  )\n);\n\nconst getSpec = query((scope, match) => getSource(scope, match).then(ListingSpec.fromSource));\n\nexport const CommentedListing = Path.withRoute({ path, getSource, getSpec });\n","import * as R from 'ramda';\nimport { query } from 'gun-scope';\nimport { Config } from '../../Config';\nimport { Path } from '../Path';\nimport { ListingSpec } from '../ListingSpec';\n\nconst path = '/domain/:domain/:sort';\nconst tabs = ['hot', 'new', 'discussed', 'controversial', 'top'];\n\nconst getSource = query<string>((scope, { domain, sort }) => {\n  const domains = Path.splitTopics(domain);\n\n  return ListingSpec.getSource(\n    scope,\n    Config.indexer,\n    'listing:domain',\n    [\n      `name ${domains[0]}`,\n      'submit to whatever',\n      `sort ${sort}`,\n      'kind submission',\n      ...R.map(domain => `domain ${domain}`, domains),\n      ...R.map(tab => `tab ${tab} /domain/${domain}/${tab}`, tabs)\n    ].join('\\n')\n  );\n});\n\nconst getSpec = query((scope, match) => getSource(scope, match).then(ListingSpec.fromSource));\n\nexport const DomainListing = Path.withRoute({\n  path,\n  tabs,\n  getSource,\n  getSpec\n});\n","import { query } from 'gun-scope';\nimport { Config } from '../../Config';\nimport { Path } from '../Path';\nimport { ListingSpec } from '../ListingSpec';\n\nconst path = '/things/:thingId/comments/:sort';\n\nconst getSource = query<string>((scope, { thingId, sort }) =>\n  ListingSpec.getSource(\n    scope,\n    Config.indexer,\n    'listing:comments',\n    [`op ${thingId}`, `sort ${sort}`].join('\\n')\n  )\n);\n\nconst getSpec = query((scope, match) => getSource(scope, match).then(ListingSpec.fromSource));\n\nexport const CommentListing = Path.withRoute({\n  path,\n  getSource,\n  getSpec\n});\n","import * as R from 'ramda';\nimport { query } from 'gun-scope';\nimport { Config } from '../Config';\nimport { Tokenizer } from '../Tokenizer';\nimport { Query } from '../Query';\nimport { ListingSpec } from './ListingSpec';\n\nconst tabs = ['hot', 'new', 'discussed', 'controversial', 'top'];\nconst configPageName = (name: string) => `space:${name}`;\nconst sidebarPageName = (name: string) => `space:${name}:sidebar`;\n\nconst sourceWithDefaults = R.curry(\n  (ownerId, name, source): string => {\n    let result = [source || ''];\n    const tokenized = Tokenizer.tokenize(source);\n\n    if (!tokenized.getValue('tab')) {\n      tabs.map(tab => result.push(`tab ${tab} /user/${ownerId}/spaces/${name}/${tab}`));\n    }\n\n    let indexer = tokenized.getValue('indexer');\n\n    if (!indexer) {\n      result.push(`indexer ${Config.indexer}`);\n      indexer = Config.indexer;\n    }\n\n    let tabulator = tokenized.getValue('tabulator');\n\n    if (!tabulator) result.push(`tabulator ${indexer}`);\n\n    return result.join('\\n');\n  }\n);\n\nconst getSource = query<string>((scope, authorId, name, extra) =>\n  ListingSpec.getSource(scope, authorId, configPageName(name), extra).then(\n    sourceWithDefaults(authorId, name)\n  )\n);\n\nconst getSpec = query((scope, authorId, name, extra) =>\n  getSource(scope, authorId, name, extra).then(source =>\n    ListingSpec.fromSource(source, authorId, name)\n  )\n);\n\nconst nodeToSpaceNames = R.compose(\n  R.sortBy(R.identity),\n  R.map<string, string>(R.replace(/^space:/, '')),\n  R.filter(R.compose(\n    R.propOr(false, 'length'),\n    R.match(/^space:[^:]*$/)\n  ) as (str: string) => boolean) as (names: string[]) => string[],\n  R.keysIn\n);\n\nconst userSpaceNames = query<string[]>((scope, authorId) =>\n  Query.userPages(scope, authorId).then(nodeToSpaceNames)\n);\n\nexport const SpaceSpec = {\n  configPageName,\n  sidebarPageName,\n  nodeToSpaceNames,\n  userSpaceNames,\n  tabs,\n  getSource,\n  getSpec\n};\n","import { query } from 'gun-scope';\nimport { Path } from '../Path';\nimport { SpaceSpec } from '../SpaceSpec';\n\nconst path = '/user/:authorId/spaces/:name/:sort';\n\nconst getSource = query<string>((scope, { authorId, name, sort }) =>\n  SpaceSpec.getSource(scope, authorId, name, `sort ${sort}`)\n);\n\nconst getSpec = query((scope, { authorId, name, sort }) =>\n  SpaceSpec.getSpec(scope, authorId, name, `sort ${sort}`)\n);\n\nexport const SpaceListing = Path.withRoute({\n  path,\n  getSource,\n  getSpec\n});\n","import { query } from 'gun-scope';\nimport { Config } from '../../Config';\nimport { Path } from '../Path';\nimport { ListingSpec } from '../ListingSpec';\n\nconst path = '/user/:authorId/replies/:type/:sort';\n\nconst getSource = query<string>((scope, { authorId, type, sort = 'new' }) =>\n  ListingSpec.getSource(\n    scope,\n    Config.indexer,\n    'listing:inbox',\n    [`replies to author ${authorId}`, 'kind comment', `type ${type}`, `sort ${sort}`].join('\\n')\n  )\n);\n\nconst getSpec = query((scope, match) => getSource(scope, match).then(ListingSpec.fromSource));\n\nexport const InboxListing = Path.withRoute({\n  path,\n  getSource,\n  getSpec\n});\n","import * as R from 'ramda';\nimport { query } from 'gun-scope';\nimport { ListingSpecType } from '../../types';\nimport { Config } from '../../Config';\nimport { Query } from '../../Query';\nimport { Path } from '../Path';\nimport { ListingSpec } from '../ListingSpec';\n\nconst path = '/user/:authorId/:type/:sort';\nconst tabs = ['overview', 'comments', 'submitted', 'commands'];\n\nconst getSource = query<string>((scope, { authorId, type, sort }) =>\n  ListingSpec.getSource(\n    scope,\n    Config.indexer,\n    'listing:profile',\n    [\n      `author ${authorId}`,\n      `type ${type}`,\n      `sort ${sort}`,\n      ...R.map(tab => `tab ${tab} /user/${authorId}/${tab}`, tabs)\n    ].join('\\n')\n  )\n);\n\nconst getSpec = query((scope, match) =>\n  Query.userMeta(scope, match.authorId).then(meta =>\n    getSource(scope, match).then((R.pipe(\n      ListingSpec.fromSource,\n      R.mergeLeft({\n        profileId: match.authorId,\n        displayName: R.propOr('', 'alias', meta)\n      })\n    ) as unknown) as (source: string) => ListingSpecType)\n  )\n);\n\nexport const ProfileListing = Path.withRoute({\n  path,\n  tabs,\n  getSource,\n  getSpec\n});\n","import * as R from 'ramda';\nimport { query, resolve } from 'gun-scope';\nimport { ListingSpecType, ThingDataNodeType } from '../../types';\nimport { Query } from '../../Query';\nimport { ChatListing } from './ChatListing';\nimport { FirehoseListing } from './FirehoseListing';\nimport { CommentedListing } from './CommentedListing';\nimport { TopicListing } from './TopicListing';\nimport { DomainListing } from './DomainListing';\nimport { CommentListing } from './CommentListing';\nimport { SpaceListing } from './SpaceListing';\nimport { InboxListing } from './InboxListing';\nimport { ProfileListing } from './ProfileListing';\n\nconst types = {\n  ChatListing,\n  FirehoseListing,\n  TopicListing,\n  DomainListing,\n  CommentListing,\n  SpaceListing,\n  InboxListing,\n  CommentedListing,\n  ProfileListing\n};\n\nconst typesArray = R.values(types);\n\nconst fromPath = (path: string) => {\n  let match;\n\n  for (let i = 0; i < typesArray.length; i++) {\n    match = typesArray[i].route.match(path);\n    if (match) return R.assoc('match', match, typesArray[i]);\n  }\n  return null;\n};\n\nconst sidebarFromPath = query<ThingDataNodeType | null>((scope, path) =>\n  specFromPath(scope, path).then(spec => {\n    const { fromPageAuthor = '', fromPageName = '' } = spec || {};\n    if (!fromPageAuthor || !fromPageName) return null;\n    return Query.wikiPage(scope, fromPageAuthor, `${fromPageName}:sidebar`);\n  })\n);\n\nconst specFromPath = query<ListingSpecType>((scope, path) => {\n  const type = fromPath(path);\n\n  if (!type) throw new Error(`Can't find type for path: ${path}`);\n\n  return type.getSpec(scope, type.match).then((baseSpec: ListingSpecType) => {\n    let spec = baseSpec;\n\n    if (type.match.sort === 'default') {\n      spec = R.assoc('path', type.route.reverse(R.assoc('sort', spec.sort, type.match)), spec);\n    } else {\n      spec = R.assoc('path', path, baseSpec);\n    }\n\n    if (spec.submitTopic && !spec.submitPath) {\n      spec = R.assoc('submitPath', `/t/${spec.submitTopic}/submit`, spec);\n    }\n\n    return spec;\n  });\n});\n\nexport const ListingType = {\n  ...types,\n  types,\n  fromPath,\n  sidebarFromPath,\n  specFromPath\n};\n","import * as R from 'ramda';\nimport memoize from 'fast-memoize';\nimport { ListingSpecType, ListingNodeRow, GunScope, ListingNodeType } from '../types';\nimport { ListingNode } from './ListingNode';\nimport { ListingFilter } from './ListingFilter';\nimport { ListingType } from './ListingType';\nimport { ListingSpec } from './ListingSpec';\n\nexport class ListingQuery {\n  path: string;\n  type: any;\n  spec: ListingSpecType;\n  rowsFromNode: (node: ListingNodeType) => ListingNodeRow[];\n  combineSourceRows: (rowsSets: ListingNodeRow[][]) => ListingNodeRow[];\n  viewCache: { [soul: string]: ListingQuery };\n  listings: ListingQuery[];\n  sourced: { [id: string]: ListingNodeRow };\n\n  constructor(path: string, parent?: ListingQuery) {\n    this.listings = [];\n    this.viewCache = parent ? parent.viewCache : {};\n    this.sourced = {};\n    this.path = path;\n    this.type = ListingType.fromPath(path);\n    this.spec = ListingSpec.fromSource('');\n    this.rowsFromNode = parent ? parent.rowsFromNode : memoize(ListingNode.rows);\n    this.combineSourceRows = parent\n      ? parent.combineSourceRows\n      : memoize(\n          R.pipe(\n            R.reduce(\n              R.concat as (a: ListingNodeRow[], b: ListingNodeRow[]) => ListingNodeRow[],\n              [] as ListingNodeRow[]\n            ),\n            ListingNode.sortRows,\n            R.uniqBy(R.nth(ListingNode.POS_ID))\n          )\n        );\n  }\n\n  unfilteredRows(scope: GunScope): Promise<ListingNodeRow[]> {\n    if (!this.type) return Promise.resolve([]);\n    return this.type\n      .getSpec(scope, this.type.match)\n      .then((spec: ListingSpecType) => {\n        this.spec = spec;\n        const paths = R.pathOr([], ['dataSource', 'listingPaths'], spec);\n        const listingPaths = R.without([this.path], paths);\n        this.listings = listingPaths.map(\n          path => this.viewCache[path] || (this.viewCache[path] = new ListingQuery(path, this))\n        );\n        if (!this.listings.length) {\n          return scope.get(ListingNode.soulFromPath(spec.indexer, this.path)).then(\n            R.pipe(\n              this.rowsFromNode,\n              R.of,\n              this.combineSourceRows\n            )\n          );\n        }\n        return Promise.all<ListingNodeRow[]>(this.listings.map(l => l.unfilteredRows(scope))).then(\n          this.combineSourceRows\n        );\n      })\n      .then((rows: ListingNodeRow[]) => {\n        this.sourced = R.indexBy(R.nth(ListingNode.POS_ID) as (row: any) => string, rows);\n        return rows;\n      });\n  }\n\n  async checkId(scope: GunScope, id: string): Promise<boolean> {\n    if (this.spec.isIdSticky(id)) return true;\n    if (!(id in this.sourced)) return false;\n    const filterFn = ListingFilter.thingFilter(scope, this.spec);\n    if (!(await filterFn(id))) return false;\n\n    const listings = this.listings.slice();\n    if (!listings.length) return true;\n    for (let i = 0; i < listings.length; i++) {\n      if (await listings[i].checkId(scope, id)) return true;\n    }\n\n    return false;\n  }\n\n  ids(scope: GunScope, opts = {}) {\n    return this.unfilteredRows(scope).then(rows => {\n      const stickyRows: ListingNodeRow[] = R.map(id => [-1, id, -Infinity], this.spec.stickyIds);\n      const filterFn = (id: string) => this.checkId(scope, id);\n\n      return ListingFilter.getFilteredIds(scope, this.spec, [...stickyRows, ...rows], {\n        ...opts,\n        filterFn\n      });\n    });\n  }\n}\n","import { ListingNode } from './ListingNode';\nimport { ListingSpec } from './ListingSpec';\nimport { ListingSort } from './ListingSort';\nimport { ListingType } from './ListingType';\nimport { ListingQuery } from './ListingQuery';\n\nexport { ListingDataSource } from './ListingDataSource';\nexport { ListingDefinition } from './ListingDefinition';\nexport { ListingFilter } from './ListingFilter';\nexport { ListingNode } from './ListingNode';\nexport { ListingSort } from './ListingSort';\nexport { ListingSpec } from './ListingSpec';\nexport { ListingType } from './ListingType';\nexport { ListingQuery } from './ListingQuery';\nexport { SpaceSpec } from './SpaceSpec';\n\nexport const Listing = {\n  ...ListingType.types,\n  ListingNode,\n  ListingSpec,\n  ListingQuery,\n  isValidSort: ListingSort.isValidSort,\n  idsToSouls: ListingNode.idsToSouls,\n  get: ListingNode.get,\n  typeFromPath: ListingType.fromPath,\n  sidebarFromPath: ListingType.sidebarFromPath,\n  specFromPath: ListingType.specFromPath\n};\n","import { ListingSpec } from '../Listing';\nimport { ListingSpecType } from '../types';\n\nexport class ThingQueue {\n  newIds: string[];\n  updatedIds: string[];\n  peer: any;\n  spec: ListingSpecType;\n  scopeOpts: any;\n  processingId: string;\n\n  constructor(peer: any, config = '', scopeOpts = {}) {\n    this.spec = ListingSpec.fromSource(config);\n    this.peer = peer;\n    this.newIds = [];\n    this.updatedIds = [];\n    this.processingId = '';\n    this.scopeOpts = scopeOpts;\n  }\n\n  length() {\n    return this.newIds.length + this.updatedIds.length + (this.processingId ? 1 : 0);\n  }\n\n  contains(id: string) {\n    return this.newIds.indexOf(id) !== -1 || this.updatedIds.indexOf(id) !== -1;\n  }\n\n  enqueue(id: string, isNew = false) {\n    if (this.contains(id)) return;\n    (isNew ? this.newIds : this.updatedIds).splice(0, 0, id);\n    // tslint:disable-next-line: no-floating-promises\n    this.processNext();\n  }\n\n  dequeue() {\n    return this.newIds.pop() || this.updatedIds.pop() || '';\n  }\n\n  // tslint:disable-next-line: no-empty\n  async processNext() {}\n\n  // tslint:disable-next-line: no-empty\n  onPut(msg: any) {}\n}\n","import * as R from 'ramda';\nimport { GunScope, ThingDataNodeType, ThingVoteCountsType } from '../types';\nimport { Config } from '../Config';\nimport { Query } from '../Query';\nimport { ListingSort, ListingNode, ListingSpec } from '../Listing';\nimport { Schema } from '../Schema';\nimport { ThingDataNode } from '../Thing';\nimport { ThingQueue } from './ThingQueue';\n\nasync function getListings(scope: GunScope, thingId: string) {\n  if (!thingId) return [];\n  const listings: string[] = [];\n  const [data, scores]: [ThingDataNodeType | null, ThingVoteCountsType] = await Promise.all([\n    Query.thingData(scope, thingId),\n    Query.thingScores(scope, thingId)\n  ]);\n  if (!data) return [];\n  const kind = ThingDataNode.kind(data);\n  const authorId = ThingDataNode.authorId(data);\n  const topic = ThingDataNode.topic(data)\n    .trim()\n    .toLowerCase();\n\n  if (kind === 'submission') {\n    const domain = ThingDataNode.domain(data);\n    const taggedBy = R.compose(\n      R.without(['anon']),\n      R.keysIn,\n      x => (typeof x === 'string' ? {} : x),\n      R.propOr({}, 'commands')\n    )(scores);\n\n    if (topic) listings.push(`/t/${topic}`);\n    if (topic !== 'all') listings.push('/t/all');\n    if (domain) listings.push(`/domain/${domain}`);\n    if (authorId) {\n      listings.push(`/user/${authorId}/submitted`);\n      listings.push(`/user/${authorId}/overview`);\n    }\n\n    taggedBy.forEach(tagAuthorId => listings.push(`/user/${tagAuthorId}/commented`));\n  } else if (kind === 'comment') {\n    const opId = ThingDataNode.opId(data);\n    const replyToId = ThingDataNode.replyToId(data);\n    const isCommand = ThingDataNode.isCommand(data);\n\n    if (opId) listings.push(`/things/${opId}/comments`);\n    if (topic) listings.push(`/t/comments:${topic}`);\n    if (topic !== 'all') listings.push('/t/comments:all');\n\n    if (replyToId) {\n      const replyToThingData = await Query.thingData(scope, replyToId);\n      const replyToAuthorId = ThingDataNode.authorId(replyToThingData);\n\n      if (replyToAuthorId) {\n        const replyToKind = ThingDataNode.kind(replyToThingData);\n        listings.push(`/user/${replyToAuthorId}/replies/overview`);\n        if (replyToKind === 'submission') {\n          listings.push(`/user/${replyToAuthorId}/replies/submitted`);\n        } else if (replyToKind === 'comment') {\n          listings.push(`/user/${replyToAuthorId}/replies/comments`);\n        }\n      }\n    }\n\n    if (authorId) {\n      listings.push(`/user/${authorId}/comments`);\n      listings.push(`/user/${authorId}/overview`);\n      if (isCommand) listings.push(`/user/${authorId}/commands`);\n      // TODO: update commented\n    }\n  } else if (kind === 'chatmsg') {\n    if (topic) listings.push(`/t/chat:${topic}`);\n    if (topic !== 'all') listings.push('/t/chat:all');\n  }\n\n  return listings;\n}\n\nasync function describeThingId(scope: GunScope, thingId: string) {\n  if (!thingId) return;\n  const spec = ListingSpec.fromSource('');\n  const includes: string[] = await getListings(scope, thingId);\n  if (!includes.length) return;\n\n  return {\n    id: thingId,\n    includes,\n    sorts: await Promise.all(\n      R.toPairs(ListingSort.sorts).map(async ([name, sortFn]) => [\n        name,\n        await sortFn(scope, thingId, spec)\n      ])\n    )\n  };\n}\n\nconst descriptionToListingMap = (declarativeUpdate: any) => {\n  const id = R.propOr('', 'id', declarativeUpdate);\n  const includes: string[] = R.propOr([], 'includes', declarativeUpdate);\n  const sorts: [string, number][] = R.propOr([], 'sorts', declarativeUpdate);\n  const results = [];\n\n  for (let i = 0; i < includes.length; i++) {\n    const listing = includes[i];\n\n    for (let j = 0; j < sorts.length; j++) {\n      const [sortName, value] = sorts[j];\n\n      results.push([`${listing}/${sortName}`, [[id, value]]]);\n    }\n  }\n\n  return results;\n};\n\nclass IndexerQueue extends ThingQueue {\n  async processNext() {\n    if (this.processingId) return;\n    const id = (this.processingId = this.dequeue());\n    if (!id) return;\n\n    const startedAt = new Date().getTime();\n\n    try {\n      const scope = this.peer.newScope(this.scopeOpts);\n      const description = await describeThingId(scope, id);\n      const listingMap: any[] = descriptionToListingMap(description);\n\n      // tslint:disable-next-line: await-promise\n      await Promise.all(\n        listingMap.map(async item => {\n          const [listingPath, updatedItems]: [string, [string, number][]] = item;\n          const soul = ListingNode.soulFromPath(Config.indexer, listingPath);\n          const existing = await scope.get(soul).then();\n          const diff = await ListingNode.diff(existing, updatedItems, []);\n          if (!diff) return;\n          console.log('writing', soul, diff);\n          this.peer.gun.get(soul).put(diff);\n        })\n      );\n    } catch (e) {\n      console.error('Indexer error', e.stack || e);\n    }\n\n    const endedAt = new Date().getTime();\n    console.log('indexed', (endedAt - startedAt) / 1000, this.length(), id);\n    this.processingId = '';\n    // tslint:disable-next-line: no-floating-promises\n    this.processNext();\n  }\n\n  onPut(msg: any) {\n    R.compose(\n      R.map(R.tap(([id, isNew]: [string, boolean]) => id && this.enqueue(id, isNew))),\n      R.uniqBy(R.nth(0) as (i: any) => any),\n      R.map((soul: string) => {\n        const meta = R.pathOr({}, ['put', soul, '_', '>'], msg);\n        const latest = R.values(meta)\n          .sort()\n          .pop();\n        const now = new Date().getTime();\n        const age = now - latest;\n        if (age > Config.oracleMaxStaleness) return [];\n        const thingMatch = Schema.Thing.route.match(soul);\n        const thingDataMatch = Schema.ThingDataSigned.route.match(soul);\n        const countsMatch = Schema.ThingVoteCounts.route.match(soul);\n        const thingId: string = R.propOr(\n          '',\n          'thingId',\n          thingMatch || thingDataMatch || countsMatch\n        );\n\n        return [thingId, !countsMatch];\n      }),\n      R.keysIn,\n      R.propOr({}, 'put')\n    )(msg);\n  }\n}\n\nexport const Indexer = {\n  Queue: IndexerQueue,\n  describeThingId\n};\n","import * as R from 'ramda';\nimport { ThingDataMap, CommandMap } from './types';\nimport { Constants } from './Constants';\n\nconst tokenize = R.compose(\n  R.map(R.trim),\n  R.split(' '),\n  R.replace(Constants.COMMAND_RE, ''),\n  R.defaultTo(''),\n  R.nth(0) as (inpt: string[]) => string,\n  R.split('\\n')\n);\n\nconst map = (thingData: ThingDataMap): CommandMap =>\n  R.reduce(\n    (cmdMap, id) => {\n      const body = R.pathOr('', [id, 'body'], thingData);\n      const authorId = R.pathOr('anon', [id, 'authorId'], thingData);\n      const timestamp = parseFloat(R.pathOr('', [id, 'timestamp'], thingData));\n\n      if (!R.test(Constants.COMMAND_RE, body)) return cmdMap;\n      const tokenized = [authorId, ...tokenize(body), id];\n\n      return R.assocPath(tokenized, timestamp || 0, cmdMap);\n    },\n    {},\n    R.keys(thingData)\n  );\n\nexport const CommentCommand = { tokenize, map };\n","import * as R from 'ramda';\nimport { query, all } from 'gun-scope';\nimport { Config } from '../Config';\nimport { GunNode } from '../GunNode';\nimport { Schema } from '../Schema';\nimport { Query } from '../Query';\nimport { CommentCommand } from '../CommentCommand';\nimport { ThingQueue } from './ThingQueue';\nimport { ThingVoteCountsType } from '../types';\n\nconst tabulate = query(async (scope, thingId) => {\n  if (!thingId) return null;\n  const [up, down, comment, replySouls] = await all([\n    scope.get(Schema.ThingVotesUp.route.reverse({ thingId })).count(),\n    scope.get(Schema.ThingVotesDown.route.reverse({ thingId })).count(),\n    scope.get(Schema.ThingAllComments.route.reverse({ thingId })).count(),\n    scope.get(Schema.ThingComments.route.reverse({ thingId })).souls()\n  ]);\n  const thingData = await Query.thingDataFromSouls(scope, replySouls);\n  const result: ThingVoteCountsType = {\n    up,\n    down,\n    comment,\n    replies: replySouls.length,\n    score: up - down\n  };\n\n  if (thingData) {\n    const commandMap = CommentCommand.map(thingData);\n    if (R.keys(commandMap).length) result.commands = JSON.stringify(commandMap);\n  }\n  return result;\n});\n\nclass TabulatorQueue extends ThingQueue {\n  async processNext() {\n    if (this.processingId) return;\n    const thingId = (this.processingId = this.dequeue());\n    const tabulator = this.spec.tabulator;\n    if (!thingId) return;\n    const countsSoul = Schema.ThingVoteCounts.route.reverse({ thingId, tabulator });\n\n    try {\n      const scope = this.peer.newScope(this.scopeOpts);\n      const existingCounts = await scope.get(countsSoul).then();\n      const updatedCounts = await tabulate(scope, thingId);\n      const diff = GunNode.diff(existingCounts, updatedCounts);\n      if (R.keysIn(diff).length) this.peer.gun.get(countsSoul).put(diff);\n    } catch (e) {\n      console.error('Tabulator error', e.stack || e);\n    }\n\n    this.processingId = '';\n    // tslint:disable-next-line: no-floating-promises\n    this.processNext();\n  }\n\n  onPut(msg: any) {\n    R.compose(\n      R.map(R.tap(([id, isNew]: [string, boolean]) => id && this.enqueue(id, isNew))),\n      R.uniqBy(R.nth(0) as (i: any) => any),\n      R.map((soul: string) => {\n        const meta = R.pathOr({}, ['put', soul, '_', '>'], msg);\n        const latest = R.values(meta)\n          .sort()\n          .pop();\n        const now = new Date().getTime();\n        const age = now - latest;\n        if (age > Config.oracleMaxStaleness) return [];\n        const thingMatch = Schema.Thing.route.match(soul);\n        const votesUpMatch = Schema.ThingVotesUp.route.match(soul);\n        const votesDownMatch = Schema.ThingVotesDown.route.match(soul);\n        const allCommentsMatch = Schema.ThingAllComments.route.match(soul);\n        const commentsMatch = Schema.ThingComments.route.match(soul);\n        const thingId: string = R.propOr(\n          '',\n          'thingId',\n          thingMatch || votesUpMatch || votesDownMatch || allCommentsMatch || commentsMatch\n        );\n\n        return [thingId, !(votesUpMatch || votesDownMatch || allCommentsMatch || commentsMatch)];\n      }),\n      R.keysIn,\n      R.propOr({}, 'put')\n    )(msg);\n  }\n}\n\nexport const Tabulator = { Queue: TabulatorQueue, query: tabulate };\n","interface OracleFeature {\n  onPut: (msg: any) => void;\n}\n\nexport class Oracle {\n  peer: any;\n  features: OracleFeature[];\n\n  constructor(peer: any) {\n    this.features = [];\n    this.peer = peer;\n    this.peer.gun.on('put', this.onPut.bind(this));\n  }\n\n  use(feature: OracleFeature) {\n    this.features.push(feature);\n  }\n\n  onPut(msg: any) {\n    for (let i = 0; i < this.features.length; i++) this.features[i].onPut(msg);\n  }\n}\n","import { Validation } from './Validation';\nimport { Query } from './Query';\nimport { Thing } from './Thing';\nimport { Authentication } from './Authentication';\nimport { Indexer } from './Oracle/Indexer';\nimport { Tabulator } from './Oracle/Tabulator';\nimport { Oracle } from './Oracle/Oracle';\n\nfunction init(Gun: any, config: any = {}) {\n  const {\n    leech = false,\n    disableValidation = false,\n    noGun = false,\n    localStorage = false,\n    persist = false,\n    ...rest\n  } = config || {};\n  const peer: any = { config };\n\n  if (!noGun) {\n    const cfg = { localStorage: !!localStorage, radisk: !!persist, ...rest };\n\n    if (persist) cfg.localStorage = false;\n    if (!disableValidation) Gun.on('opt', Validation.gunWireInput(peer));\n    if (cfg.storeFn) cfg.store = cfg.storeFn(cfg); // for indexeddb\n    peer.gun = Gun(cfg);\n    if (cfg.localStorage) peer.gun.on('localStorage:error', (a: any) => a.retry({}));\n    if (leech) {\n      const sendLeech = () => peer.gun._.on('out', { leech: true });\n\n      sendLeech();\n    }\n  }\n\n  let oracle: Oracle;\n  peer.oracle = () => (oracle = oracle || new Oracle(peer));\n  peer.newScope = (opts: any) => Query.createScope(peer, opts);\n  peer.onLogin = Authentication.onLogin(peer);\n  peer.signup = Authentication.signup(peer);\n  peer.login = Authentication.login(peer);\n  peer.logout = () => Authentication.logout(peer);\n  peer.isLoggedIn = () => Authentication.isLoggedIn(peer);\n  peer.submit = Thing.submit(peer);\n  peer.comment = Thing.comment(peer);\n  peer.chat = Thing.chat(peer);\n  peer.writePage = Thing.writePage(peer);\n  peer.vote = Thing.vote(peer);\n  peer.queries = Query;\n\n  peer.index = (scopeOpts: any = { timeout: 5000 }) =>\n    peer.oracle().use(new Indexer.Queue(peer, '', scopeOpts));\n  peer.tabulate = (scopeOpts: any = { timeout: 5000 }) =>\n    peer.oracle().use(new Tabulator.Queue(peer, '', scopeOpts));\n  return peer;\n}\n\nexport const Peer = {\n  init\n};\n","import * as R from 'ramda';\nimport { query, resolve } from 'gun-scope';\nimport { GunScope, ListingSpecType } from './types';\nimport { Config } from './Config';\nimport { Query } from './Query';\nimport { Listing, ListingSpec, ListingType, ListingQuery } from './Listing';\n\nconst wikiPage = R.mergeLeft({\n  withMatch: ({\n    params: { authorId = Config.owner, name }\n  }: {\n    params: { authorId: string; name: string };\n  }) => ({\n    preload: (scope: GunScope) => Query.wikiPage(scope, authorId, name)\n  })\n});\n\nconst withListingMatch = (path: string, params?: any) => {\n  if (!path) {\n    return {\n      preload: query(R.always(resolve({}))),\n      sidebar: query(R.always(resolve(''))),\n      space: query(R.always(resolve(ListingSpec.fromSource('')))),\n      ids: query(R.always(resolve([])))\n    };\n  }\n\n  const view = new ListingQuery(path);\n  const realQuery = query(view.ids.bind(view), `ids:${path}`);\n\n  return {\n    preload: (scope: GunScope) => preloadListing(scope, path, params),\n    sidebar: query(scope => Listing.sidebarFromPath(scope, path), `sidebar:${path}`),\n    space: query(scope => Listing.specFromPath(scope, path)),\n    ids: query((scope, opts = {}) => realQuery(scope, R.mergeLeft(opts, params)))\n  };\n};\n\nconst preloadListing = async (scope: GunScope, path: string, params?: any) => {\n  const match = withListingMatch(path, params);\n  const promise = Promise.all([\n    match.space(scope),\n    match.ids(scope, {}),\n    match.sidebar(scope)\n  ] as Promise<any>[]);\n  let [spec, ids]: [ListingSpecType, string[]] = (await promise) as [ListingSpecType, string[]];\n\n  if (!spec) spec = ListingSpec.fromSource('');\n  const opIds = R.pathOr([], ['filters', 'allow', 'ops'], spec);\n  if (opIds.length) {\n    await Promise.all(\n      opIds.map((id: string) =>\n        Query.thingForDisplay(scope, id, spec.tabulator || Config.tabulator)\n      )\n    );\n  }\n\n  await Promise.all(\n    ids.map(id => Query.thingForDisplay(scope, id, spec.tabulator || Config.tabulator))\n  );\n\n  if (spec.chatTopic) {\n    const chatPath = `/t/${spec.chatTopic}/chat`;\n\n    if (chatPath !== path) await preloadListing(scope, `/t/${spec.chatTopic}/chat`, {});\n  }\n\n  return scope.getCache();\n};\n\nconst listing = ({\n  prefix: defaultPrefix = 't',\n  identifier: defaultIdentifier = 'all',\n  sort: defaultSort = 'hot',\n  ...rest\n} = {}) => ({\n  ...rest,\n  withMatch: ({\n    params: { prefix = defaultPrefix, identifier = defaultIdentifier, sort = defaultSort },\n    query: queryParams = {}\n  }) => withListingMatch(`/${prefix}/${identifier}/${sort}`, queryParams)\n});\n\nconst thingComments = ({\n  prefix: defaultPrefix = 't',\n  identifier: defaultIdentifier = 'all',\n  sort: defaultSort = 'best',\n  ...rest\n} = {}) => ({\n  ...rest,\n  withMatch: ({ params: { opId = '' }, query: queryParams = {} }) =>\n    withListingMatch(\n      ListingType.CommentListing.route.reverse({\n        thingId: opId,\n        sort: R.propOr(defaultSort, 'sort', queryParams)\n      }),\n      R.assoc('limit', 1000, queryParams)\n    )\n});\n\nconst spaceListing = ({\n  name: defaultName = 'default',\n  authorId: defaultAuthorId = '',\n  sort: defaultSort = 'default',\n  ...rest\n} = {}) => ({\n  ...rest,\n  withMatch: ({\n    params: { authorId = defaultAuthorId, name = defaultName, sort = defaultSort },\n    query: queryParams = {}\n  }) =>\n    withListingMatch(\n      ListingType.SpaceListing.route.reverse({\n        authorId: authorId || Config.owner,\n        name,\n        sort\n      }),\n      queryParams\n    )\n});\n\nconst spaceThingComments = ({\n  name: defaultName = 'default',\n  authorId: defaultAuthorId = '',\n  sort: defaultSort = 'hot',\n  ...rest\n}) => ({\n  ...rest,\n  withMatch: ({\n    params: { opId = '', authorId = defaultAuthorId, name = defaultName, sort = defaultSort },\n    query: queryParams = {}\n  }) => {\n    const spacePath = ListingType.SpaceListing.route.reverse({\n      authorId: authorId || Config.owner,\n      name,\n      sort\n    });\n    const listingPath = ListingType.CommentListing.route.reverse({\n      thingId: opId,\n      sort\n    });\n\n    const view = new ListingQuery(listingPath);\n    const idsQuery = query(view.ids.bind(view), `ids:${listingPath}`);\n\n    return {\n      space: query(\n        scope => Listing.specFromPath(scope, spacePath, queryParams),\n        `spec:${spacePath}`\n      ),\n      ids: idsQuery,\n      preload: query(scope => preloadListing(scope, listingPath, queryParams))\n    };\n  }\n});\n\nconst profile = ({ sort: defaultSort = 'new', type: defaultType = 'overview', ...rest } = {}) => ({\n  ...rest,\n  withMatch: ({ params: { authorId = '', type = defaultType, sort = defaultSort }, query = {} }) =>\n    withListingMatch(ListingType.ProfileListing.route.reverse({ authorId, type, sort }), query)\n});\n\nconst inbox = ({ sort: defaultSort = 'new', type: defaultType = 'overview', ...rest } = {}) => ({\n  ...rest,\n  withMatch: ({ authorId = '', params: { type = defaultType, sort = defaultSort }, query = {} }) =>\n    withListingMatch(ListingType.InboxListing.route.reverse({ authorId, type, sort }), query)\n});\n\nexport const Page = {\n  withListingMatch,\n  preloadListing,\n  wikiPage,\n  thingComments,\n  listing,\n  spaceListing,\n  spaceThingComments,\n  profile,\n  inbox\n};\n","import { Peer } from './Peer';\nexport { Config } from './Config';\nexport { Constants } from './Constants';\nexport { CommentCommand } from './CommentCommand';\nexport { Indexer } from './Oracle/Indexer';\nexport { Listing, SpaceSpec } from './Listing';\nexport { Page } from './Page';\nexport { Peer } from './Peer';\nexport { Query } from './Query';\nexport { Schema } from './Schema';\nexport { Thing, ThingSet, ThingDataNode } from './Thing';\nexport { Validation } from './Validation';\nexport { Tabulator } from './Oracle/Tabulator';\n\nexport default Peer.init;\n"],"names":["AUTH_SCHEMA","R.keysIn","R.pathOr","R.assoc","R.compose","R.reduce","R.prop","R.toPairs","R.without","R.keys","R.path","R.propOr","R.dissoc","R.difference","R.omit","sea.initAjv","createSuppressor","R.curry","R.map","R.slice","R.replace","R.split","R.filter","R.sortWith","R.ascend","R.cond","R.isNil","R.always","R.T","R.nth","R.identity","R.addIndex","R.indexBy","R.uniqBy","R.concat","query","resolve","R.last","R.sortBy","R.values","diff","R.equals","R.pick","ids","R.mergeRight","R.test","parseURI","soulToId","soulsToIds","all","makeScope","R.trim","R.assocPath","R.uniq","R.find","R.mergeLeft","fromDefinition","R.identical","R.lte","R.gte","fromSource","R.apply","R.juxt","_a","POS_ID","POS_VAL","R.includes","R.multiply","R.toLower","R.defaultTo","R.ifElse","getSource","R.pipe","path","tabs","getSpec","R.match","R.of","tslib_1.__extends","R.tap","tokenize","wikiPage"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAA,IAAM,UAAU,GAAG,QAAQ,CAAC;IAC5B,IAAM,MAAM,GAAG,KAAK,CAAC;IACrB,IAAM,cAAc,GAAG,MAAM,CAAC;IAE9B,IAAM,YAAY,GAAG,IAAI,CAAC;IAE1B,IAAM,aAAa,GAAG,EAAE,CAAC;IACzB,IAAM,kBAAkB,GAAG,EAAE,CAAC;IAC9B,IAAM,cAAc,GAAG,EAAE,CAAC;IAC1B,IAAM,qBAAqB,GAAG,GAAG,CAAC;IAClC,IAAM,kBAAkB,GAAG,GAAG,CAAC;IAC/B,IAAM,YAAY,GAAG,IAAI,CAAC;IAC1B,IAAM,eAAe,GAAG,GAAG,CAAC;IAC5B,IAAM,mBAAmB,GAAG,EAAE,CAAC;IAC/B,IAAM,oBAAoB,GAAG,GAAG,CAAC;IACjC,IAAM,mBAAmB,GAAG,KAAK,CAAC;IAElC,IAAM,oBAAoB,GAAG,KAAK,CAAC;IACnC,IAAM,uBAAuB,GAAG,KAAK,CAAC;IACtC,IAAM,qBAAqB,GAAG,IAAI,CAAC;IAEnC,IAAM,4BAA4B,GAAG,cAAc,CAAC;IACpD,IAAM,gCAAgC,GAAG,kBAAkB,CAAC;IAC5D,IAAM,0BAA0B,GAAG,EAAE,CAAC;IACtC,IAAM,0BAA0B,GAAG,cAAc,CAAC;IAClD,IAAM,0BAA0B,GAAG,EAAE,CAAC;IAEtC,IAAM,kBAAkB,GAAG,EAAE,CAAC;IAE9B,IAAM,OAAO,GACX,yFAAyF,CAAC;AAE5F,QAAa,SAAS,GAAG;QACvB,UAAU,YAAA;QACV,MAAM,QAAA;QACN,cAAc,gBAAA;QACd,YAAY,cAAA;QACZ,aAAa,eAAA;QACb,kBAAkB,oBAAA;QAClB,cAAc,gBAAA;QACd,qBAAqB,uBAAA;QACrB,kBAAkB,oBAAA;QAClB,YAAY,cAAA;QACZ,eAAe,iBAAA;QACf,mBAAmB,qBAAA;QACnB,oBAAoB,sBAAA;QACpB,mBAAmB,qBAAA;QACnB,oBAAoB,sBAAA;QACpB,uBAAuB,yBAAA;QACvB,qBAAqB,uBAAA;QACrB,4BAA4B,8BAAA;QAC5B,gCAAgC,kCAAA;QAChC,0BAA0B,4BAAA;QAC1B,0BAA0B,4BAAA;QAC1B,0BAA0B,4BAAA;QAC1B,kBAAkB,oBAAA;QAClB,OAAO,SAAA;KACR;;ICnDD,IAAM,WAAW,gBACZA,eAAW,IACd,SAAS,EAAE;YACT,IAAI,EAAE,QAAQ;YACd,SAAS,EAAE,CAAC;YACZ,SAAS,EAAE,SAAS,CAAC,cAAc;SACpC,EAED,QAAQ,EAAE;YACR,KAAK,EAAE,WAAW;YAClB,WAAW,EAAE,mCAAmC;YAChD,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,8CAA2C;gBACvE,UAAU,EAAE;oBACV,SAAS,EAAE,EAAE,IAAI,EAAE,oCAAoC,EAAE;oBACzD,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE;oBACtD,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE;oBAClD,GAAG,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE;iBACjD;gBACD,QAAQ,EAAE,CAAC,WAAW,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,CAAC;aAChD;YACD,aAAa,EAAE,EAAE,IAAI,EAAE,WAAW,EAAE;YACpC,UAAU,EAAE;gBACV,IAAI,EAAE;oBACJ,WAAW,EAAE,2BAA2B;oBACxC,IAAI,EAAE,QAAQ;iBACf;aACF;YACD,oBAAoB,EAAE;gBACpB,cAAc,EAAE,IAAI;gBACpB,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,yBAAyB,EAAE,EAAE,EAAE,IAAI,EAAE,yBAAyB,EAAE,CAAC;aAClF;SACF,EAED,KAAK,EAAE;YACL,KAAK,EAAE,OAAO;YACd,WAAW,EAAE,uBAAuB;YACpC,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,uBAAoB;gBAChD,UAAU,EAAE;oBACV,SAAS,EAAE,EAAE,IAAI,EAAE,oCAAoC,EAAE;iBAC1D;gBACD,QAAQ,EAAE,CAAC,WAAW,CAAC;aACxB;YACD,aAAa,EAAE,EAAE,IAAI,EAAE,WAAW,EAAE;YACpC,UAAU,EAAE;gBACV,IAAI,EAAE;oBACJ,WAAW,EAAE,2BAA2B;oBACxC,IAAI,EAAE,QAAQ;iBACf;aACF;YACD,oBAAoB,EAAE;gBACpB,cAAc,EAAE,IAAI;gBACpB,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,yBAAyB,EAAE,EAAE,EAAE,IAAI,EAAE,yBAAyB,EAAE,CAAC;aAClF;SACF,EAED,UAAU,EAAE;YACV,IAAI,EAAE,QAAQ;YACd,SAAS,EAAE,CAAC;YACZ,SAAS,EAAE,SAAS,CAAC,eAAe;SACrC,EAED,MAAM,EAAE;YACN,KAAK,EAAE,QAAQ;YACf,WAAW,EAAE,wBAAwB;YACrC,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,yBAAsB;gBAClD,UAAU,EAAE;oBACV,UAAU,EAAE,EAAE,IAAI,EAAE,qCAAqC,EAAE;iBAC5D;gBACD,QAAQ,EAAE,CAAC,YAAY,CAAC;aACzB;YACD,oBAAoB,EAAE;gBACpB,cAAc,EAAE,IAAI;gBACpB,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,yBAAyB,EAAE,CAAC;aAC7C;SACF,EAED,GAAG,EAAE,EAAE,IAAI,EAAE,CAAC,MAAM,EAAE,QAAQ,CAAC,EAAE,SAAS,EAAE,SAAS,CAAC,YAAY,EAAE,EACpE,GAAG,EAAE;YACH,KAAK,EAAE,KAAK;YACZ,WAAW,EAAE,4BAA4B;YACzC,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,eAAa;gBACzC,UAAU,EAAE;oBACV,GAAG,EAAE,EAAE,IAAI,EAAE,8BAA8B,EAAE;iBAC9C;gBACD,QAAQ,EAAE,CAAC,KAAK,CAAC;aAClB;YACD,oBAAoB,EAAE;gBACpB,cAAc,EAAE,IAAI;gBACpB,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,yBAAyB,EAAE,CAAC;aAC7C;SACF,EAED,OAAO,EAAE;YACP,IAAI,EAAE,QAAQ;YACd,SAAS,EAAE,SAAS,CAAC,aAAa;SACnC,EAED,SAAS,EAAE;YACT,UAAU,EAAE;gBACV,OAAO,EAAE,EAAE,MAAM,EAAE,sBAAsB,EAAE;aAC5C;SACF,EAED,gBAAgB,EAAE;YAChB,KAAK,EAAE,oBAAoB;YAC3B,WAAW,EAAE,qCAAqC;YAClD,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,iCAA8B;gBAC1D,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,oCAAoC,EAAE,CAAC;aACxD;YACD,oBAAoB,EAAE;gBACpB,cAAc,EAAE,IAAI;gBACpB,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,yBAAyB,EAAE,CAAC;aAC7C;SACF,EAED,aAAa,EAAE;YACb,KAAK,EAAE,gBAAgB;YACvB,WAAW,EAAE,2BAA2B;YACxC,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,8BAA2B;gBACvD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,oCAAoC,EAAE,CAAC;aACxD;YACD,oBAAoB,EAAE;gBACpB,cAAc,EAAE,IAAI;gBACpB,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,yBAAyB,EAAE,CAAC;aAC7C;SACF,EAED,SAAS,EAAE,EAAE,IAAI,EAAE,CAAC,QAAQ,EAAE,QAAQ,CAAC,EAAE,EACzC,SAAS,EAAE;YACT,IAAI,EAAE,QAAQ;YACd,SAAS,EAAE,SAAS,CAAC,mBAAmB;SACzC,EAED,KAAK,EAAE;YACL,KAAK,EAAE,iBAAiB;YACxB,WAAW,EAAE,+DAA+D;YAC5E,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,qBAAkB;gBAC9C,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,oCAAoC,EAAE,CAAC;aACxD;YACD,aAAa,EAAE,EAAE,EAAE,EAAE,SAAS,EAAE;YAChC,UAAU,EAAE;gBACV,EAAE,EAAE,EAAE,IAAI,EAAE,uBAAuB,EAAE;gBACrC,IAAI,EAAE,EAAE,MAAM,EAAE,yBAAyB,EAAE;gBAC3C,SAAS,EAAE,EAAE,IAAI,EAAE,yBAAyB,EAAE;gBAC9C,YAAY,EAAE,EAAE,IAAI,EAAE,uBAAuB,EAAE;gBAC/C,IAAI,EAAE;oBACJ,KAAK,EAAE;wBACL,EAAE,IAAI,EAAE,6BAA6B,EAAE;wBACvC,EAAE,IAAI,EAAE,mCAAmC,EAAE;qBAC9C;iBACF;gBACD,KAAK,EAAE;oBACL,KAAK,EAAE;wBACL,EAAE,IAAI,EAAE,yBAAyB,EAAE;wBACnC;4BACE,WAAW,EAAE,yCAAyC;4BACtD,IAAI,EAAE,QAAQ;4BACd,oBAAoB,EAAE,KAAK;4BAC3B,UAAU,EAAE;gCACV,GAAG,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,EAAE,EAAE;6BACvC;4BACD,QAAQ,EAAE,CAAC,GAAG,CAAC;yBAChB;qBACF;iBACF;gBACD,MAAM,EAAE,EAAE,IAAI,EAAE,0BAA0B,EAAE;gBAC5C,GAAG,EAAE,EAAE,IAAI,EAAE,uBAAuB,EAAE;gBACtC,QAAQ,EAAE,EAAE,gBAAgB,EAAE,eAAe,EAAE;gBAC/C,WAAW,EAAE,EAAE,gBAAgB,EAAE,kBAAkB,EAAE;gBACrD,OAAO,EAAE,EAAE,gBAAgB,EAAE,cAAc,EAAE;gBAC7C,SAAS,EAAE,EAAE,gBAAgB,EAAE,gBAAgB,EAAE;gBACjD,EAAE,EAAE,EAAE,IAAI,EAAE,yBAAyB,EAAE;gBACvC,OAAO,EAAE,EAAE,IAAI,EAAE,yBAAyB,EAAE;gBAC5C,MAAM,EAAE,EAAE,IAAI,EAAE,6BAA6B,EAAE;aAChD;YAED,KAAK,EAAE;gBACL;oBACE,KAAK,EAAE;wBACL;4BACE,oBAAoB,EAAE,IAAI;yBAC3B;wBACD;4BACE,KAAK,EAAE,CAAC,EAAE,2BAA2B,EAAE,IAAI,EAAE,EAAE,EAAE,4BAA4B,EAAE,IAAI,EAAE,CAAC;yBACvF;qBACF;iBACF;gBACD,EAAE,aAAa,EAAE,IAAI,EAAE;gBACvB;oBACE,oBAAoB,EAAE,KAAK;oBAC3B,WAAW,EAAE,4CAA4C;oBACzD,UAAU,EAAE;wBACV,EAAE,EAAE,EAAE,IAAI,EAAE,uBAAuB,EAAE;wBACrC,QAAQ,EAAE,EAAE,gBAAgB,EAAE,eAAe,EAAE;wBAC/C,WAAW,EAAE,EAAE,gBAAgB,EAAE,kBAAkB,EAAE;wBACrD,OAAO,EAAE,EAAE,gBAAgB,EAAE,cAAc,EAAE;wBAC7C,SAAS,EAAE,EAAE,gBAAgB,EAAE,gBAAgB,EAAE;qBAClD;iBACF;aACF;SACF,EAED,gBAAgB,EAAE;YAChB,MAAM,EAAE,IAAI;YACZ,mBAAmB,EAAE;gBACnB,SAAS,EAAE,SAAS;gBACpB,MAAM,EAAE;oBACN,UAAU,EAAE,CAAC;oBACb,UAAU,EAAE,EAAE;oBACd,QAAQ,EAAE,CAAC;oBACX,UAAU,EAAE,KAAK;oBACjB,WAAW,EAAE,CAAC;iBACf;aACF;SACF,EAED,YAAY,EAAE;YACZ,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,6BAA0B;gBACtD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,oCAAoC,EAAE,CAAC;aACxD;YACD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,gCAAgC,EAAE,CAAC;SACpD,EAED,cAAc,EAAE;YACd,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,+BAA4B;gBACxD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,oCAAoC,EAAE,CAAC;aACxD;YACD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,gCAAgC,EAAE,CAAC;SACpD,EAED,SAAS,EAAE;YACT,KAAK,EAAE,qBAAqB;YAC5B,WAAW,EAAE,uCAAuC;YACpD,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,0BAAuB;gBACnD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,oCAAoC,EAAE,CAAC;gBACvD,QAAQ,EAAE,CAAC,SAAS,CAAC;aACtB;YACD,UAAU,EAAE;gBACV,IAAI,EAAE,EAAE,IAAI,EAAE,yBAAyB,EAAE;gBACzC,KAAK,EAAE;oBACL,IAAI,EAAE,QAAQ;oBACd,SAAS,EAAE,CAAC;oBACZ,SAAS,EAAE,SAAS,CAAC,oBAAoB;iBAC1C;gBACD,KAAK,EAAE,EAAE,IAAI,EAAE,yBAAyB,EAAE;gBAC1C,IAAI,EAAE;oBACJ,IAAI,EAAE,CAAC,MAAM,EAAE,QAAQ,CAAC;oBACxB,SAAS,EAAE,SAAS,CAAC,mBAAmB;iBACzC;gBACD,MAAM,EAAE,EAAE,IAAI,EAAE,wBAAwB,EAAE;gBAC1C,QAAQ,EAAE,EAAE,IAAI,EAAE,2BAA2B,EAAE;gBAC/C,IAAI,EAAE,EAAE,IAAI,EAAE,uBAAuB,EAAE;gBACvC,SAAS,EAAE,EAAE,IAAI,EAAE,uBAAuB,EAAE;gBAC5C,MAAM,EAAE,EAAE,IAAI,EAAE,0BAA0B,EAAE;gBAC5C,GAAG,EAAE,EAAE,IAAI,EAAE,mBAAmB,EAAE;gBAClC,SAAS,EAAE,EAAE,IAAI,EAAE,yBAAyB,EAAE;aAC/C;YACD,wBAAwB,EAAE,IAAI;SAC/B,EAED,eAAe,EAAE;YACf,KAAK,EAAE,mBAAmB;YAC1B,WAAW,EAAE,iEAAiE;YAC9E,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,qCAAkC;gBAC9D,UAAU,EAAE;oBACV,OAAO,EAAE,EAAE,IAAI,EAAE,kCAAkC,EAAE;oBACrD,QAAQ,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;iBAC3D;gBACD,QAAQ,EAAE,CAAC,SAAS,EAAE,UAAU,CAAC;aAClC;YACD,UAAU,EAAE;gBACV,IAAI,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,oCAAoC,EAAE,EAAE;gBAC7D,KAAK,EAAE;oBACL,GAAG,EAAE;wBACH,IAAI,EAAE,QAAQ;wBACd,SAAS,EAAE,CAAC;wBACZ,SAAS,EAAE,SAAS,CAAC,oBAAoB;qBAC1C;iBACF;gBACD,KAAK,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,oCAAoC,EAAE,EAAE;gBAC9D,IAAI,EAAE;oBACJ,GAAG,EAAE;wBACH,IAAI,EAAE,CAAC,MAAM,EAAE,QAAQ,CAAC;wBACxB,SAAS,EAAE,SAAS,CAAC,mBAAmB;qBACzC;iBACF;gBACD,MAAM,EAAE;oBACN,GAAG,EAAE,EAAE,IAAI,EAAE,mCAAmC,EAAE;iBACnD;gBACD,QAAQ,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE,EAAE;gBACnE,IAAI,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,kCAAkC,EAAE,EAAE;gBAC3D,SAAS,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,kCAAkC,EAAE,EAAE;gBAChE,MAAM,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,qCAAqC,EAAE,EAAE;gBAChE,GAAG,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,8BAA8B,EAAE,EAAE;gBACtD,SAAS,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,oCAAoC,EAAE,EAAE;aACnE;SACF,EAED,eAAe,EAAE;YACf,KAAK,EAAE,mBAAmB;YAC1B,WAAW,EAAE,oCAAoC;YACjD,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,6CAA0C;gBACtE,UAAU,EAAE;oBACV,OAAO,EAAE,EAAE,IAAI,EAAE,kCAAkC,EAAE;oBACrD,SAAS,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;iBAC5D;aACF;YACD,UAAU,EAAE;gBACV,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,CAAC,QAAQ,EAAE,QAAQ,CAAC,EAAE,EAAE;gBAC3C,IAAI,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,CAAC,QAAQ,EAAE,QAAQ,CAAC,EAAE,EAAE;gBAC7C,OAAO,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,CAAC,QAAQ,EAAE,QAAQ,CAAC,EAAE,EAAE;gBAChD,KAAK,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,CAAC,QAAQ,EAAE,QAAQ,CAAC,EAAE,EAAE;gBAC9C,QAAQ,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,CAAC,QAAQ,EAAE,QAAQ,CAAC,EAAE,EAAE;aAClD;SACF,EAED,WAAW,EAAE;YACX,MAAM,EAAE,IAAI;YACZ,KAAK,EAAE,mBAAmB;YAC1B,WAAW,EAAE,0CAA0C;YACvD,IAAI,EAAE,QAAQ;YACd,UAAU,EAAE;gBACV,CAAC,EAAE;oBACD,oBAAoB,EAAE,IAAI;iBAC3B;aACF;YACD,iBAAiB,EAAE;gBACjB,MAAM,EAAE,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,WAAW,CAAC,EAAE,EAAE;aAC3D;YAED,oBAAoB,EAAE,IAAI;YAC1B,oBAAoB,EAAE,IAAI;SAC3B,EAED,QAAQ,EAAE;YACR,IAAI,EAAE,QAAQ;YACd,IAAI,EAAE;gBACJ,KAAK;gBACL,KAAK;gBACL,QAAQ;gBACR,KAAK;gBACL,UAAU;gBACV,WAAW;gBACX,KAAK;gBACL,MAAM;gBACN,eAAe;gBACf,QAAQ;gBACR,UAAU;gBACV,MAAM;aACP;SACF,EAED,YAAY,EAAE;YACZ,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,+BAA4B;gBACxD,QAAQ,EAAE,CAAC,OAAO,EAAE,MAAM,EAAE,SAAS,CAAC;gBACtC,UAAU,EAAE;oBACV,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;oBACzB,IAAI,EAAE,EAAE,IAAI,EAAE,mCAAmC,EAAE;oBACnD,OAAO,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;iBAC1D;aACF;YACD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,2BAA2B,EAAE,CAAC;SAC/C,EAED,aAAa,EAAE;YACb,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,qCAAkC;gBAC9D,QAAQ,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,SAAS,CAAC;gBACvC,UAAU,EAAE;oBACV,MAAM,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;oBAC1B,IAAI,EAAE,EAAE,IAAI,EAAE,mCAAmC,EAAE;oBACnD,OAAO,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;iBAC1D;aACF;YACD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,2BAA2B,EAAE,CAAC;SAC/C,EAED,oBAAoB,EAAE;YACpB,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,+CAA4C;gBACxE,UAAU,EAAE;oBACV,OAAO,EAAE,EAAE,IAAI,EAAE,kCAAkC,EAAE;oBACrD,IAAI,EAAE,EAAE,IAAI,EAAE,mCAAmC,EAAE;oBACnD,OAAO,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;iBAC1D;aACF;YACD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,2BAA2B,EAAE,CAAC;SAC/C,EAED,eAAe,EAAE;YACf,IAAI,EAAE,QAAQ;YACd,IAAI,EAAE,CAAC,UAAU,EAAE,WAAW,EAAE,UAAU,EAAE,UAAU,EAAE,WAAW,CAAC;SACrE,EAED,oBAAoB,EAAE;YACpB,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,mDAAgD;gBAC5E,UAAU,EAAE;oBACV,QAAQ,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;oBAC1D,IAAI,EAAE,EAAE,IAAI,EAAE,mCAAmC,EAAE;oBACnD,OAAO,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;oBACzD,IAAI,EAAE,EAAE,IAAI,EAAE,0CAA0C,EAAE;iBAC3D;aACF;YACD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,2BAA2B,EAAE,CAAC;SAC/C,EAED,oBAAoB,EAAE;YACpB,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,2CAAwC;gBACpE,UAAU,EAAE;oBACV,QAAQ,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;oBAC1D,IAAI,EAAE,EAAE,IAAI,EAAE,mCAAmC,EAAE;oBACnD,OAAO,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;oBACzD,IAAI,EAAE,EAAE,IAAI,EAAE,0CAA0C,EAAE;iBAC3D;aACF;YACD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,2BAA2B,EAAE,CAAC;SAC/C,EAED,YAAY,EAAE;YACZ,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,kDAA+C;gBAC3E,UAAU,EAAE;oBACV,QAAQ,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;oBAC1D,IAAI,EAAE,EAAE,IAAI,EAAE,mCAAmC,EAAE;oBACnD,OAAO,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;oBACzD,IAAI,EAAE,EAAE,IAAI,EAAE,oCAAoC,EAAE;iBACrD;aACF;YACD,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,2BAA2B,EAAE,CAAC;SAC/C,EAED,cAAc,EAAE;YACd,KAAK,EAAE,mBAAmB;YAC1B,WAAW,EAAE,kDAAkD;YAC/D,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,yBAAsB;gBAClD,UAAU,EAAE;oBACV,QAAQ,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;iBAC3D;gBACD,QAAQ,EAAE,CAAC,UAAU,CAAC;aACvB;YACD,oBAAoB,EAAE;gBACpB,GAAG,EAAE;oBACH,cAAc,EAAE,IAAI;oBACpB,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,oCAAoC,EAAE,CAAC;iBACxD;aACF;SACF,EAED,iBAAiB,EAAE;YACjB,KAAK,EAAE,sBAAsB;YAC7B,WAAW,EAAE,sDAAsD;YACnE,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,4BAAyB;gBACrD,UAAU,EAAE;oBACV,QAAQ,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;iBAC3D;gBACD,QAAQ,EAAE,CAAC,UAAU,CAAC;aACvB;SACF,EAED,YAAY,EAAE;YACZ,KAAK,EAAE,iBAAiB;YACxB,WAAW,EAAE,iDAAiD;YAC9D,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,uBAAoB;gBAChD,UAAU,EAAE;oBACV,QAAQ,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;iBAC3D;gBACD,QAAQ,EAAE,CAAC,UAAU,CAAC;aACvB;YACD,oBAAoB,EAAE;gBACpB,GAAG,EAAE;oBACH,cAAc,EAAE,IAAI;oBACpB,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,oCAAoC,EAAE,CAAC;iBACxD;aACF;SACF,EAED,WAAW,EAAE;YACX,KAAK,EAAE,iBAAiB;YACxB,WAAW,EAAE,iCAAiC;YAC9C,IAAI,EAAE;gBACJ,OAAO,EAAK,SAAS,CAAC,MAAM,sBAAmB;gBAC/C,UAAU,EAAE;oBACV,QAAQ,EAAE,EAAE,IAAI,EAAE,sCAAsC,EAAE;iBAC3D;gBACD,QAAQ,EAAE,CAAC,UAAU,CAAC;aACvB;YACD,oBAAoB,EAAE;gBACpB,GAAG,EAAE;oBACH,cAAc,EAAE,IAAI;oBACpB,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,oCAAoC,EAAE,CAAC;iBACxD;aACF;SACF,GACF,CAAC;IAMF,IAAM,MAAM,GAAaC,QAAQ,CAAC,WAAW,CAAC,CAAC,MAAM,CAAC,UAAC,MAAW,EAAE,IAAY;QAC9E,IAAM,OAAO,GAAGC,QAAQ,CAAC,EAAE,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,SAAS,CAAC,EAAE,WAAW,CAAC,CAAC;QAErE,IAAI,CAAC,OAAO;YAAE,OAAO,MAAM,CAAC;QAC5B,OAAOC,OAAO,CAAC,IAAI,EAAE,IAAI,KAAK,CAAC,OAAO,CAAC,EAAE,MAAM,CAAC,CAAC;IACnD,CAAC,EAAE,WAAW,CAAC,CAAC;IAEhB,IAAM,cAAc,GAAsBC,SAAS,CACjDC,QAAQ,CACN,UAAC,GAAG,EAAE,EAAa;YAAZ,YAAI,EAAE,aAAK;QAAM,OAAAF,OAAO,CAAC,IAAI,EAAEA,OAAO,CAAC,OAAO,EAAE,KAAK,EAAEG,MAAM,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC,EAAE,GAAG,CAAC;IAAtE,CAAsE,EAC9F,EAAE,CACH,EACDC,SAA+C,CAChD,CAAC,MAAM,CAAC,CAAC;AAEV,QAAa,MAAM,GAAG;QACpB,SAAS,EAAE,cAAc,CAAC,SAAS;QACnC,QAAQ,EAAE,cAAc,CAAC,QAAQ;QACjC,KAAK,EAAE,cAAc,CAAC,KAAK;QAC3B,MAAM,EAAE,cAAc,CAAC,MAAM;QAC7B,GAAG,EAAE,cAAc,CAAC,GAAG;QACvB,gBAAgB,EAAE,cAAc,CAAC,gBAAgB;QACjD,aAAa,EAAE,cAAc,CAAC,aAAa;QAC3C,KAAK,EAAE,cAAc,CAAC,KAAK;QAC3B,YAAY,EAAE,cAAc,CAAC,YAAY;QACzC,cAAc,EAAE,cAAc,CAAC,cAAc;QAC7C,SAAS,EAAE,cAAc,CAAC,SAAS;QACnC,eAAe,EAAE,cAAc,CAAC,eAAe;QAC/C,eAAe,EAAE,cAAc,CAAC,eAAe;QAC/C,YAAY,EAAE,cAAc,CAAC,YAAY;QACzC,aAAa,EAAE,cAAc,CAAC,aAAa;QAC3C,oBAAoB,EAAE,cAAc,CAAC,oBAAoB;QACzD,oBAAoB,EAAE,cAAc,CAAC,oBAAoB;QACzD,oBAAoB,EAAE,cAAc,CAAC,oBAAoB;QACzD,YAAY,EAAE,cAAc,CAAC,YAAY;QACzC,cAAc,EAAE,cAAc,CAAC,cAAc;QAC7C,iBAAiB,EAAE,cAAc,CAAC,iBAAiB;QACnD,YAAY,EAAE,cAAc,CAAC,YAAY;QACzC,WAAW,EAAE,cAAc,CAAC,WAAW;QACvC,WAAW,aAAA;QACX,MAAM,QAAA;KACP;;IC7iBD,IAAM,aAAa,GAAG,UAAC,OAAY,EAAE,IAAiB;QACpD,IAAM,QAAQ,GAAGL,QAAQ,CAAC,EAAE,EAAE,CAAC,MAAM,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;QACnD,IAAM,MAAM,GAAGM,SAAS,CACtB,CAAC,UAAU,EAAE,aAAa,EAAE,SAAS,EAAE,WAAW,CAAC,EACnDC,MAAM,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,CACjC;aACE,GAAG,CAAC,UAAA,GAAG,IAAI,OAAAA,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,GAAA,CAAC;aACzC,IAAI,EAAE;aACN,GAAG,EAAE,CAAC;QACT,IAAM,OAAO,GAAGC,QAAQ,CAAC,EAAE,EAAE,SAAS,EAAE,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;QAChF,IAAM,EAAE,GAAGL,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAE9B,OAAO,EAAE,IAAI,EAAE,KAAK,OAAO,IAAI,MAAM,IAAI,MAAM,GAAG,aAAa,CAAC;IAClE,CAAC,CAAC;IAEF,IAAM,oBAAoB,GAAG,UAAC,OAAY,EAAE,IAAiB;QAC3D,IAAM,EAAE,GAAGA,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAE9B,QACE,EAAE;YACF,EAAE;gBACA,OAAO,CAAC;oBACN,QAAQ,EAAE,CAACJ,QAAQ,CAAC,EAAE,EAAE,CAAC,QAAQ,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,IAAI,SAAS;oBAC5E,SAAS,EAAE,QAAQ,CAACI,MAAM,CAAC,WAAW,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC;oBAClD,IAAI,EAAEA,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC;oBAC1B,KAAK,EAAEK,QAAQ,CACb,SAAS,EACT,WAAW,EACX,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAACT,QAAQ,CAAC,EAAE,EAAE,CAAC,OAAO,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,CAC7D;oBACD,IAAI,EAAES,QAAQ,CACZ,SAAS,EACT,SAAS,EACT,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAACT,QAAQ,CAAC,EAAE,EAAE,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,CAC1D;oBACD,SAAS,EAAES,QAAQ,CACjB,SAAS,EACT,SAAS,EACT,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAACT,QAAQ,CAAC,EAAE,EAAE,CAAC,SAAS,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,CAC/D;oBACD,YAAY,EAAEI,MAAM,CAAC,cAAc,EAAE,IAAI,CAAC;iBAC3C,CAAC,EACJ;IACJ,CAAC,CAAC;IAEF,IAAM,sBAAsB,GAAG,UAAC,OAAY,EAAE,IAAiB;QAC7D,IAAM,QAAQ,GAAG,CAACJ,QAAQ,CAAC,EAAE,EAAE,CAAC,QAAQ,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,IAAI,SAAS,CAAC;QACpF,IAAM,QAAQ,GAAGS,QAAQ,CACvB,EAAE,EACF,UAAU,EACV,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,KAAK,CAACT,QAAQ,CAAC,EAAE,EAAE,CAAC,MAAM,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,CACtE,CAAC;QAEF,OAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ,CAAC;IAC3C,CAAC,CAAC;IAEF,IAAM,4BAA4B,GAAG,UAAC,OAAY,EAAE,IAAiB;QACnE,IAAM,YAAY,GAAGI,MAAM,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QAClD,IAAM,EAAE,GAAGK,QAAQ,CACjB,EAAE,EACF,SAAS,EACT,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAACT,QAAQ,CAAC,EAAE,EAAE,CAAC,MAAM,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,CAChE,CAAC;QAEF,OAAO,EAAE,IAAI,EAAE,KAAK,YAAY,CAAC;IACnC,CAAC,CAAC;IAEF,IAAM,qBAAqB,GAAG,UAAC,GAAQ,IAAK,OAAA,UAC1C,YAAoB,EACpB,IAAS,EACT,QAAa,EACb,MAAW,EACX,UAAe;QAEf,IAAM,OAAO,GAAGS,QAAQ,CACtB,EAAE,EACF,SAAS,EACT,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAACD,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,EAAE,CAAC,CAC/D,CAAC;QACF,IAAM,QAAQ,GAAmBC,QAAQ,CAAC,IAAI,EAAE,YAAY,EAAE,MAAM,CAAC,CAAC;QACtE,IAAM,WAAW,GAAGA,QAAQ,CAAC,EAAE,EAAE,SAAS,EAAE,QAAQ,CAAC,KAAK,CAAC,KAAK,CAACA,QAAQ,CAAC,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;QAE3F,IAAI,CAAC,OAAO,IAAI,OAAO,KAAK,WAAW;YAAE,OAAO,KAAK,CAAC;QACtD,OAAO,GAAG,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,8BAA4B,YAAY,SAAM,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC;IACrF,CAAC,GAAA,CAAC;IAEF,IAAM,oBAAoB,GAAG,UAAC,OAAY,EAAE,IAAS;QACnD,IAAM,MAAM,GAAsBC,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QAEtD,MAAM,CAAC,SAAS,GAAG,UAAU,CAAC,MAAM,CAAC,SAAmB,CAAC,CAAC;QAC1D,IAAM,OAAO,GAAGD,QAAQ,CACtB,EAAE,EACF,SAAS,EACT,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAACD,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC,CAC7D,CAAC;QACF,OAAO,OAAO,IAAI,OAAO,KAAK,OAAO,CAAC,MAAM,CAAC,CAAC;IAChD,CAAC,CAAC;IAEF,IAAM,WAAW,GAAG,UAAC,MAAW,EAAE,MAAW,EAAE,MAAc,EAAE,IAAY;QACnE,IAAA,iBAAqD,EAAnD,iBAAqB,EAArB,0CAAqB,EAAE,cAAW,EAAX,gCAA4B,CAAC;;QAG5D,IAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;;QAEvC,IAAM,IAAI,GAAG,KAAK,CAAC;QAEnB,IAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE;YAC/B,IAAI,MAAA;YACJ,UAAU,EAAE,MAAM,CAAC,UAAU;YAC7B,QAAQ,EAAE,MAAM,CAAC,QAAQ;YACzB,UAAU,EAAE,MAAM,CAAC,UAAU;YAC7B,WAAW,EAAE,MAAM,CAAC,WAAW;YAC/B,GAAG,EAAE,IAAI;YACT,IAAI,EAAE,MAAM,CAAC,SAAS,CAAC;SACxB,CAAC,CAAC;QACH,IAAI,GAAG,GAAG,CAAC,CAAC;QACZ,IAAI,CAAC,CAAC;QAEN,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,UAAU,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,EAAE;YACrD,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;gBAAE,OAAO,KAAK,CAAC;SACnC;QACD,IAAM,IAAI,GAAG,IAAI,KAAK,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC;QAEjD,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,MAAM,CAAC,CAAC;IAClC,CAAC,CAAC;IAEF,IAAM,mBAAmB,GAAG,UAAC,MAAW,EAAE,IAAS;QACjD,IAAM,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;QAEjC,IAAI,CAAC,MAAM;YAAE,OAAO,IAAI,CAAC;QACjB,IAAA,6BAAqB,EAArB,0CAAqB,CAAkB;QAC/C,IAAM,MAAM,GAAGR,QAAQ,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;QAE9C,IAAI,SAAS,KAAK,SAAS,EAAE;YAC3B,MAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC;SAC1D;QAEDM,SAAS,CAAC,CAAC,GAAG,CAAC,EAAEP,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,UAAA,IAAI;YAC3C,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE;gBAC9C,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;gBAC1C,OAAO,IAAI,CAAC,IAAI,CAAC,CAAC;aACnB;SACF,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;IACd,CAAC,CAAC;IAEF,IAAM,oBAAoB,GAAG,UAAC,MAAW,EAAE,IAAS;QAClD,IAAM,IAAI,GAAGO,SAAS,CAAC,CAAC,GAAG,CAAC,EAAEP,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;QAC9C,IAAM,IAAI,GAAGC,QAAQ,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;QAE5C,IAAI,CAAC,OAAO,CAAC,UAAA,GAAG;YACd,IAAM,GAAG,GAAG,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;YAE9B,IAAI,CAAC,GAAG,IAAI,GAAG,KAAK,CAAC,EAAE;gBACrB,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC;gBACjB,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC;aAClB;SACF,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;IACd,CAAC,CAAC;IAEF,IAAM,oBAAoB,GAAG,UAAC,MAAW,EAAE,IAAS;QAClD,IAAM,IAAI,GAAGM,SAAS,CAAC,CAAC,GAAG,CAAC,EAAEP,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;QAC9C,IAAM,IAAI,GAAGC,QAAQ,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;QAC5C,IAAM,QAAQ,GAAGD,QAAQ,CAAC,IAAI,CAAC,CAAC;QAChC,IAAM,OAAO,GAAGY,YAAY,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;QAE7C,IAAI,OAAO,CAAC,MAAM;YAAE,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAGC,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;QAC3D,OAAO,IAAI,CAAC;IACd,CAAC,CAAC;IAEF,IAAM,OAAO,GAAGV,SAAS,CACvB,UAAC,GAAQ;QACP,GAAG,CAAC,UAAU,CAAC,eAAe,EAAE;YAC9B,QAAQ,EAAE,aAAa;SACxB,CAAC,CAAC;QACH,GAAG,CAAC,UAAU,CAAC,sBAAsB,EAAE;YACrC,QAAQ,EAAE,oBAAoB;SAC/B,CAAC,CAAC;QACH,GAAG,CAAC,UAAU,CAAC,6BAA6B,EAAE;YAC5C,QAAQ,EAAE,sBAAsB;SACjC,CAAC,CAAC;QACH,GAAG,CAAC,UAAU,CAAC,8BAA8B,EAAE;YAC7C,QAAQ,EAAE,4BAA4B;SACvC,CAAC,CAAC;QACH,GAAG,CAAC,UAAU,CAAC,kBAAkB,EAAE;YACjC,QAAQ,EAAE,qBAAqB,CAAC,GAAG,CAAC;SACrC,CAAC,CAAC;QACH,GAAG,CAAC,UAAU,CAAC,0BAA0B,EAAE;YACzC,QAAQ,EAAE,oBAAoB;SAC/B,CAAC,CAAC;QACH,GAAG,CAAC,UAAU,CAAC,qBAAqB,EAAE;YACpC,QAAQ,EAAE,mBAAmB;YAC7B,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QACH,GAAG,CAAC,UAAU,CAAC,sBAAsB,EAAE;YACrC,QAAQ,EAAE,oBAAoB;YAC9B,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QACH,GAAG,CAAC,UAAU,CAAC,sBAAsB,EAAE;YACrC,QAAQ,EAAE,oBAAoB;YAC9B,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QACH,OAAO,GAAG,CAAC;IACb,CAAC,EACDW,WAAW,CACZ,CAAC;AAEF,IAAO,IAAM,UAAU,GAAGC,8BAAgB,CAAC;QACzC,WAAW,EAAE,MAAM,CAAC,WAAW;QAC/B,IAAI,EAAE,OAAO;KACd,CAAC,CAAC;IAEH,IAAM,YAAY,GAAGC,OAAO,CAAC,UAAC,IAAI,EAAE,OAAO;QACzC,OAAA,OAAO,CAAC,EAAE,CAAC,IAAI,EAAE,SAAS,SAAS,CAAY,GAAmB;YAAjD,iBAehB;YAdC,IAAM,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC;YAEnB,OAAO,GAAG,CAAC,GAAG,CAAC,CAAC;YAChB,IAAI,MAAM,IAAI,GAAG,IAAI,OAAO,IAAI,GAAG;gBAAE,OAAO;YAC5C,IAAI,GAAG,CAAC,GAAG,IAAI,CAACR,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,MAAM;gBAAE,OAAO;YAC/C,IAAM,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,iBAAiB,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YAEhG,OAAO;iBACJ,IAAI,CAAC,UAAC,SAAkB;gBACvB,IAAI,CAAC,SAAS;oBAAE,OAAO,OAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,GAAG,CAAC,CAAC;gBAC/D,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBACb,OAAO,KAAI,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;aAC1B,CAAC;iBACD,KAAK,CAAC,UAAC,GAAU,IAAK,OAAA,OAAO,CAAC,KAAK,CAAC,cAAc,EAAE,GAAG,EAAE,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,GAAA,CAAC,CAAC;SAChF,CAAC;IAfF,CAeE,CACH,CAAC;AAEF,QAAa,UAAU,GAAG;QACxB,aAAa,eAAA;QACb,oBAAoB,sBAAA;QACpB,sBAAsB,wBAAA;QACtB,4BAA4B,8BAAA;QAC5B,qBAAqB,uBAAA;QACrB,oBAAoB,sBAAA;QACpB,WAAW,aAAA;QACX,mBAAmB,qBAAA;QACnB,OAAO,SAAA;QACP,UAAU,YAAA;QACV,YAAY,cAAA;KACb;;QC9OY,MAAM,GAAe;QAChC,SAAS,EAAE,SAAS,CAAC,OAAO;QAC5B,OAAO,EAAE,SAAS,CAAC,OAAO;QAC1B,KAAK,EAAE,SAAS,CAAC,OAAO;QACxB,kBAAkB,EAAE,IAAI,GAAG,EAAE,GAAG,EAAE;QAClC,MAAM,EAAEL,SAAS,CACfc,KAAK,CAAC,UAAC,EAA4B;gBAA3B,WAAG,EAAE,WAAG;YAAwB,QAAC,MAAM,CAAC,GAAG,CAAC,GAAG,GAAG;SAAC,CAAC,EAC5DX,SAAS,CACV;KACF;;ICfK,IAAA,iBAAyC,EAAxC,eAAO,EAAE,cAAM,EAAE,eAAuB,CAAC;IAEhD,IAAM,SAAS,GAAG,UAAC,IAAsB;QACvC,OAAA,IAAI,CAAC,GAAG,CAAC,UAAA,GAAG,IAAI,QAAC,CAAC,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,IAAW,CAAC,CAAC,MAAM,CAAC,UAAA,EAAE,IAAI,OAAA,CAAC,CAAC,EAAE,GAAA,CAAC;IAA1E,CAA0E,CAAC;IAC7E,IAAM,WAAW,GAAGW,KAAK,CAA+BC,OAAO,CAAC,CAAC,EAAE,CAAC,CAEpD,CAAC,CAAC;IAClB,IAAM,MAAM,GAAGR,QAAQ,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;IACtC,IAAM,YAAY,GAAGM,OAAO,CAAC,UAAC,OAAO,EAAE,IAAI,IAAK,OAAA,KAAG,SAAS,CAAC,MAAM,GAAG,IAAI,UAAK,OAAO,MAAG,GAAA,CAAC,CAAC;IAC3F,IAAM,YAAY,GAAGb,SAAS,CAC5BgB,SAAS,CAAC,IAAI,MAAM,CAAC,MAAI,SAAS,CAAC,MAAQ,CAAC,EAAE,EAAE,CAAC,EACjDA,SAAS,CAAC,QAAQ,EAAE,EAAE,CAAC,CACxB,CAAC;IAEF,IAAM,QAAQ,GAAG,UAAC,OAAe,IAAK,OAAA,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC,IAAI,EAAE,GAAA,CAAC;IACpF,IAAM,UAAU,GAAG,UAAC,GAAa,IAAK,OAAA,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,UAAA,EAAE,IAAI,OAAA,CAAC,CAAC,EAAE,GAAA,CAAC,GAAA,CAAC;IAC3E,IAAM,QAAQ,GAAG,UAAC,IAAY,IAAK,OAAAT,QAAQ,CAAC,EAAE,EAAE,SAAS,EAAE,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,GAAA,CAAC;IAC3F,IAAM,UAAU,GAAGO,KAAK,CAAC,QAAQ,CAAC,CAAC;IAEnC,SAAS,MAAM,CAAC,IAAqB,EAAE,GAAoB;QACzD,IAAM,GAAG,GAAwBG,OAAO,CAAC,GAAG,EAAEV,QAAQ,CAAC,EAAE,EAAE,KAAG,GAAK,EAAE,IAAI,CAAC,CAAC,CAAC;QAC5E,GAAG,CAAC,CAAC,CAAC,GAAG,CAAE,GAAG,CAAC,CAAC,CAAY,IAAI,EAAE,EAAE,IAAI,EAAE,CAAC;QAC3C,GAAG,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC,CAAW,CAAC,CAAC;QACtC,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,QAAQ,CAAC,GAAa,EAAE,EAAE,CAAC,CAAC,CAAC;QAC9C,OAAO,GAAqB,CAAC;IAC/B,CAAC;IAED,IAAM,QAAQ,GAAGP,SAAS,CACxBkB,QAAQ,CACNlB,SAAS,CACP,UAAA,GAAG,IAAI,OAAA,CAAC,EAAE,GAAG,KAAK,CAAC,IAAI,GAAG,CAAC,GAAA,EAC3B,UAAC,GAAW,IAAK,OAAA,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,GAAA,CACnC,CAC8B,EACjCH,QAA+C,CAChD,CAAC;IAEF,SAAS,IAAI,CAAC,IAAqB;QACjC,IAAM,IAAI,GAAGA,QAAQ,CAAC,IAAI,CAAC,CAAC;QAC5B,IAAM,MAAM,GAAqB,EAAE,CAAC;QAEpC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACpC,IAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;YACpB,IAAM,MAAM,GAAG,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;YACjC,IAAI,CAAC,MAAM,IAAI,MAAM,KAAK,CAAC;gBAAE,SAAS;YACtC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC;SAChC;QAED,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,IAAM,GAAG,GAAGG,SAAS,CACnB,SAAS,EACT,IAAI,CACL,CAAC;IAEF,IAAM,QAAQ,GAAGmB,UAAU,CAAC;QAC1BC,QAAQ,CACNpB,SAAS,CACPqB,MAAM,CAAC,CAAC,CAACC,OAAO,EAAEC,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,CAACC,GAAG,EAAE,UAAU,CAAC,CAAC,CAAC,EAC1DC,KAAK,CAAC,OAAO,CAAC,CACf,CACF;KACF,CAAiD,CAAC;IAEnD,IAAM,SAAS,GAAGzB,SAAS,CACzBc,KAAK,CAACW,KAAK,CAAC,MAAM,CAAgD,CAAC,EACnE,QAAQ,EACRP,QAAQ,CAACQ,UAA4C,CAEhC,EACrB,IAAI,CACL,CAAC;IAEF,IAAM,WAAW,GAAIC,UAAU,CAACb,KAAK,CAES,CAAC;IAC/C,IAAM,WAAW,GAAG,WAAW,CAC7B,UAAC,IAAiB,EAAE,GAAW,IAAqB,OAAA,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,GAAA,CAC5E,CAAC;IAEF,SAAe,UAAU,CACvB,IAAqB,EACrB,WAAwB,EACxB,EAAuB;YAArB,sCAAc,EAAd,mCAAc;;;;gBAEZ,UAAU,GAAG,CAAC,CAAC,CAAC;gBAChB,eAAe,GAAG,IAAI,CAAC;gBACvB,YAAY,GAAG,IAAI,CAAC;gBAEjB,QAAQ,GAAiB,WAAW,GAA5B,EAAE,WAAW,GAAI,WAAW,GAAf,CAAgB;gBAE5C,KAAK,GAAG,IAAI,IAAI,IAAI,EAAE,EAAE;oBAChB,MAAM,GAAG,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;oBAEjC,IAAI,EAAE,MAAM,IAAI,MAAM,KAAK,CAAC,CAAC;wBAAE,SAAS;oBAElC,GAAG,GAAmB,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;oBACvC,GAAG,GAAsB,GAAG,GAAzB,EAAE,KAAoB,GAAG,GAAd,EAAT,EAAE,mBAAG,IAAI,KAAA,EAAE,KAAK,GAAI,GAAG,GAAP,CAAQ;oBACpC,IAAI,EAAE,KAAK,QAAQ,EAAE;wBACnB,IAAI,WAAW,KAAK,KAAK;4BAAE,sBAAO,IAAI,EAAC;wBACvC,gCAAS,GAAC,KAAG,GAAK,IAAG,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,OAAG;qBAC9C;oBAED,IAAI,YAAY,KAAK,IAAI,KAAK,KAAK,KAAK,IAAI,IAAI,KAAK,GAAG,YAAY,CAAC,EAAE;wBACrE,YAAY,GAAG,KAAK,CAAC;wBACrB,eAAe,GAAG,GAAG,CAAC;qBACvB;oBACD,IAAI,GAAG,KAAK,IAAI,IAAI,GAAG,GAAG,UAAU;wBAAE,UAAU,GAAG,GAAG,CAAC;iBACxD;gBAED,IAAI,CAAC,OAAO,IAAI,UAAU,GAAG,CAAC,GAAG,OAAO,EAAE;oBACxC,gCAAS,GAAC,MAAG,UAAU,GAAG,CAAC,CAAE,IAAG,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,OAAG;iBACzD;gBAED,IAAI,YAAY,KAAK,IAAI,IAAI,WAAW,GAAG,YAAY,EAAE;oBACvD,gCAAS,GAAC,KAAG,eAAiB,IAAG,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,OAAG;iBAC1D;gBAED,sBAAO,IAAI,EAAC;;;KACb;IAED,SAAe,IAAI,CACjB,IAAqB,EACrB,YAAgC,EAChC,SAAwB,EACxB,EAAuB;QAFvB,6BAAA,EAAA,iBAAgC;QAChC,0BAAA,EAAA,cAAwB;YACtB,sCAAc,EAAd,mCAAc;;;;gBAEhB,IAAI,YAAY,CAAC,MAAM,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE;oBAClD,sBAAO,UAAU,CAAC,IAAI,EAAE,YAAY,CAAC,CAAC,CAAC,EAAE,EAAE,OAAO,SAAA,EAAE,CAAC,EAAC;iBACvD;gBACK,OAAO,GAAGc,SAAS,CAACF,UAAU,EAAE,SAAS,CAAC,CAAC;gBAC3C,IAAI,GAAG,EAAsC,CAAC;gBAC9C,OAAO,GAAoB,EAAE,CAAC;gBAC9B,IAAI,GAAqB,EAAE,CAAC;gBAC5B,OAAO,GAAG,EAA+B,CAAC;gBAC5C,SAAS,GAAG,EAAE,CAAC;gBACf,MAAM,GAAG,CAAC,CAAC;gBAGf,KAAK,GAAG,IAAI,IAAI,IAAI,EAAE,EAAE;oBAChB,MAAM,GAAG,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;oBAEjC,IAAI,EAAE,MAAM,IAAI,MAAM,KAAK,CAAC,CAAC;wBAAE,SAAS;oBAClC,GAAG,GAAmB,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;oBACvC,GAAG,GAAgC,GAAG,GAAnC,EAAE,KAA8B,GAAG,GAAxB,EAAT,EAAE,mBAAG,IAAI,KAAA,EAAE,KAAmB,GAAG,GAAP,EAAf,QAAQ,mBAAG,IAAI,KAAA,CAAQ;oBAC9C,GAAG,CAAC,OAAO,CAAC,GAAG,QAAQ,KAAK,IAAI,GAAG,IAAI,GAAG,QAAQ,CAAC;oBACnD,IAAI,EAAE,IAAI,OAAO,CAAC,EAAE,CAAC;wBAAE,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC;oBACzD,IAAI,EAAE;wBAAE,IAAI,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;oBACvB,IAAI,GAAG,CAAC,MAAM,CAAC,EAAE;wBACf,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;qBAChB;yBAAM;wBACL,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;qBACrB;oBACD,IAAI,GAAG,IAAI,GAAG,GAAG,MAAM;wBAAE,MAAM,GAAG,GAAG,CAAC;iBACvC;gBAED,KAAS,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACtC,KAAc,YAAY,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAA5C,EAAE,QAAA,EAAE,KAAK,QAAA,CAAoC;oBAEpD,IAAI,CAAC,EAAE;wBAAE,SAAS;oBACZ,QAAQ,GAAG,IAAI,CAAC,EAAE,CAAC,CAAC;oBAE1B,IAAI,QAAQ,EAAE;wBACZ,IAAI,QAAQ,CAAC,OAAO,CAAC,KAAK,KAAK,EAAE;4BAC/B,QAAQ,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC;4BAC1B,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;yBACpB;qBACF;yBAAM;wBACC,GAAG,GAAmB,CAAC,IAAI,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC;wBAE9C,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;qBAChB;iBACF;gBAEK,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC;gBAC3B,MAAM,GAAG,OAAO,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC,EAAE,OAAO,CAAC,GAAG,SAAS,CAAC;gBAC3D,OAAO,GAAG,OAAO,GAAG,SAAS,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBACpE,KAAK,GAAGR,QAAQ,CAAC,UAAA,GAAG,IAAI,OAAA,GAAG,CAAC,OAAO,CAAC,KAAK,IAAI,GAAA,EAAE,MAAM,CAAC,CAAC;gBAE7D,SAAS,GAAG,SAAS,CAAC,MAAM,CAACA,QAAQ,CAAC,UAAA,GAAG,IAAI,OAAA,GAAG,CAAC,OAAO,CAAC,KAAK,IAAI,GAAA,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC;gBAExF,KAAS,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBAChC,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;oBACvB,GAAG,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;oBACzB,GAAG,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;oBAE/B,IAAI,GAAG,KAAK,IAAI,IAAI,OAAO,CAAC,EAAE,IAAI,EAAE,CAAC;wBAAE,OAAO,CAAC,KAAG,GAAK,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;iBAChF;gBAEK,QAAQ,GAAG,EAAE,CAAC;gBAEpB,OAAO,KAAK,CAAC,MAAM,EAAE;oBACb,GAAG,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC;oBAClB,QAAQ,GAAG,SAAS,CAAC,GAAG,EAAE,CAAC;oBAC5B,GAAG,GAAI,CAAA,QAAQ,IAAI,CAAC,IAAI,CAAC,IAAtB,CAAuB;oBAE/B,IAAI,GAAG,KAAK,IAAI,EAAE;wBAChB,GAAG,GAAG,MAAM,GAAG,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;wBACnC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;qBACpB;oBAED,IAAI,GAAG;wBAAE,OAAO,CAAC,KAAG,GAAK,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;iBACpE;gBAED,OAAO,SAAS,CAAC,MAAM,EAAE;oBACjB,GAAG,GAAG,SAAS,CAAC,GAAG,EAAE,CAAC;oBAE5B,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;wBACjB,GAAG,GAAG,KAAG,GAAG,CAAC,OAAO,CAAG,CAAC;wBAE9B,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,IAAI,EAAE;4BACtB,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;4BACpB,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;yBACxC;qBACF;iBACF;gBAED,sBAAOb,MAAM,CAAC,OAAO,CAAC,CAAC,MAAM,GAAG,OAAO,GAAG,IAAI,EAAC;;;KAChD;IAED,IAAM,SAAS,GAAGL,SAAS,CACzB6B,QAAQ,CAACJ,KAAK,CAAC,MAAM,CAAC,CAAC,EACvB,QAAQ,EACRxB,QAAQ,CACN6B,QAA0E,EAC1E,EAAsB,CACvB,EACDhB,KAAK,CAAC,IAAI,CAAC,CACZ,CAAC;IAEF,IAAM,aAAa,GAAGiB,cAAK,CAAmB,UAAC,KAAe,EAAE,KAAe;QAC7E,OAAA,OAAO,CAAC,GAAG,CAACjB,KAAK,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;IAApD,CAAoD,CACrD,CAAC;IAEF,IAAM,IAAI,GAAGiB,cAAK,CAAC,UAAC,KAAe,EAAE,IAAY,EAAE,IAA0B;QACnE,IAAA,yBAAwB,EAAxB,6CAAwB,CAAgB;QAEhD,OAAO,aAAa,CAAC,KAAK,EAAE,CAAC,YAAY,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IAC7E,CAAC,EAAE,aAAa,CAAC,CAAC;IAElB,IAAM,GAAG,GAAGA,cAAK,CACf,UAAC,KAAe,EAAE,IAAY,IAAK,QAAC,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,GAAGC,gBAAO,CAAC,IAAI,CAAC,IAAC,EAClF,SAAS,CACV,CAAC;AAEF,IAAO,IAAM,WAAW,GAAG;QACzB,OAAO,SAAA;QACP,MAAM,QAAA;QACN,OAAO,SAAA;QACP,MAAM,QAAA;QACN,GAAG,KAAA;QACH,MAAM,QAAA;QACN,QAAQ,UAAA;QACR,IAAI,MAAA;QACJ,GAAG,KAAA;QACH,QAAQ,UAAA;QACR,UAAU,YAAA;QACV,QAAQ,UAAA;QACR,UAAU,YAAA;QACV,SAAS,WAAA;QACT,WAAW,aAAA;QACX,WAAW,aAAA;QACX,QAAQ,UAAA;QACR,SAAS,WAAA;QACT,YAAY,cAAA;QACZ,YAAY,cAAA;QACZ,aAAa,eAAA;QACb,IAAI,MAAA;QACJ,IAAI,MAAA;QACJ,SAAS,WAAA;KACV,CAAC;;IChRF,IAAM,IAAI,GAAGlC,QAAQ,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,CAAkC,CAAC;IACvE,IAAM,KAAK,GAAGA,QAAQ,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,CAAqD,CAAC;IAE3F,IAAM,MAAM,GAAGE,SAAS,CACtBiC,MAAmC,EACnCC,QAAQ,CAACR,UAAU,CAAC,EACpBS,QAAoC,EACpC,KAAK,CACN,CAAC;IAEF,IAAM,KAAK,GAAGnC,SAAS,CACrBc,KAAK,CAACP,QAAQ,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,EACxB4B,QAAQ,CACT,CAAC;IAEF,IAAMC,MAAI,GAAG,UAAC,QAAqB,EAAE,OAAoB;QACvD,IAAM,WAAW,GAAGhC,SAAS,CAAC,CAAC,GAAG,CAAC,EAAEP,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,UAAA,CAAC;YAC9D,IAAM,MAAM,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;YAC1B,IAAM,MAAM,GAAGK,MAAM,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;YAEnC,OAAO,CAACmC,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,IAAI,KAAG,MAAQ,KAAK,KAAG,MAAQ,CAAC;SACjE,CAAC,CAAC;QAEH,OAAOC,MAAM,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;IACtC,CAAC,CAAC;IAEF,SAAS,SAAS,CAAC,OAAoB;QACrC,IAAM,IAAI,GAAG,OAAO,gBAAQ,OAAO,IAAK,OAAO,CAAC;QAChD,IAAM,IAAI,GAAGxC,QAAQ,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;QAE5C,IAAI,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAAE,OAAO,OAAO,CAAC;QAClEM,SAAS,CAAC,CAAC,GAAG,CAAC,EAAEC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,UAAA,GAAG;YACxC,GAAG,CAAC,GAAG,CAAC,MAAM,CACZ,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,CAAC,EAClD,KAAK,EACL,UAAC,GAAQ,IAAK,QAAC,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,EAAE,OAAO,CAAC,IAAC,CAClE,CAAC;SACH,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;IACd,CAAC;AAED,IAAO,IAAM,OAAO,GAAG,EAAE,IAAI,MAAA,EAAE,KAAK,OAAA,EAAE,IAAI,QAAA,EAAE,MAAM,QAAA,EAAE,KAAK,OAAA,EAAE,SAAS,WAAA,EAAE,CAAC;;IC1CvE,IAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC;IAC5B,IAAMkC,KAAG,GAAGvC,SAAS,CACnBkB,QAAQ,CAACQ,UAAiC,CAA8B,EACxEZ,KAAK,CACHd,SAAS,CACPE,MAAM,CAAC,SAAS,CAAuB,EACvC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAClD,CACF,EACD,OAAO,CAAC,KAAK,CACd,CAAC;IAEF,IAAM,KAAK,GAAGF,SAAS,CACrBQ,QAAQ,CAAC,GAAG,CAAC,EACbP,QAAQ,CAACuC,YAAY,EAAE,EAAE,CAAC,CACc,CAAC;IAE3C,SAAS,MAAM,CAAC,SAAoC;QAClD,IAAM,CAAC,GAAG,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC,CAAC;QACtD,IAAM,IAAI,GAAG,CAAC,CAAC,cAAc,EAAE,CAAC;QAChC,IAAM,KAAK,GAAG,CAAC,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;QAClC,IAAM,MAAM,GAAG,CAAC,CAAC,UAAU,EAAE,CAAC;QAE9B,OAAU,IAAI,SAAI,KAAK,SAAI,MAAQ,CAAC;IACtC,CAAC;AAED,QAAa,QAAQ,GAAG,EAAE,GAAG,OAAA,EAAE,KAAK,OAAA,EAAE,KAAK,OAAA,EAAE,MAAM,QAAA,EAAE;;IC1BrD,IAAM,IAAI,GAAGjC,QAAQ,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;IAC5C,IAAM,IAAI,GAAGA,QAAQ,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;IAClC,IAAM,SAAS,GAAGP,SAAS,CACzByC,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,EAC5B,IAAI,CACL,CAAC;IACF,IAAM,GAAG,GAAGlC,QAAQ,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;IAChC,IAAM,KAAK,GAAGA,QAAQ,CAAC,EAAE,EAAE,OAAO,CAAkC,CAAC;IACrE,IAAM,MAAM,GAAGP,SAAS,CACtB,UAAA,MAAM;QACJ,IAAI,CAAC,MAAM;YAAE,OAAO,EAAE,CAAC;QACvB,IAAM,MAAM,GAAG0C,WAAQ,CAAC,MAAM,CAAC,CAAC;QAEhC,OAAO,CAAC,MAAM,CAAC,IAAI,IAAI,MAAM,CAAC,MAAM,IAAI,EAAE,EAAE,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;IACpE,CAAC,EACD,GAAoC,CACrC,CAAC;IACF,IAAM,QAAQ,GAAGnC,QAAQ,CAAC,EAAE,EAAE,UAAU,CAAC,CAAC;IAC1C,IAAM,IAAI,GAAGA,QAAQ,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;IAClC,IAAM,SAAS,GAAGA,QAAQ,CAAC,EAAE,EAAE,WAAW,CAAC,CAAC;AAE5C,QAAa,aAAa,GAAG;QAC3B,IAAI,MAAA;QACJ,IAAI,MAAA;QACJ,SAAS,WAAA;QACT,GAAG,KAAA;QACH,KAAK,OAAA;QACL,MAAM,QAAA;QACN,QAAQ,UAAA;QACR,IAAI,MAAA;QACJ,SAAS,WAAA;KACV;;ICzBD,IAAM,aAAa,GAAG;QACpB,OAAO,EAAE,OAAO;QAChB,OAAO,EAAE,WAAW;KACrB,CAAC;IAEF,IAAMoC,UAAQ,GAAG3C,SAAS,CACxBO,QAAQ,CAAC,EAAE,EAAE,SAAS,CAAC,EACvB,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAClD,CAAC;IAEF,IAAMqC,YAAU,GAAG9B,KAAK,CAAC6B,UAAQ,CAAC,CAAC;IAEnC,IAAM,KAAK,GAAG9B,OAAO,CAAC,UAAC,IAAI,EAAE,OAAO,EAAE,IAAI;QACxC,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,IAAI;YAAE,OAAO;QAEtC,IAAI,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;YAC5B,IAAI,CAAC,GAAG;iBACL,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;iBACvD,GAAG,CAAC,MAAM,CAAC;iBACX,EAAE,CAAC,SAAS,IAAI,CAAiB,EAAqB;gBACrD,IAAI,CAAC,EAAE;oBAAE,OAAO;gBAChB,KAAK,CAAC,IAAI,EAAE,OAAO,eAAO,IAAI,IAAE,KAAK,EAAE,EAAE,CAAC,KAAK,IAAI,KAAK,IAAG,CAAC;gBAC5D,IAAI,CAAC,GAAG,EAAE,CAAC;aACZ,CAAC,CAAC;YACL,OAAO;SACR;QAED,IAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC,CAAC;QACpE,IAAM,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACzC,IAAA,sBAAsC,EAArC,YAAI,EAAE,aAAK,EAAE,WAAwB,CAAC;QAC7C,IAAM,WAAW,GAAGN,QAAQ,CAAC,EAAE,EAAE,IAAI,CAAC,IAAI,IAAI,EAAE,EAAE,aAAa,CAAC,CAAC;QACjE,IAAM,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,IAAI,EAAE,CAAC;QACtD,IAAM,SAAS,GAAG,WAAW,GAAG,aAAa,CAAC;QAC9C,IAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,SAAS,WAAA,EAAE,CAAC,CAAC,CAAC;QACtE,IAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,SAAS,WAAA,EAAE,IAAI,MAAA,EAAE,KAAK,OAAA,EAAE,GAAG,KAAA,EAAE,CAAC,CAAC,CAAC;QAE9F,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,KAAK,KAAK,KAAK,EAAE;YACzC,IAAM,OAAO,GAAM,WAAW,QAAK,CAAC;YACpC,IAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;YAClF,IAAM,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAC9B,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC;gBAC5B,SAAS,EAAE,OAAO;gBAClB,IAAI,MAAA;gBACJ,KAAK,OAAA;gBACL,GAAG,KAAA;aACJ,CAAC,CACH,CAAC;YAEF,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YACpB,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;SACxB;QAED,IAAI,IAAI,CAAC,IAAI,KAAK,YAAY,EAAE;YAC9B,IAAM,OAAO,GAAG,IAAI,CAAC,GAAG,GAAGmC,WAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;YACnD,IAAM,UAAU,GAAG,CAAC,IAAI,CAAC,GAAG;kBACxB,CAAC,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,MAAM,IAAI,EAAE,EAAE,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC;kBAC5D,UAAQ,IAAI,CAAC,KAAO,EACtB,WAAW,EAAE,CAAC;YAChB,IAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,UAAU,YAAA,EAAE,CAAC,CAAC,CAAC;YAEzE,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAElB,IAAI,IAAI,CAAC,GAAG,EAAE;gBACZ,IAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;;gBAG1E,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;aACpB;SACF;QAED,IAAI,IAAI,CAAC,IAAI,EAAE;YACb,IAAM,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YAEhG,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;SACxB;QAED,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,IAAI,EAAE;YAC/B,IAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAC3B,MAAM,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,CAAC;gBACjC,OAAO,EAAE,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,IAAI;aACrC,CAAC,CACH,CAAC;YAEF,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;SACrB;QAED,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACjB,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IACtB,CAAC,CAAC,CAAC;IAEH,IAAM,GAAG,GAAG7B,OAAO,CAAC,UAAC,IAAI,EAAE,IAAI;QAC7B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,IAAI,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;QACxD,IAAM,YAAY,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;QAC3B,IAAA,0BAAS,EAAE,gBAAI,EAAE,kBAAK,EAAE,wBAAQ,EAAE,gBAAI,EAAE,0BAAS,CAAU;QACnE,IAAM,OAAO,GAAG,OAAO,CAAC;YACtB,SAAS,WAAA;YACT,IAAI,MAAA;YACJ,KAAK,OAAA;YACL,QAAQ,UAAA;YACR,IAAI,MAAA;YACJ,SAAS,WAAA;YACT,YAAY,cAAA;SACb,CAAC,CAAC;QAEH,IAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC,CAAC;QACnE,IAAM,QAAQ,GAAG,QAAQ;cACrB,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,QAAQ,UAAA,EAAE,CAAC;cAC3D,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,YAAY,EAAE,CAAC,CAAC;QAE9D,IAAM,QAAQ,GAAc;YAC1B,EAAE,EAAE,OAAO;YACX,SAAS,WAAA;YACT,IAAI,MAAA;YACJ,YAAY,cAAA;YACZ,IAAI,EAAE,EAAE,GAAG,EAAE,QAAkB,EAAE;YACjC,OAAO,EAAE,EAAE,GAAG,EAAE,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAW,EAAE;YAC1E,SAAS,EAAE,EAAE,GAAG,EAAE,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAW,EAAE;YAC9E,WAAW,EAAE,EAAE,GAAG,EAAE,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAW,EAAE;YAClF,QAAQ,EAAE,EAAE,GAAG,EAAE,MAAM,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAW,EAAE;SAC7E,CAAC;QAEF,IAAI,KAAK;YAAE,QAAQ,CAAC,KAAK,GAAG,EAAE,GAAG,EAAE,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAW,EAAE,CAAC;QAChG,IAAI,QAAQ;YAAE,QAAQ,CAAC,MAAM,GAAG,EAAE,GAAG,EAAE,MAAI,QAAU,EAAE,CAAC;QACxD,IAAI,IAAI;YAAE,QAAQ,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAW,EAAE,CAAC;QACzF,IAAI,SAAS,EAAE;YACb,QAAQ,CAAC,OAAO,GAAG;gBACjB,GAAG,EAAE,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,SAAS,EAAE,CAAW;aAClE,CAAC;SACH;QACD,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACjC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACnB,KAAK,CAAC,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;QAC3B,OAAO,IAAI,CAAC;IACd,CAAC,CAAC,CAAC;IAEH,IAAM,MAAM,GAAGA,OAAO,CAAC,UAAC,IAAI,EAAE,IAAI;QAChC,IAAM,SAAS,GAAG,IAAI,CAAC,SAAS,IAAI,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;QACzD,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAE/B,IAAI,IAAI,CAAC,KAAK;YAAE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,IAAI,EAAE,CAAC;QAC7D,IAAI,IAAI,CAAC,MAAM;YAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,IAAI,EAAE,CAAC;QAChE,IAAI,IAAI,EAAE;YACR,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC;YACzB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC;SAC1B;QAED,IAAM,KAAK,GAAG,GAAG,CAAC,IAAI,eAAO,IAAI,IAAE,SAAS,WAAA,EAAE,IAAI,EAAE,YAAY,IAAG,CAAC;QAEpE,IAAI,IAAI,EAAE;YACR,IAAM,UAAU,GAAG,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC;gBACnD,QAAQ,EAAE,IAAI,CAAC,GAAG;aACnB,CAAC,CAAC;YACH,IAAM,eAAe,GAAG,MAAM,CAAC,iBAAiB,CAAC,KAAK,CAAC,OAAO,CAAC;gBAC7D,QAAQ,EAAE,IAAI,CAAC,GAAG;aACnB,CAAC,CAAC;YACH,IAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YACxC,IAAM,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YAElD,IAAI,CAAC,GAAG;iBACL,IAAI,EAAE;iBACN,GAAG,CAAC,QAAQ,CAAC;iBACb,GAAG,CAAC,MAAM,CAAC,CAAC;YACf,IAAI,CAAC,GAAG;iBACL,IAAI,EAAE;iBACN,GAAG,CAAC,aAAa,CAAC;iBAClB,GAAG,CAAC,WAAW,CAAC,CAAC;YACpB,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAClB,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;SACxB;QAED,OAAO,KAAK,CAAC;IACf,CAAC,CAAC,CAAC;IAEH,IAAM,OAAO,GAAGA,OAAO,CAAC,UAAC,IAAI,EAAE,IAAI;QACjC,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAE/B,IAAI,IAAI,CAAC,KAAK;YAAE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,IAAI,EAAE,CAAC;QAC7D,IAAI,IAAI,EAAE;YACR,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC;YACzB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC;SAC1B;QAED,IAAM,KAAK,GAAG,GAAG,CAAC,IAAI,eAAO,IAAI,IAAE,IAAI,EAAE,SAAS,IAAG,CAAC;QAEtD,IAAI,IAAI,EAAE;YACR,IAAM,UAAU,GAAG,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC;gBACnD,QAAQ,EAAE,IAAI,CAAC,GAAG;aACnB,CAAC,CAAC;YACH,IAAM,YAAY,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC;gBACvD,QAAQ,EAAE,IAAI,CAAC,GAAG;aACnB,CAAC,CAAC;YACH,IAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YACxC,IAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAE5C,IAAI,CAAC,GAAG;iBACL,IAAI,EAAE;iBACN,GAAG,CAAC,QAAQ,CAAC,EAAE;iBACf,GAAG,CAAC,MAAM,CAAC,CAAC;YACf,IAAI,CAAC,GAAG;iBACL,IAAI,EAAE;iBACN,GAAG,CAAC,UAAU,CAAC;iBACf,GAAG,CAAC,QAAQ,CAAC,CAAC;YACjB,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAClB,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;SACrB;QAED,OAAO,KAAK,CAAC;IACf,CAAC,CAAC,CAAC;IAEH,IAAM,IAAI,GAAGA,OAAO,CAAC,UAAC,IAAI,EAAE,IAAI;QAC9B,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAE/B,IAAI,IAAI,CAAC,KAAK;YAAE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,IAAI,EAAE,CAAC;QAC7D,IAAI,IAAI,EAAE;YACR,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC;YACzB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC;SAC1B;QAED,IAAM,KAAK,GAAG,GAAG,CAAC,IAAI,eAAO,IAAI,IAAE,IAAI,EAAE,SAAS,IAAG,CAAC;QAEtD,IAAI,IAAI,EAAE;YACR,IAAM,UAAU,GAAG,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC;gBACnD,QAAQ,EAAE,IAAI,CAAC,GAAG;aACnB,CAAC,CAAC;YACH,IAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YAExC,IAAI,CAAC,GAAG;iBACL,IAAI,EAAE;iBACN,GAAG,CAAC,QAAQ,CAAC;iBACb,GAAG,CAAC,MAAM,CAAC,CAAC;YACf,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;SACnB;QAED,OAAO,KAAK,CAAC;IACf,CAAC,CAAC,CAAC;IAEH,IAAM,SAAS,GAAGA,OAAO,CAAC,UAAC,IAAI,EAAE,IAAI,EAAE,IAAI;QACzC,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAE/B,IAAI,CAAC,IAAI;YAAE,OAAO,OAAO,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;QAClD,IAAI,KAAK,CAAC;QACV,IAAM,SAAS,GAAG,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;QAC3E,IAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAEhD,OAAO,KAAK,CAAC,IAAI,CAAC,UAAC,GAAc;YAC/B,IAAI,GAAG,IAAI,GAAG,CAAC,IAAI,EAAE;gBACnB,KAAK;qBACF,GAAG,CAAC,MAAM,CAAC;qBACX,GAAG,CAAC,MAAM,CAAC;qBACX,GAAG,CAAC,IAAI,CAAC,CAAC;aACd;iBAAM;gBACL,IAAM,IAAI,GAAG;oBACX,IAAI,MAAA;oBACJ,KAAK,EAAE,IAAI;oBACX,IAAI,EAAE,UAAU;oBAChB,MAAM,EAAE,IAAI,CAAC,KAAK;oBAClB,QAAQ,EAAE,IAAI,CAAC,GAAG;iBACnB,CAAC;gBAEF,KAAK,GAAG,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;gBACxB,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;aAClB;SACF,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAM,IAAI,GAAGA,OAAO,CAAC,UAAC,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,KAAK;QACzC,IAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CACxB,MAAM,CAAC,IAAI,KAAK,IAAI,GAAG,cAAc,GAAG,gBAAgB,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC;YACtE,OAAO,EAAE,EAAE;SACZ,CAAC,CACH,CAAC;QAEF,OAAO,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACnC,CAAC,CAAC,CAAC;AAEH,QAAa,KAAK,GAAG;QACnB,QAAQ,YAAA;QACR,UAAU,cAAA;QACV,GAAG,KAAA;QACH,MAAM,QAAA;QACN,OAAO,SAAA;QACP,IAAI,MAAA;QACJ,SAAS,WAAA;QACT,IAAI,MAAA;QACJ,KAAK,OAAA;KACN;;ICzRD,IAAM,KAAK,GAAGkB,cAAK,CAA2B,UAAC,KAAK,EAAE,SAAS;QAC7D,OAAA,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,UAAC,IAAe;YACxC,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,EAAE;gBAAE,OAAO,IAAI,CAAC;YACnC,IAAM,MAAM,GAAsB;gBAChC,EAAE,EAAE,IAAI,CAAC,EAAE;gBACX,SAAS,EAAE,UAAU,CAAC,IAAI,CAAC,SAAmB,CAAC;aAChD,CAAC;YACF,IAAM,WAAW,GAAWjC,QAAQ,CAAC,EAAE,EAAE,CAAC,SAAS,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;YACjE,IAAM,MAAM,GAAWA,QAAQ,CAAC,EAAE,EAAE,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;YACvD,IAAM,IAAI,GAAWS,QAAQ,CAAC,EAAE,EAAE,SAAS,EAAE,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;YACzF,IAAM,SAAS,GAAWA,QAAQ,CAChC,EAAE,EACF,SAAS,EACT,WAAW,IAAI,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,WAAW,CAAC,CACrD,CAAC;YAEF,IAAI,IAAI;gBAAE,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC;YAC7B,IAAI,SAAS;gBAAE,MAAM,CAAC,SAAS,GAAG,SAAS,CAAC;YAC5C,OAAO,MAAM,CAAC;SACf,CAAC;IAlBF,CAkBE,CACH,CAAC;IAEF,IAAM,kBAAkB,GAAGM,OAAO,CAAC,UAAC,KAAe,EAAE,KAAsB;QACzE,IAAM,GAAG,GAAG,WAAW,CAAC,UAAU,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;QAEhD,OAAOgC,YAAG,CACR/B,KAAK,CAAC,UAAA,EAAE,IAAI,OAAA,SAAS,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,UAAA,IAAI,IAAI,OAAA,CAAC,EAAE,EAAE,IAAI,CAAC,GAAA,CAAC,GAAA,EAAE,GAAG,CAAC,CAChE,CAAC,IAAI,CAAC,UAAC,KAAoC;YAC1C,OAAA,KAAK,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,EAAU;oBAAT,UAAE,EAAE,YAAI;gBAAM,OAAAf,OAAO,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,CAAC;aAAA,EAAE,EAAkB,CAAC;SAAA,CAC9E,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAM,WAAW,GAAGgC,cAAK,CAAC,UAAC,KAAK,EAAE,OAAO,EAAE,SAAc;QAAd,0BAAA,EAAA,cAAc;QACvD,IAAI,CAAC,OAAO;YAAE,OAAOC,gBAAO,CAAC,IAAI,CAAC,CAAC;QACnC,OAAO,KAAK;aACT,GAAG,CACF,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,OAAO,CAAC;YACnC,OAAO,SAAA;YACP,SAAS,EAAE,SAAS,IAAI,MAAM,CAAC,SAAS;SACzC,CAAC,CACH;aACA,IAAI,EAAE,CAAC;IACZ,CAAC,CAAC,CAAC;IAEH,IAAM,SAAS,GAAGD,cAAK,CAA2B,UAAC,KAAK,EAAE,OAAO;QAC/D,OAAO,OAAO,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,GAAGC,gBAAO,CAAC,IAAI,CAAC,CAAC;IAClG,CAAC,CAAC,CAAC;IAEH,IAAM,SAAS,GAAGD,cAAK,CACrB,UAAC,KAAK,EAAE,EAAsD;YAApD,wBAAS,EAAE,wBAAS,EAAE,YAAY,EAAZ,iCAAY,EAAE,cAAc,EAAd,mCAAc;QAC1D,IAAI,CAAC,SAAS;YAAE,OAAOC,gBAAO,CAAC,IAAI,CAAC,CAAC;QACrC,IAAM,EAAE,GAAG,WAAW,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;QAE3C,OAAOa,YAAG,CAAgD;YACxD,KAAK,CAAC,KAAK,EAAE,SAAS,CAAC;YACvB,MAAM,GAAG,WAAW,CAAC,KAAK,EAAE,EAAE,EAAE,SAAS,CAAC,GAAGb,gBAAO,CAAC,IAAI,CAAC;YAC1D,IAAI,GAAG,SAAS,CAAC,KAAK,EAAE,EAAE,CAAC,GAAGA,gBAAO,CAAC,IAAI,CAAC;SAC5C,CAAC,CAAC,IAAI,CAAC,UAAC,EAAmB;gBAAlB,YAAI,EAAE,aAAK,EAAE,YAAI;YACzB,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,EAAE;gBAAE,OAAO,IAAI,CAAC;YACnC,oBAAY,IAAI,IAAE,KAAK,OAAA,EAAE,IAAI,MAAA,IAAG;SACjC,CAAC,CAAC;IACL,CAAC,CACF,CAAC;IAEF,IAAM,eAAe,GAAGD,cAAK,CAC3B,UAAC,KAAK,EAAE,OAAO,EAAE,SAAgB;QAAhB,0BAAA,EAAA,gBAAgB;QAC/B,OAAA,OAAO,CAAC,GAAG,CAAC,CAAC,SAAS,CAAC,KAAK,EAAE,OAAO,CAAC,EAAE,WAAW,CAAC,KAAK,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CACnF,UAAC,EAAc;gBAAb,YAAI,EAAE,cAAM;YACZ,IAAM,IAAI,GAAG,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACtC,IAAI,CAAC,IAAI;gBAAE,OAAO,EAAE,IAAI,MAAA,EAAE,MAAM,QAAA,EAAE,CAAC;YACnC,OAAO,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM,IAAI,QAAC;gBAC5C,IAAI,MAAA;gBACJ,MAAM,QAAA;gBACN,MAAM,QAAA;aACP,IAAC,CAAC,CAAC;SACL,CACF;IAVD,CAUC,EACH,OAAO,CACR,CAAC;IAEF,IAAM,cAAc,GAAGA,cAAK,CAAC,UAAC,KAAK,EAAE,MAAM;QACzC,OAAAc,YAAG,CACD5C,QAAQ,CACN,UAAC,QAAQ,EAAE,SAAS;YAClB,IAAI,CAAC,SAAS;gBAAE,OAAO,QAAQ,CAAC;YAChC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,eAAO,MAAM,IAAE,SAAS,WAAA,IAAG,CAAC,CAAC;YAC1D,OAAO,QAAQ,CAAC;SACjB,EACD,EAA6C,EAC7CM,QAAQ,CAAC,EAAE,EAAE,YAAY,EAAE,MAAM,CAAC,CACnC,CACF;IAVD,CAUC,CACF,CAAC;IAEF,IAAM,SAAS,GAAGwB,cAAK,CACrB,UAAC,KAAK,EAAE,QAAQ,IAAK,OAAA,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,QAAQ,UAAA,EAAE,CAAC,CAAC,GAAA,EAC9E,WAAW,CACZ,CAAC;IAEF,IAAM,UAAU,GAAGA,cAAK,CAAC,UAAC,KAAK,EAAE,QAAQ,EAAE,IAAI;QAC7C,IAAI,CAAC,QAAQ,IAAI,CAAC,IAAI;YAAE,OAAOC,gBAAO,CAAC,IAAI,CAAC,CAAC;QAC7C,OAAO,KAAK;aACT,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,QAAQ,UAAA,EAAE,CAAC,CAAC;aACnD,GAAG,CAAC,IAAI,CAAC;aACT,GAAG,CAAC,IAAI,CAAC,CAAC;IACf,CAAC,EAAE,YAAY,CAAC,CAAC;IAEjB,IAAM,QAAQ,GAAGD,cAAK,CAA2B,UAAC,KAAK,EAAE,QAAQ,EAAE,IAAI;QACrE,OAAA,UAAU,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAC;aAC9B,IAAI,CAAC,UAAA,EAAE,IAAI,OAAA,EAAE,IAAI,eAAe,CAAC,KAAK,EAAE,EAAE,EAAE,MAAM,CAAC,SAAS,CAAC,GAAA,CAAC;aAC9D,IAAI,CAACxB,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAyC,CAAC;IAFvE,CAEuE,CACxE,CAAC;IAEF,IAAM,QAAQ,GAAGwB,cAAK,CAAC,UAAC,KAAK,EAAE,EAAE;QAC/B,IAAI,CAAC,EAAE;YAAE,OAAOC,gBAAO,CAAC,IAAI,CAAC,CAAC;QAC9B,OAAO,KAAK,CAAC,GAAG,CAAC,MAAI,EAAI,CAAC,CAAC,IAAI,CAAC,UAAC,IAAiB,IAAK,QAAC;YACtD,KAAK,EAAE9B,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC;YAC5B,SAAS,EAAEI,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,KAAK,CAAC,EAAE,IAAI,CAAC;SAC3C,IAAC,CAAC,CAAC;IACN,CAAC,EAAE,UAAU,CAAC,CAAC;IAEf,IAAM,WAAW,GAAGO,OAAO,CAAC,UAAC,GAAG,EAAE,IAAI,IAAK,OAAAiC,cAAS,CAAC/C,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,GAAG,EAAE,IAAI,IAAI,EAAE,CAAC,CAAC,GAAA,CAAC,CAAC;AAE3F,QAAa,KAAK,GAAG;QACnB,SAAS,WAAA;QACT,cAAc,gBAAA;QACd,WAAW,aAAA;QACX,SAAS,WAAA;QACT,kBAAkB,oBAAA;QAClB,eAAe,iBAAA;QACf,SAAS,WAAA;QACT,UAAU,YAAA;QACV,QAAQ,UAAA;QACR,QAAQ,UAAA;QACR,WAAW,aAAA;KACZ;;ICpJD,IAAM,MAAM,GAAGc,OAAO,CACpB,UAAC,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,IAAS;QAAT,qBAAA,EAAA,SAAS;QAClC,OAAA,IAAI,OAAO,CAAC,UAAC,EAAE,EAAE,IAAI;YACnB,IAAI,IAAI,IAAI,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE;gBACrC,IAAM,MAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;gBAC7B,MAAI,CAAC,MAAM,CACT,QAAQ,EACR,QAAQ,EACR,UAAC,GAAQ;oBACP,IAAI,GAAG,CAAC,GAAG,EAAE;wBACX,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;wBACd,MAAI,CAAC,KAAK,EAAE,CAAC;wBACb,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC;qBACzB;yBAAM;wBACL,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;qBACzC;iBACF,EACD,IAAI,CACL,CAAC;aACH;iBAAM;gBACL,IAAI,CAAC,mBAAmB,CAAC,CAAC;aAC3B;SACF,CAAC;IApBF,CAoBE,CACL,CAAC;IAEF,IAAM,KAAK,GAAGA,OAAO,CAAC,UAAC,IAAI,EAAE,QAAQ,EAAE,QAAQ;QAC7C,OAAA,IAAI,OAAO,CAAC,UAAC,EAAE,EAAE,IAAI;YACnB,IAAI,IAAI,IAAI,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE;gBACrC,IAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;gBAE7B,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,QAAQ,EAAE,UAAC,GAAQ;oBACrC,OAAA,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC;iBAAA,CACjD,CAAC;aACH;iBAAM;gBACL,IAAI,CAAC,mBAAmB,CAAC,CAAC;aAC3B;SACF,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM;YACZ,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;YACvC,OAAO,MAAM,CAAC;SACf,CAAC;IAbF,CAaE,CACH,CAAC;IAEF,IAAM,MAAM,GAAG,UAAC,IAAS,IAAK,OAAA,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,GAAA,CAAC;IACtD,IAAM,UAAU,GAAG,UAAC,IAAS,IAAK,OAAA,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,EAAE,GAAA,CAAC;IAClF,IAAM,OAAO,GAAGA,OAAO,CAAC,UAAC,IAAI,EAAE,EAAE,IAAK,QAAC,IAAI,CAAC,QAAQ,GAAG,EAAE,IAAC,CAAC,CAAC;AAE5D,IAAO,IAAM,cAAc,GAAG;QAC5B,MAAM,QAAA;QACN,KAAK,OAAA;QACL,MAAM,QAAA;QACN,UAAU,YAAA;QACV,OAAO,SAAA;KACR,CAAC;;ICpDF,IAAM,QAAQ,GAAG,UAAC,MAAc;QAC9B,IAAM,QAAQ,GAAG,CAAC,MAAM,IAAI,EAAE,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,IAAI;YAC3D,IAAM,MAAM,GAAG,IAAI;iBAChB,IAAI,EAAE;iBACN,KAAK,CAAC,GAAG,CAAC;iBACV,GAAG,CAACkC,MAAM,CAAC;iBACX,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,GAAA,CAAC,CAAC;YAElB,IAAI,CAAC,MAAM,CAAC,MAAM;gBAAE,OAAO,GAAG,CAAC;YAC/B,OAAOC,WAAW,CAAC,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC;SACrC,EAAE,EAAE,CAAC,CAAC;QAEP,IAAM,SAAS,GAAG,UAAC,CAAoB;YACrC,IAAI,KAAK,GAAG,CAAC,CAAC;YAEd,IAAI,OAAO,CAAC,KAAK,QAAQ;gBAAE,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAChD,OAAO,KAAK,IAAI1C,MAAM,CAAC,KAAiB,EAAE,QAAQ,CAAC,CAAC;SACrD,CAAC;QAEF,IAAM,SAAS,GAAG,UAAC,CAAoB,IAAe,OAAAT,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,GAAA,CAAC;QAC7E,IAAM,QAAQ,GAAG,UAAC,CAAoB,IAAoB,OAAA,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,GAAA,CAAC;QAClF,IAAM,YAAY,GAAG,UAAC,CAAoB,IAAK,OAAA,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,IAAI,IAAI,GAAA,CAAC;QAE1E,IAAM,aAAa,GAAG,UAAC,CAAoB;YACzC,IAAM,IAAI,GAAG,OAAO,CAAC,KAAK,QAAQ,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACtD,IAAM,MAAM,GAAG,EAAE,CAAC;YAClB,IAAI,IAAI,GAAG,OAAO,CAAC;YAEnB,OAAO,IAAI,EAAE;gBACX,IAAI,GAAG,QAAQ,CAAK,IAAI,QAAK,MAAM,EAAE,IAAI,EAAE,CAAC;gBAC5C,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aAC3B;YAED,OAAO,MAAM,CAAC;SACf,CAAC;QAEF,IAAM,QAAQ,GAAG,UAAC,CAAoB;YACpC,IAAM,IAAI,GAAG,OAAO,CAAC,KAAK,QAAQ,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAEtD,OAAO,SAAS,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,UAAC,KAAY,EAAE,GAAW;gBACtD,IAAM,GAAG,GAAG,QAAQ,CAAK,IAAI,SAAE,GAAG,GAAE,CAAC;gBAErC,OAAW,KAAK,SAAE,CAAC,GAAG,EAAE,GAAG,CAAC,GAAE;aAC/B,EAAE,EAAE,CAAC,CAAC;SACR,CAAC;QAEF,OAAO;YACL,MAAM,QAAA;YACN,SAAS,WAAA;YACT,QAAQ,UAAA;YACR,SAAS,WAAA;YACT,YAAY,cAAA;YACZ,aAAa,eAAA;YACb,QAAQ,UAAA;SACT,CAAC;IACJ,CAAC,CAAC;AAEF,IAAO,IAAM,SAAS,GAAG,EAAE,QAAQ,UAAA,EAAE,CAAC;;ICtDtC,IAAM,UAAU,GAAG,UAAC,MAAc,EAAE,OAAY,EAAE,SAAc;;QAA5B,wBAAA,EAAA,YAAY;QAAE,0BAAA,EAAA,cAAc;QAC9D,IAAM,SAAS,GAAG,SAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAC7C,IAAM,GAAG,gBAA+B,SAAS,CAAE,CAAC;QAC5C,IAAA,+BAAS,EAAE,6BAAQ,EAAE,+BAAS,EAAE,uCAAa,EAAE,6BAAQ,CAAe;QAE9E,uCAGsC,EAFpC,UAA4B,EAA5B,iDAA4B,EAC5B,UAA+D,EAA/D,oFAA+D,CAC1B;QACvC,GAAG,CAAC,WAAW,GAAG,SAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,SAAS,CAAC;QAC1D,GAAG,CAAC,OAAO,GAAG,QAAQ,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC;QACtD,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC,WAAW,CAAC,IAAI,GAAG,CAAC,OAAO,CAAC;QACrD,GAAG,CAAC,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;QAC3B,GAAG,CAAC,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC;;QAG5B,IAAI,GAAG,CAAC,IAAI,KAAK,SAAS;YAAE,GAAG,CAAC,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;QAEvD,GAAG,CAAC,eAAe,GAAG,CAAC,CAAC,SAAS,CAAC,mBAAmB,CAAC,CAAC;QACvD,GAAG,CAAC,QAAQ,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC;QACpC,GAAG,CAAC,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC;QAClC,GAAG,CAAC,YAAY,GAAG,CAAC,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;QAC7C,GAAG,CAAC,SAAS,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAC;QACpC,GAAG,CAAC,UAAU,GAAG,UAAC,EAAU,IAAK,OAAA,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,GAAA,CAAC;QACvE,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QAC5C,GAAG,CAAC,YAAY,GAAG,SAAS,CAAC,WAAW,CAAC,CAAC;QAC1C,GAAG,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,CAAC,CAAC;QACxC,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC;QAEpC,IAAI,OAAO,IAAI,SAAS,EAAE;YACxB,GAAG,CAAC,SAAS,GAAG,SAAS,CAAC;YAC1B,GAAG,CAAC,KAAK,GAAG,OAAO,CAAC;YACpB,GAAG,CAAC,cAAc,GAAG,CAAC,SAAS,CAAC,SAAS,CAAC,sBAAsB,CAAC,CAAC;YAClE,GAAG,CAAC,QAAQ,GAAG,WAAS,OAAO,gBAAW,SAAW,CAAC;YACtD,IAAI,GAAG,CAAC,WAAW;gBAAE,GAAG,CAAC,UAAU,GAAM,GAAG,CAAC,QAAQ,YAAS,CAAC;YAC/D,GAAG,CAAC,UAAU,GAAG,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YAC3C,GAAG,CAAC,cAAc,GAAG,GAAG,CAAC,UAAU,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,GAAG,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC;SAC1F;QAED,GAAG,CAAC,OAAO,GAAG;YACZ,SAAS,EAAE,EAAE;YACb,KAAK,EAAE;gBACL,SAAS,EAAE,QAAQ,CAAC,mBAAmB,CAAC;gBACxC,IAAI,EAAE,QAAQ,CAAC,MAAM,CAAC;gBACtB,GAAG,EAAE,SAAS,CAAC,IAAI,CAAC;gBACpB,OAAO,EAAE,SAAS,CAAC,OAAO,CAAC;gBAC3B,OAAO,EAAE,SAAS,CAAC,QAAQ,CAAC;gBAC5B,OAAO,EAAE,SAAS,CAAC,QAAQ,CAAC;gBAC5B,MAAM,EAAE,SAAS,CAAC,OAAO,CAAC;gBAC1B,QAAQ,EAAE,SAAS,CAAC,SAAS,CAAC;gBAC9B,KAAK,EAAE,SAAS,CAAC,MAAM,CAAC;gBACxB,IAAI,EAAE,CAAC,SAAS,CAAC,gBAAgB,CAAC;gBAClC,MAAM,EAAE,CAAC,SAAS,CAAC,cAAc,CAAC;aACnC;YACD,IAAI,EAAE;gBACJ,OAAO,EAAE,SAAS,CAAC,WAAW,CAAC;gBAC/B,OAAO,EAAE,SAAS,CAAC,YAAY,CAAC;gBAChC,OAAO,EAAE,SAAS,CAAC,YAAY,CAAC;gBAChC,MAAM,EAAE,SAAS,CAAC,WAAW,CAAC;gBAC9B,IAAI,EAAE,CAAC,CAAC,SAAS,CAAC,gBAAgB,CAAC;gBACnC,MAAM,EAAE,CAAC,CAAC,SAAS,CAAC,cAAc,CAAC;gBACnC,IAAI,EAAE,QAAQ,CAAC,YAAY,CAAC;aAC7B;SACF,CAAC;QAEF,GAAG,CAAC,WAAW,GAAG;YAChB,SAAS,EAAE,EAAE;YACb,MAAM,EAAE,QAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC,IAAI,IAAI;YACzD,MAAM,EAAE,QAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC,IAAI,IAAI;YACzD,QAAQ,EAAE,QAAQ,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC,IAAI,IAAI;YAC7D,QAAQ,EAAE,QAAQ,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC,IAAI,IAAI;YAC7D,QAAQ,EAAE,QAAQ,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC,IAAI,IAAI;YAC7D,QAAQ,EAAE,QAAQ,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC,IAAI,IAAI;SAC9D,CAAC;QAEF,GAAG,CAAC,OAAO,GAAGoD,MAAM,CAACnC,KAAK,CAAgBW,KAAK,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAC5E,OAAO,GAAG,CAAC;IACb,CAAC,CAAC;AAEF,IAAO,IAAM,iBAAiB,GAAG,EAAE,UAAU,YAAA,EAAE,CAAC;;ICjFhD,IAAM,WAAW,GAAG,UAAC,UAAiC;QACpD,OAAA,CAAC,CAACyB,MAAM,CAAC,UAAU,CAAC,SAAS,EAAE;YAC7B,UAAU;YACV,UAAU;YACV,WAAW;YACX,oBAAoB;YACpB,KAAK;YACL,OAAO;YACP,OAAO;YACP,YAAY;SACb,CAAC;IATF,CASE,CAAC;IAEL,IAAM,SAAS,GAAG,UAAC,UAAiC;QAClD,OAAA,CAAC,CAACA,MAAM,CAAC,UAAU,CAAC,SAAS,EAAE;YAC7B,OAAO;YACP,QAAQ;YACR,QAAQ;YACR,mBAAmB;YACnB,MAAM;YACN,MAAM;YACN,gBAAgB;YAChB,cAAc;YACd,OAAO;YACP,YAAY;YACZ,WAAW;YACX,YAAY;YACZ,WAAW;SACZ,CAAC;IAdF,CAcE,CAAC;IAEL,IAAM,aAAa,GAAG,UAAC,UAAiC;QACtD,IAAM,QAAQ,GAAGpD,QAAQ,CAAC,EAAE,EAAE,CAAC,SAAS,EAAE,OAAO,EAAE,UAAU,CAAC,EAAE,UAAU,CAAC,CAAC;QACpE,IAAA,sBAAI,CAAgB;QAC5B,IAAM,YAAY,GAAGgB,KAAK,CAAC,UAAA,CAAC,IAAI,OAAG,CAAC,SAAI,IAAM,GAAA,EAAE,QAAQ,CAAC,CAAC;QAE1D,OAAO,EAAE,YAAY,cAAA,EAAE,CAAC;IAC1B,CAAC,CAAC;IAEF,IAAM,WAAW,GAAG,UAAC,UAAiC;QAC5C,IAAA,sBAAI,CAAgB;QAC5B,IAAM,MAAM,GAAGhB,QAAQ,CAAC,EAAE,EAAE,CAAC,SAAS,EAAE,OAAO,EAAE,QAAQ,CAAC,EAAE,UAAU,CAAC,CAAC;QAExE,IAAI,CAAC,MAAM,CAAC,MAAM;YAAE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACvC,IAAM,YAAY,GAAGgB,KAAK,CAAC,UAAA,CAAC,IAAI,OAAA,QAAM,CAAC,SAAI,IAAM,GAAA,EAAE,MAAM,CAAC,CAAC;QAE3D,OAAO,EAAE,YAAY,cAAA,EAAE,CAAC;IAC1B,CAAC,CAAC;IAEF,IAAM,YAAY,GAAG,UAAC,UAAiC;QAC7C,IAAA,sBAAI,CAAgB;QAC5B,IAAM,OAAO,GAAGhB,QAAQ,CAAC,EAAE,EAAE,CAAC,SAAS,EAAE,OAAO,EAAE,SAAS,CAAC,EAAE,UAAU,CAAC,CAAC;QAE1E,IAAI,CAAC,OAAO,CAAC,MAAM;YAAE,OAAO,WAAW,CAAC,UAAU,CAAC,CAAC;QACpD,IAAM,YAAY,GAAGgB,KAAK,CAAC,UAAA,CAAC,IAAI,OAAA,aAAW,CAAC,SAAI,IAAM,GAAA,EAAE,OAAO,CAAC,CAAC;QAEjE,OAAO,EAAE,YAAY,cAAA,EAAE,CAAC;IAC1B,CAAC,CAAC;IAEF,IAAM,YAAY,GAAG,UAAC,UAAiC;QAC7C,IAAA,sBAAI,CAAgB;QAC5B,IAAM,SAAS,GAAGhB,QAAQ,CAAC,EAAE,EAAE,CAAC,SAAS,EAAE,OAAO,EAAE,SAAS,CAAC,EAAE,UAAU,CAAC,CAAC;QAC5E,IAAM,IAAI,GAAGQ,MAAM,CAAC,CAAC,SAAS,EAAE,OAAO,EAAE,MAAM,CAAC,EAAE,UAAU,CAAC,IAAI,UAAU,CAAC;QAE5E,IAAI,CAAC,SAAS,CAAC,MAAM;YAAE,OAAO,WAAW,CAAC,UAAU,CAAC,CAAC;QACtD,IAAM,YAAY,GAAGQ,KAAK,CAAC,UAAA,EAAE,IAAI,OAAA,WAAS,EAAE,SAAI,IAAI,SAAI,IAAM,GAAA,EAAE,SAAS,CAAC,CAAC;QAE3E,OAAO,EAAE,YAAY,cAAA,EAAE,CAAC;IAC1B,CAAC,CAAC;IAEF,IAAM,aAAa,GAAG,UAAC,UAAiC;QAC9C,IAAA,sBAAI,CAAgB;QAC5B,IAAM,QAAQ,GAAGZ,MAAM,CAAC,UAAU,EAAE,UAAU,CAAC,IAAI,EAAE,CAAC;QAEtD,IAAI,CAAC,QAAQ,CAAC,MAAM;YAAE,OAAO,WAAW,CAAC,UAAU,CAAC,CAAC;QACrD,IAAM,YAAY,GAAGY,KAAK,CAAC,UAAA,EAAE,IAAI,OAAA,WAAS,EAAE,mBAAc,IAAM,GAAA,EAAE,QAAQ,CAAC,CAAC;QAE5E,OAAO,EAAE,YAAY,cAAA,EAAE,CAAC;IAC1B,CAAC,CAAC;IAEF,IAAM,QAAQ,GAAG,UAAC,UAAiC;QACzC,IAAA,sBAAI,CAAgB;QAC5B,IAAM,aAAa,GAAGhB,QAAQ,CAAC,EAAE,EAAE,CAAC,SAAS,EAAE,OAAO,EAAE,KAAK,CAAC,EAAE,UAAU,CAAC,CAAC;QAE5E,IAAI,CAAC,aAAa,CAAC,MAAM;YAAE,WAAW,CAAC,UAAU,CAAC,CAAC;QACnD,IAAM,YAAY,GAAGgB,KAAK,CAAC,UAAA,EAAE,IAAI,OAAA,aAAW,EAAE,kBAAa,IAAM,GAAA,EAAE,aAAa,CAAC,CAAC;QAElF,OAAO,EAAE,YAAY,cAAA,EAAE,CAAC;IAC1B,CAAC,CAAC;IAEF,IAAM,aAAa,GAAG,UAAC,UAAiC;QAC9C,IAAA,sBAAI,CAAgB;QAC5B,IAAM,EAAE,GAAGR,MAAM,CAAC,CAAC,SAAS,EAAE,OAAO,EAAE,WAAW,CAAC,EAAE,UAAU,CAAC,CAAC;QACjE,IAAM,IAAI,GAAGA,MAAM,CAAC,CAAC,SAAS,EAAE,OAAO,EAAE,MAAM,CAAC,EAAE,UAAU,CAAC,CAAC;QAE9D,IAAM,YAAY,GAAG,CAAC,WAAS,EAAE,iBAAY,IAAI,SAAI,IAAM,CAAC,CAAC;QAE7D,OAAO,EAAE,YAAY,cAAA,EAAE,CAAC;IAC1B,CAAC,CAAC;IAEF,IAAM,OAAO,GAAG;QACd,OAAO,EAAE,aAAa;QACtB,OAAO,EAAE,aAAa;QACtB,EAAE,EAAE,QAAQ;QACZ,OAAO,EAAE,aAAa;QACtB,MAAM,EAAE,YAAY;QACpB,MAAM,EAAE,YAAY;QACpB,KAAK,EAAE,WAAW;KACnB,CAAC;IAEF,IAAM,WAAW,GAAGD,MAAM,CAAC,OAAO,CAAC,CAAC;IACpC,IAAM,UAAU,GAAG,UAAC,GAA0B,IAAK,OAAA6C,MAAM,CAAC,GAAG,CAAC,SAAS,EAAE,WAAW,CAAC,IAAI,OAAO,GAAA,CAAC;IACjG,IAAM,cAAc,GAAG,UAAC,UAAiC;QACvD,IAAM,IAAI,GAAG,UAAU,CAAC,UAAU,CAAC,CAAC;QAEpC,OAAOC,WAAW,CAAC,EAAE,IAAI,MAAA,EAAE,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;IAC1D,CAAC,CAAC;AAEF,IAAO,IAAM,iBAAiB,GAAG;QAC/B,cAAc,gBAAA;QACd,OAAO,SAAA;QACP,WAAW,aAAA;QACX,SAAS,WAAA;KACV,CAAC;;IC5HF,sBAsPA;IAtOA,IAAM,OAAO,GAAG,UAAC,CAAW;QAC1B,OAAAnD,SAAS,CACP,QAAQ,EACRF,QAAQ,CAAC,EAAE,EAAE,CAAC,CAAC,CAChB;IAHD,CAGC,CAAC;IAIJ,IAAMsD,gBAAc,GAAG,UAAC,UAAiC;QAC/C,IAAA,4BAAO,EAAE,oCAAW,EAAE,gCAAS,CAAgB;QACvD,IAAM,eAAe,GAAqB,EAAE,CAAC;QAC7C,IAAM,mBAAmB,GAAqB,EAAE,CAAC;QACjD,IAAM,SAAS,GAAG;YAAC,aAAkB;iBAAlB,UAAkB,EAAlB,qBAAkB,EAAlB,IAAkB;gBAAlB,wBAAkB;;YACnC,OAAA,eAAe,CAAC,IAAI,CAACpD,SAAS,OAAT,CAAC,EAAa,GAAwB,EAAE;SAAA,CAAC;QAChE,IAAM,aAAa,GAAG;YAAC,aAAkB;iBAAlB,UAAkB,EAAlB,qBAAkB,EAAlB,IAAkB;gBAAlB,wBAAkB;;YACvC,OAAA,mBAAmB,CAAC,IAAI,CAACA,SAAS,OAAT,CAAC,EAAa,GAAwB,EAAE;SAAA,CAAC;QAEpE,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE;YAChC,SAAS,CAAC,UAAC,CAAS,IAAK,OAAA,CAAC,CAAC,SAAS,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,GAAA,EAAEM,MAAM,CAAC,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;SACjF;QACD,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE;YAChC,SAAS,CAAC,UAAC,CAAS,IAAK,OAAA,CAAC,CAAC,SAAS,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,GAAA,EAAEA,MAAM,CAAC,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC;SACpF;QACD,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE;YAChC,SAAS,CAAC,UAAC,CAAS,IAAK,OAAA,CAAC,CAAC,SAAS,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,GAAA,EAAE,aAAa,CAAC,MAAM,EAAEJ,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;SAC5F;QAED,IACE,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM;YAC3B,CAACgD,MAAM,CACLlD,SAAS,CACPqD,WAAW,CAAC,KAAK,CAAC,EAClBpB,MAAoC,EACpChB,OAAO,CAAC,GAAG,CAAC,CACb,EACD,OAAO,CAAC,KAAK,CAAC,MAAkB,CACjC,EACD;YACA,SAAS,CAAC,UAAC,IAAuB;gBAChC,IAAI,KAAK,GAAGX,MAAM,CAAC,CAAC,MAAM,EAAE,OAAO,CAAC,EAAE,IAAI,CAAC,CAAC;gBAC5C,IAAM,IAAI,GAAGA,MAAM,CAAC,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC;gBAE5C,IAAI,IAAI,KAAK,SAAS;oBAAE,KAAK,GAAG,UAAQ,KAAO,CAAC;gBAChD,IAAI,IAAI,KAAK,SAAS;oBAAE,KAAK,GAAG,cAAY,KAAO,CAAC;gBACpD,OAAO,CAAC,CAAC,SAAS,CAAC,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC;aACtC,CAAC,CAAC;SACJ;QAED,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE;YAC9B,SAAS,CAAC,UAAC,IAAY,IAAK,OAAA,CAAC,CAAC,SAAS,CAAC,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,GAAA,EAAEA,MAAM,CAAC,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC;SACpF;QACD,IAAI,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,UAAU,EAAE;YACrC,SAAS,CACPN,SAAS,CACPyC,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,EAC5B3C,QAAQ,CAAC,EAAE,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAC/B,CACF,CAAC;SACH;QAED,IAAI,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;YAC/B,SAAS,CAAC,UAAC,KAAa,IAAK,OAAA,CAAC,SAAS,CAAC,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC,GAAA,EAAEQ,MAAM,CAAC,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;SAC/F;QACD,IAAI,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;YAC/B,SAAS,CACP,UAAC,QAAgB,IAAK,OAAA,CAAC,SAAS,CAAC,CAAC,KAAK,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC,GAAA,EAC7DA,MAAM,CAAC,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC,CAC7B,CAAC;SACH;QACD,IAAI,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;YAC/B,SAAS,CACP,UAAC,MAAc,IAAK,OAAA,CAAC,MAAM,IAAI,CAAC,SAAS,CAAC,CAAC,KAAK,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC,GAAA,EACpE,aAAa,CAAC,MAAM,CACrB,CAAC;SACH;QACD,IAAI,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;YAC9B,SAAS,CAAC,UAAC,KAAa,IAAK,OAAA,CAAC,SAAS,CAAC,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC,GAAA,EAAEA,MAAM,CAAC,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC;SAC9F;QACD,IAAI,OAAO,CAAC,IAAI,CAAC,IAAI;YAAE,SAAS,CAACA,MAAM,CAAC,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC;QAC/D,IAAI,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE;YACvB,SAAS,CACPN,SAAS,CACP,UAAA,QAAQ,IAAI,OAAA,CAAC,QAAQ,GAAA,EACrBF,QAAQ,CAAC,EAAE,EAAE,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC,CACnC,CACF,CAAC;SACH;QAED,IAAI,WAAW,CAAC,MAAM,KAAK,IAAI,EAAE;YAC/B,aAAa,CAACwD,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,EAAE,OAAO,CAAC,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;SACpE;QACD,IAAI,WAAW,CAAC,MAAM,KAAK,IAAI,EAAE;YAC/B,aAAa,CAACC,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,EAAE,OAAO,CAAC,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;SACpE;QACD,IAAI,WAAW,CAAC,QAAQ,KAAK,IAAI,EAAE;YACjC,aAAa,CAACD,KAAK,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC;SACxE;QACD,IAAI,WAAW,CAAC,QAAQ,KAAK,IAAI,EAAE;YACjC,aAAa,CAACC,KAAK,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC;SACxE;QACD,IAAI,WAAW,CAAC,QAAQ,KAAK,IAAI,EAAE;YACjC,aAAa,CAACD,KAAK,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE,OAAO,CAAC,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC;SACzE;QACD,IAAI,WAAW,CAAC,QAAQ,KAAK,IAAI,EAAE;YACjC,aAAa,CAACC,KAAK,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE,OAAO,CAAC,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC;SACzE;QAED,IAAI,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YAC5B,aAAa,CAAC,UAAC,KAAwB;gBACrC,IAAM,IAAI,GAAGjD,MAAM,CAAC,CAAC,OAAO,EAAE,UAAU,CAAC,EAAE,KAAK,CAAC,IAAI,EAAE,CAAC;gBAExD,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAC5B,UAAC,EAAqC;wBAApC,eAAO,EAAE,gBAAQ;oBAAwB,OAAA,CAAC,CAACA,MAAM,CAAC,CAAC,QAAQ,EAAE,KAAK,EAAE,OAAO,CAAC,EAAE,IAAI,CAAC;iBAAA,CACtF,CAAC;aACH,CAAC,CAAC;SACJ;QAED,IAAM,aAAa,GAAG,UAAC,KAAwB,IAAK,OAAA,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,EAAE,IAAI,OAAA,CAAC,EAAE,CAAC,KAAK,CAAC,GAAA,CAAC,GAAA,CAAC;QAC5F,IAAM,UAAU,GAAG,UAAC,KAAwB,IAAK,OAAA,CAAC,mBAAmB,CAAC,IAAI,CAAC,UAAA,EAAE,IAAI,OAAA,CAAC,EAAE,CAAC,KAAK,CAAC,GAAA,CAAC,GAAA,CAAC;QAC7F,IAAM,WAAW,GAAG,UAAC,KAAwB;YAC3C,OAAA,UAAU,CAAC,UAAU,CAACC,QAAQ,CAAC,EAAE,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC,KAAK,aAAa,CAAC,KAAK,CAAC,IAAI,UAAU,CAAC,KAAK,CAAC,CAAC;SAAA,CAAC;QAClG,OAAO,EAAE,WAAW,aAAA,EAAE,aAAa,eAAA,EAAE,UAAU,YAAA,EAAE,CAAC;IACpD,CAAC,CAAC;IAWF,IAAM,eAAe,GAAG,UACtB,KAAe,EACf,IAAqB,EACrB,UAA4B,EAC5B,MAAsB;;;;;;oBAEhB,KAKF,MAAM,IAAI,EAAE,EAJd,aAAuB,EAAhB,SAAS,mBAAG,IAAI,KAAA,EACvB,aAAsB,EAAf,SAAS,mBAAG,GAAG,KAAA,EACtB,aAAY,EAAZ,AACA,gBAAkC,EAAlC,QAAQ,mBAAGgB,QAAQ,CAACS,gBAAO,CAAC,IAAI,CAAC,CAAC,KAAA,CACnB;oBACX,KAAK,GAAG,QAAQ,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;oBAChC,KAAK,GAAG,QAAQ,CAAC,SAAS,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC;oBACrC,IAAI,GAAG,UAAU,CAAC,KAAK,EAAE,CAAC;oBAC1B,QAAQ,GAAqB,EAAE,CAAC;oBAChC,IAAI,GAAU,EAAE,CAAC;oBACjB,UAAU,GAAG,UAAC,IAAS;wBAAT,qBAAA,EAAA,SAAS;wBAC3B,OAAAa,YAAG,CACD/B,KAAK,CAAC,UAAM,GAAG;;;;;wCACT,SAAS,GAAG,IAAI,CAAC;wCAErB,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,EAAE;4CAC5B,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;4CAC7B,sBAAO;yCACR;6CAEG,QAAQ,EAAR,wBAAQ;wCAAc,qBAAM,QAAQ,CAAE,GAAG,CAAC,WAAW,CAAC,MAAM,CAAY,IAAI,EAAE,CAAC,EAAA;;wCAArE,SAAS,GAAG,SAAyD,CAAC;;;6CAChF,SAAS,EAAT,wBAAS;6CACP,IAAI,CAAC,eAAe,EAApB,wBAAoB;wCACL,qBAAM,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,EAAA;;wCAAhE,QAAQ,GAAG,SAAqD;wCAChE,GAAG,GAAG,aAAa,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;wCAExC,IACE,GAAG;4CACHoC,MAAM,CACJlD,SAAS,CACPqC,QAAQ,CAAC,GAAG,CAAC,EACb,aAAa,CAAC,GAAG,CAClB,EACD,IAAI,CACL,EACD;4CACA,sBAAO;yCACR;wCACD,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;;;wCAEtB,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;;;;6BAEtB,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAC7B;qBAAA,CAAC;;;0BAEG,IAAI,CAAC,MAAM,GAAG,KAAK,CAAA;oBACZ,qBAAM,UAAU,EAAE,EAAA;;oBAAxB,GAAG,GAAG,SAAkB;oBAC9B,IAAI,KAAK,IAAI,QAAQ,CAAC,MAAM,IAAI,KAAK;wBAAE,wBAAM;;wBAG/C,sBAAOrC,SAAS,CACd,KAAK;0BACAe,OAAO,CAAC,CAAC,EAAE,KAAK,CAAkD;0BAClEW,UAA2D,EAChEQ,QAAQ,CAACT,KAAK,CAAC,WAAW,CAAC,OAAO,CAAoC,CAEjD,EACrBF,QAAQ,CAAC,QAAQ,CAA2B,CAC7C,EAAE,EAAC;;;SACL,CAAC;IAEF,IAAM,cAAc,GAKKvB,SAAS,CAChC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,CAACc,KAAK,CAACW,KAAK,CAAC,WAAW,CAAC,MAAM,CAAoC,CAAC,CAAC,GAAA,EAChF,eAAe,CAChB,CAAC;IAEF,IAAM,WAAW,GAAGZ,OAAO,CACzB,UAAC,KAAK,EAAE,IAAI,EAAE,OAAO;QACnB,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC;YAAE,OAAOmB,gBAAO,CAAC,IAAI,CAAC,CAAC;QAEnD,OAAO,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE;YAC5B,SAAS,EAAE,IAAI,CAAC,SAAS;YACzB,SAAS,EAAE,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC;YAClD,MAAM,EAAE,iBAAiB,CAAC,WAAW,CAAC,IAAI,CAAC;YAC3C,IAAI,EAAE,iBAAiB,CAAC,SAAS,CAAC,IAAI,CAAC;SACxC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IAC5B,CAAC,CACF,CAAC;AAEF,IAAO,IAAM,aAAa,GAAG;QAC3B,cAAc,kBAAA;QACd,eAAe,iBAAA;QACf,cAAc,gBAAA;QACd,WAAW,aAAA;KACZ,CAAC;;IC5OF,IAAMwB,YAAU,GAAGxD,SAAS,CAC1ByD,OAAO,CAACN,WAAW,CAAgC,EACnDO,MAAM,CAAC,CAAC,aAAa,CAAC,cAAc,EAAEhC,UAAU,CAAC,CAAC,EAClD+B,OAAO,CAAC1D,OAAO,CAAC,YAAY,CAAC,CAAsC,EACnE2D,MAAM,CAAC,CAAC,iBAAiB,CAAC,cAAc,EAAEhC,UAAU,CAAC,CAAC,EACtD,iBAAiB,CAAC,UAAU,CACgD,CAAC;IAE/E,IAAM,SAAS,GAAGK,cAAK,CAAS,UAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,KAAU;QAAV,sBAAA,EAAA,UAAU;QAChE,OAAA,KAAK,CAAC,QAAQ,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC,IAAI,CACxC/B,SAAS,CACP,UAAA,IAAI,IAAI,OAAG,IAAI,+BAEnB,KAAK,IAAI,EAAE,6BACO,QAAQ,SAAI,IAAI,OACnC,GAAA,EACK,aAAa,CAAC,IAAI,CACnB,CACF;IATD,CASC,CACF,CAAC;AAEF,IAAO,IAAM,WAAW,GAAG,EAAE,UAAU,cAAA,EAAE,SAAS,WAAA,EAAE,CAAC;;ICxB/C,IAAA2D,aAA0B,EAAzBC,kBAAM,EAAEC,mBAAiB,CAAC;IACjC,IAAM,KAAK,GAAG/C,KAAK,CAACW,KAAK,CAACmC,QAAM,CAAC,CAAC,CAAC;IACnC,IAAM,SAAS,GAAG1B,QAAQ,CAACT,KAAK,CAACoC,SAAO,CAAiC,CAAC,CAAC;IAE3E,IAAM,QAAQ,GAAG,UAAC,EAA+C;QAC/D,OAAA9B,cAAK,CAAS,UAAC,KAAK,EAAE,OAAO,EAAE,IAAI;YACjC,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC;gBAAE,OAAOC,gBAAO,CAAC,CAAC,QAAQ,CAAC,CAAC;YACxD,IAAI8B,UAAU,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC;gBAAE,OAAO9B,gBAAO,CAAC,CAAC,QAAQ,CAAC,CAAC;YAE3E,OAAO,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE;gBAC5B,SAAS,EAAE,IAAI,CAAC,SAAS;gBACzB,MAAM,EAAE,IAAI;gBACZ,SAAS,EAAE,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC;aACnD,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;SACb,CAAC;IATF,CASE,CAAC;IAEL,IAAM,QAAQ,GAAG,UAAC,EAA+C;QAC/D,OAAAD,cAAK,CAAS,UAAC,KAAK,EAAE,OAAO,EAAE,IAAI;YACjC,OAAA,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE;gBACrB,SAAS,EAAE,IAAI,CAAC,SAAS;gBACzB,SAAS,EAAE,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC;aACnD,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC;SAAA,CACZ;IALD,CAKC,CAAC;IAEJ,IAAM,KAAK,GAAG;QACZ,GAAG,EAAE,QAAQ,CACX/B,SAAS,CACP+D,UAAU,CAAC,CAAC,CAAC,CAAC,EACd,QAAQ,EACRxD,QAAQ,CAAC,CAAC,EAAE,WAAW,CAAC,CACzB,CACF;QACD,GAAG,EAAE,QAAQ,CACXP,SAAS,CACP,UAAC,CAAS,IAAK,OAAA,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,GAAA,EACnCF,QAAQ,CAAC,GAAG,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,CAClC,CACF;QACD,QAAQ,EAAE,QAAQ,CAChBE,SAAS,CACP,UAAC,CAAS,IAAK,OAAA,CAAC,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,GAAA,EACjCF,QAAQ,CAAC,GAAG,EAAE,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC,CACpC,CACF;QACD,SAAS,EAAE,QAAQ,CAAC,UAAA,KAAK;YACvB,IAAM,SAAS,GAAG,QAAQ,CAACS,QAAQ,CAAC,EAAE,EAAE,WAAW,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;YACjE,IAAM,KAAK,GAAG,QAAQ,CAACT,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;YACrE,IAAM,OAAO,GAAG,SAAS,GAAG,IAAI,GAAG,UAAU,CAAC;YAC9C,IAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAEvD,IAAI,CAAC,KAAK;gBAAE,OAAO,UAAU,GAAG,OAAO,CAAC;YACxC,OAAO,CAAC,CAAC,IAAI,KAAK,GAAG,OAAO,GAAG,KAAK,CAAC,CAAC;SACvC,CAAC;QACF,GAAG,EAAE,QAAQ,CAAC,UAAA,KAAK;YACjB,IAAM,SAAS,GAAG,QAAQ,CAACS,QAAQ,CAAC,EAAE,EAAE,WAAW,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;YACjE,IAAM,KAAK,GAAG,QAAQ,CAACT,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;YACnE,IAAM,OAAO,GAAG,SAAS,GAAG,IAAI,GAAG,UAAU,CAAC;YAC9C,IAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACvD,IAAI,IAAI,GAAG,CAAC,CAAC;YAEb,IAAI,KAAK,GAAG,CAAC,EAAE;gBACb,IAAI,GAAG,CAAC,CAAC;aACV;iBAAM,IAAI,KAAK,GAAG,CAAC,EAAE;gBACpB,IAAI,GAAG,CAAC,CAAC,CAAC;aACX;YACD,OAAO,CAAC,CAAC,IAAI,IAAI,GAAG,KAAK,GAAG,OAAO,GAAG,KAAK,CAAC,CAAC;SAC9C,CAAC;QACF,IAAI,EAAE,QAAQ,CAAC,UAAA,KAAK;YAClB,IAAM,GAAG,GAAG,QAAQ,CAACA,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;YAC9D,IAAM,KAAK,GAAG,QAAQ,CAACA,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;YAClE,IAAM,CAAC,GAAG,GAAG,GAAG,KAAK,CAAC;YAEtB,IAAI,CAAC,KAAK,CAAC;gBAAE,OAAO,CAAC,CAAC;YACtB,IAAM,CAAC,GAAG,cAAc,CAAC;YACzB,IAAM,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC;YAClB,IAAM,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACvC,IAAM,KAAK,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YACvE,IAAM,KAAK,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAElC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,KAAK,IAAI,KAAK,CAAC,CAAC;SACtC,CAAC;QACF,aAAa,EAAE,QAAQ,CAAC,UAAA,KAAK;YAC3B,IAAM,GAAG,GAAG,QAAQ,CAACA,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;YAC9D,IAAM,KAAK,GAAG,QAAQ,CAACA,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;YAElE,IAAI,GAAG,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC;gBAAE,OAAO,CAAC,CAAC;YACrC,IAAM,SAAS,GAAG,GAAG,GAAG,KAAK,CAAC;YAC9B,IAAM,OAAO,GAAG,GAAG,GAAG,KAAK,GAAG,KAAK,GAAG,GAAG,GAAG,GAAG,GAAG,KAAK,CAAC;YAExD,OAAO,CAAC,CAAC,GAAG,SAAA,SAAS,EAAI,OAAO,CAAA,CAAC;SAClC,CAAC;KACH,CAAC;IAEF,IAAM,WAAW,GAAG,UAAC,IAAY,IAAK,OAAA,CAAC,EAAE,IAAI,IAAI,KAAK,CAAC,GAAA,CAAC;AAExD,IAAO,IAAM,WAAW,GAAG;QACzB,MAAM,UAAA;QACN,OAAO,WAAA;QACP,KAAK,OAAA;QACL,WAAW,aAAA;QACX,KAAK,OAAA;QACL,SAAS,WAAA;KACV,CAAC;;ICzGF,IAAM,YAAY,GAAGE,SAAS,CAC5BkC,QAAQ,CAACR,UAAU,CAA2B,EAC9CR,QAAQ,CAACQ,UAAiC,CAAC,EAC3CZ,KAAK,CAACiC,MAAM,CAAC,EACb9B,OAAO,CAAC,GAAG,CAAC,EACZ+C,SAAS,EACTC,WAAW,CAAC,EAAE,CAAsC,CACrD,CAAC;IAEF,IAAM,WAAW,GAAGjE,SAAS,CAC3BkE,QAAQ,CAAChE,MAAM,CAAC,QAAQ,CAAC,EAAEwB,UAAU,EAAEH,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EACzD,YAAY,CACkB,CAAC;IAEjC,IAAM,SAAS,GAAG,UAAC,GAAQ,IAAK,OAAAxB,OAAO,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,GAAA,CAAC;AAE3E,IAAO,IAAM,IAAI,GAAG,EAAE,YAAY,cAAA,EAAE,WAAW,aAAA,EAAE,SAAS,WAAA,EAAE,CAAC;;ICZ7D,IAAM,IAAI,GAAG,iBAAiB,CAAC;IAC/B,IAAM,IAAI,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,eAAe,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;IAE7E,IAAMoE,WAAS,GAAGpC,cAAK,CACrB,UAAC,KAAe,EAAE,EAAgD;YAA9C,gBAAK,EAAE,cAAI;QAC7B,IAAM,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QACvC,IAAM,QAAQ,GAAG,MAAM,CAAC,CAAC,CAAC,KAAK,KAAK,GAAG,UAAU,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;QAE9D,OAAO,WAAW,CAAC,SAAS,CAC1B,KAAK,EACL,MAAM,CAAC,OAAO,EACd,eAAe,EACf;YACE,UAAQ,KAAO;YACf,eAAa,QAAU;YACvB,UAAQ,IAAM;YACd,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,GAAG,iBAAiB,GAAG,EAAE;iBAC/CjB,KAAK,CAAC,UAAA,KAAK,IAAI,OAAA,WAAS,KAAO,GAAA,EAAE,MAAM,CAAC,EACxCA,KAAK,CAAC,UAAA,GAAG,IAAI,OAAA,SAAO,GAAG,YAAO,KAAK,SAAI,GAAK,GAAA,EAAE,IAAI,CAAC,EACtD,IAAI,CAAC,IAAI,CAAC,CACb,CAAC;IACJ,CAAC,CACF,CAAC;IAEF,IAAM,OAAO,GAAGiB,cAAK,CAAkB,UAAC,KAAK,EAAE,KAAK;QAClD,OAAAoC,WAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,CAC1BC,MAAM,CACJ,WAAW,CAAC,UAAiD,EAC7DrE,OAAO,CAAC,UAAU,EAAE,QAAM,KAAK,CAAC,KAAO,CAAC,CACzC,CACF;IALD,CAKC,CACF,CAAC;AAEF,IAAO,IAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC;QACzC,IAAI,MAAA;QACJ,IAAI,MAAA;QACJ,SAAS,aAAA;QACT,OAAO,SAAA;KACR,CAAC,CAAC;;ICrCH,IAAMsE,MAAI,GAAG,gBAAgB,CAAC;IAC9B,IAAMC,MAAI,GAAO,YAAY,CAAC,IAAI,SAAE,MAAM,EAAC,CAAC;IAE5C,IAAMH,WAAS,GAAGpC,cAAK,CAAS,UAAC,KAAK,EAAE,EAAe;YAAb,gBAAK,EAAE,cAAI;QACnD,IAAM,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAC7C,IAAM,QAAQ,GAAG,KAAK,KAAK,KAAK,GAAG,UAAU,GAAG,YAAY,CAAC,CAAC,CAAC,IAAI,UAAU,CAAC;QAC9E,IAAM,MAAM,GAAG9B,QAAQ,CAAC,UAAC,GAAG,EAAE,KAAK,IAAK,OAAI,GAAG,SAAE,UAAQ,KAAO,KAAC,EAAE,EAAc,EAAE,YAAY,CAAC,CAAC;QACjG,OAAO,WAAW,CAAC,SAAS,CAC1B,KAAK,EACL,MAAM,CAAC,OAAO,EACd,cAAc,EACd;YACE,UAAU;YACV,iBAAiB;YACjB,eAAa,QAAU;YACvB,UAAQ,IAAM;iBACXa,KAAK,CAAC,UAAA,KAAK,IAAI,OAAA,WAAS,KAAO,GAAA,EAAE,MAAM,CAAC,EACxCA,KAAK,CAAC,UAAA,GAAG,IAAI,OAAA,SAAO,GAAG,YAAO,KAAK,SAAI,GAAK,GAAA,EAAEwD,MAAI,CAAC,EACtD,IAAI,CAAC,IAAI,CAAC,CACb,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAMC,SAAO,GAAGxC,cAAK,CAAkB,UAAC,KAAK,EAAE,KAAK;QAClD,OAAAoC,WAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM,IAAI,OAAA,WAAW,CAAC,UAAU,CAAC,MAAM,CAAC,GAAA,CAAC;IAAtE,CAAsE,CACvE,CAAC;AAEF,IAAO,IAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC;QACxC,IAAI,QAAA;QACJ,SAAS,aAAA;QACT,OAAO,WAAA;KACR,CAAC,CAAC;;IC/BH,IAAME,MAAI,GAAG,oBAAoB,CAAC;IAClC,IAAMC,MAAI,GAAG,YAAY,CAAC,IAAI,CAAC;IAE/B,IAAMH,WAAS,GAAGpC,cAAK,CAAS,UAAC,KAAK,EAAE,EAAe;YAAb,gBAAK,EAAE,cAAI;QACnD,IAAM,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAC7C,IAAM,QAAQ,GAAG,KAAK,KAAK,KAAK,GAAG,UAAU,GAAG,YAAY,CAAC,CAAC,CAAC,IAAI,UAAU,CAAC;QAC9E,IAAM,MAAM,GAAG,YAAY,CAAC,MAAM,CAChC,UAAC,GAAG,EAAE,KAAK,IAAK,OAAI,GAAG,SAAE,KAAK,EAAE,UAAQ,KAAO,EAAE,cAAY,KAAO,KAAC,EACrE,EAAc,CACf,CAAC;QAEF,OAAO,WAAW,CAAC,SAAS,CAC1B,KAAK,EACL,MAAM,CAAC,OAAO,EACd,kBAAkB,EAClB;YACE,UAAU;YACV,iBAAiB;YACjB,eAAa,QAAU;YACvB,UAAQ,IAAM;iBACXjB,KAAK,CAAC,UAAA,KAAK,IAAI,OAAA,WAAS,KAAO,GAAA,EAAE,MAAM,CAAC,EACxCA,KAAK,CAAC,UAAA,GAAG,IAAI,OAAA,SAAO,GAAG,YAAO,KAAK,SAAI,GAAK,GAAA,EAAEwD,MAAI,CAAC,EACtD,IAAI,CAAC,IAAI,CAAC,CACb,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAMC,SAAO,GAAGxC,cAAK,CAAC,UAAC,KAAK,EAAE,KAAK,IAAK,OAAAoC,WAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,GAAA,CAAC,CAAC;AAE9F,IAAO,IAAM,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC;QAC5C,IAAI,QAAA;QACJ,IAAI,QAAA;QACJ,SAAS,aAAA;QACT,OAAO,WAAA;KACR,CAAC,CAAC;;ICnCH,IAAME,MAAI,GAAG,iCAAiC,CAAC;IAE/C,IAAMF,WAAS,GAAGpC,cAAK,CAAS,UAAC,KAAK,EAAE,EAAkB;YAAhB,sBAAQ,EAAE,cAAI;QACtD,OAAA,WAAW,CAAC,SAAS,CACnB,KAAK,EACL,MAAM,CAAC,OAAO,EACd,mBAAmB,EACnB,CAAC,aAAW,QAAU,EAAE,UAAQ,IAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CACnD;IALD,CAKC,CACF,CAAC;IAEF,IAAMwC,SAAO,GAAGxC,cAAK,CAAC,UAAC,KAAK,EAAE,KAAK,IAAK,OAAAoC,WAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,GAAA,CAAC,CAAC;AAE9F,IAAO,IAAM,gBAAgB,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,IAAI,QAAA,EAAE,SAAS,aAAA,EAAE,OAAO,WAAA,EAAE,CAAC,CAAC;;ICZ7E,IAAME,MAAI,GAAG,uBAAuB,CAAC;IACrC,IAAMC,MAAI,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,eAAe,EAAE,KAAK,CAAC,CAAC;IAEjE,IAAMH,WAAS,GAAGpC,cAAK,CAAS,UAAC,KAAK,EAAE,EAAgB;YAAd,kBAAM,EAAE,cAAI;QACpD,IAAM,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QAEzC,OAAO,WAAW,CAAC,SAAS,CAC1B,KAAK,EACL,MAAM,CAAC,OAAO,EACd,gBAAgB,EAChB;YACE,UAAQ,OAAO,CAAC,CAAC,CAAG;YACpB,oBAAoB;YACpB,UAAQ,IAAM;YACd,iBAAiB;iBACdjB,KAAK,CAAC,UAAA,MAAM,IAAI,OAAA,YAAU,MAAQ,GAAA,EAAE,OAAO,CAAC,EAC5CA,KAAK,CAAC,UAAA,GAAG,IAAI,OAAA,SAAO,GAAG,iBAAY,MAAM,SAAI,GAAK,GAAA,EAAEwD,MAAI,CAAC,EAC5D,IAAI,CAAC,IAAI,CAAC,CACb,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAMC,SAAO,GAAGxC,cAAK,CAAC,UAAC,KAAK,EAAE,KAAK,IAAK,OAAAoC,WAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,GAAA,CAAC,CAAC;AAE9F,IAAO,IAAM,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC;QAC1C,IAAI,QAAA;QACJ,IAAI,QAAA;QACJ,SAAS,aAAA;QACT,OAAO,WAAA;KACR,CAAC,CAAC;;IC7BH,IAAME,MAAI,GAAG,iCAAiC,CAAC;IAE/C,IAAMF,WAAS,GAAGpC,cAAK,CAAS,UAAC,KAAK,EAAE,EAAiB;YAAf,oBAAO,EAAE,cAAI;QACrD,OAAA,WAAW,CAAC,SAAS,CACnB,KAAK,EACL,MAAM,CAAC,OAAO,EACd,kBAAkB,EAClB,CAAC,QAAM,OAAS,EAAE,UAAQ,IAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAC7C;IALD,CAKC,CACF,CAAC;IAEF,IAAMwC,SAAO,GAAGxC,cAAK,CAAC,UAAC,KAAK,EAAE,KAAK,IAAK,OAAAoC,WAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,GAAA,CAAC,CAAC;AAE9F,IAAO,IAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC;QAC3C,IAAI,QAAA;QACJ,SAAS,aAAA;QACT,OAAO,WAAA;KACR,CAAC,CAAC;;ICfH,IAAMG,MAAI,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,eAAe,EAAE,KAAK,CAAC,CAAC;IACjE,IAAM,cAAc,GAAG,UAAC,IAAY,IAAK,OAAA,WAAS,IAAM,GAAA,CAAC;IACzD,IAAM,eAAe,GAAG,UAAC,IAAY,IAAK,OAAA,WAAS,IAAI,aAAU,GAAA,CAAC;IAElE,IAAM,kBAAkB,GAAGzD,OAAO,CAChC,UAAC,OAAO,EAAE,IAAI,EAAE,MAAM;QACpB,IAAI,MAAM,GAAG,CAAC,MAAM,IAAI,EAAE,CAAC,CAAC;QAC5B,IAAM,SAAS,GAAG,SAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAE7C,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;YAC9ByD,MAAI,CAAC,GAAG,CAAC,UAAA,GAAG,IAAI,OAAA,MAAM,CAAC,IAAI,CAAC,SAAO,GAAG,eAAU,OAAO,gBAAW,IAAI,SAAI,GAAK,CAAC,GAAA,CAAC,CAAC;SACnF;QAED,IAAI,OAAO,GAAG,SAAS,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;QAE5C,IAAI,CAAC,OAAO,EAAE;YACZ,MAAM,CAAC,IAAI,CAAC,aAAW,MAAM,CAAC,OAAS,CAAC,CAAC;YACzC,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC;SAC1B;QAED,IAAI,SAAS,GAAG,SAAS,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QAEhD,IAAI,CAAC,SAAS;YAAE,MAAM,CAAC,IAAI,CAAC,eAAa,OAAS,CAAC,CAAC;QAEpD,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC3B,CAAC,CACF,CAAC;IAEF,IAAMH,WAAS,GAAGpC,cAAK,CAAS,UAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,KAAK;QAC3D,OAAA,WAAW,CAAC,SAAS,CAAC,KAAK,EAAE,QAAQ,EAAE,cAAc,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC,IAAI,CACtE,kBAAkB,CAAC,QAAQ,EAAE,IAAI,CAAC,CACnC;IAFD,CAEC,CACF,CAAC;IAEF,IAAMwC,SAAO,GAAGxC,cAAK,CAAC,UAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,KAAK;QACjD,OAAAoC,WAAS,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM;YACjD,OAAA,WAAW,CAAC,UAAU,CAAC,MAAM,EAAE,QAAQ,EAAE,IAAI,CAAC;SAAA,CAC/C;IAFD,CAEC,CACF,CAAC;IAEF,IAAM,gBAAgB,GAAGnE,SAAS,CAChCkC,QAAQ,CAACR,UAAU,CAAC,EACpBZ,KAAK,CAAiBE,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC,EAC/CE,QAAQ,CAAClB,SAAS,CAChBO,QAAQ,CAAC,KAAK,EAAE,QAAQ,CAAC,EACzBiE,OAAO,CAAC,eAAe,CAAC,CACG,CAAkC,EAC/D3E,QAAQ,CACT,CAAC;IAEF,IAAM,cAAc,GAAGkC,cAAK,CAAW,UAAC,KAAK,EAAE,QAAQ;QACrD,OAAA,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC;IAAvD,CAAuD,CACxD,CAAC;AAEF,QAAa,SAAS,GAAG;QACvB,cAAc,gBAAA;QACd,eAAe,iBAAA;QACf,gBAAgB,kBAAA;QAChB,cAAc,gBAAA;QACd,IAAI,QAAA;QACJ,SAAS,aAAA;QACT,OAAO,WAAA;KACR;;ICjED,IAAMsC,MAAI,GAAG,oCAAoC,CAAC;IAElD,IAAMF,WAAS,GAAGpC,cAAK,CAAS,UAAC,KAAK,EAAE,EAAwB;YAAtB,sBAAQ,EAAE,cAAI,EAAE,cAAI;QAC5D,OAAA,SAAS,CAAC,SAAS,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,UAAQ,IAAM,CAAC;IAA1D,CAA0D,CAC3D,CAAC;IAEF,IAAMwC,SAAO,GAAGxC,cAAK,CAAC,UAAC,KAAK,EAAE,EAAwB;YAAtB,sBAAQ,EAAE,cAAI,EAAE,cAAI;QAClD,OAAA,SAAS,CAAC,OAAO,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,UAAQ,IAAM,CAAC;IAAxD,CAAwD,CACzD,CAAC;AAEF,IAAO,IAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC;QACzC,IAAI,QAAA;QACJ,SAAS,aAAA;QACT,OAAO,WAAA;KACR,CAAC,CAAC;;ICbH,IAAMsC,MAAI,GAAG,qCAAqC,CAAC;IAEnD,IAAMF,WAAS,GAAGpC,cAAK,CAAS,UAAC,KAAK,EAAE,EAAgC;YAA9B,sBAAQ,EAAE,cAAI,EAAE,YAAY,EAAZ,iCAAY;QACpE,OAAA,WAAW,CAAC,SAAS,CACnB,KAAK,EACL,MAAM,CAAC,OAAO,EACd,eAAe,EACf,CAAC,uBAAqB,QAAU,EAAE,cAAc,EAAE,UAAQ,IAAM,EAAE,UAAQ,IAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAC7F;IALD,CAKC,CACF,CAAC;IAEF,IAAMwC,SAAO,GAAGxC,cAAK,CAAC,UAAC,KAAK,EAAE,KAAK,IAAK,OAAAoC,WAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,GAAA,CAAC,CAAC;AAE9F,IAAO,IAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC;QACzC,IAAI,QAAA;QACJ,SAAS,aAAA;QACT,OAAO,WAAA;KACR,CAAC,CAAC;;ICdH,IAAME,MAAI,GAAG,6BAA6B,CAAC;IAC3C,IAAMC,MAAI,GAAG,CAAC,UAAU,EAAE,UAAU,EAAE,WAAW,EAAE,UAAU,CAAC,CAAC;IAE/D,IAAMH,WAAS,GAAGpC,cAAK,CAAS,UAAC,KAAK,EAAE,EAAwB;YAAtB,sBAAQ,EAAE,cAAI,EAAE,cAAI;QAC5D,OAAA,WAAW,CAAC,SAAS,CACnB,KAAK,EACL,MAAM,CAAC,OAAO,EACd,iBAAiB,EACjB;YACE,YAAU,QAAU;YACpB,UAAQ,IAAM;YACd,UAAQ,IAAM;iBACXjB,KAAK,CAAC,UAAA,GAAG,IAAI,OAAA,SAAO,GAAG,eAAU,QAAQ,SAAI,GAAK,GAAA,EAAEwD,MAAI,CAAC,EAC5D,IAAI,CAAC,IAAI,CAAC,CACb;IAVD,CAUC,CACF,CAAC;IAEF,IAAMC,SAAO,GAAGxC,cAAK,CAAC,UAAC,KAAK,EAAE,KAAK;QACjC,OAAA,KAAK,CAAC,QAAQ,CAAC,KAAK,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,UAAA,IAAI;YAC7C,OAAAoC,WAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,CAAEC,MAAM,CAClC,WAAW,CAAC,UAAU,EACtBjB,WAAW,CAAC;gBACV,SAAS,EAAE,KAAK,CAAC,QAAQ;gBACzB,WAAW,EAAE5C,QAAQ,CAAC,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC;aACzC,CAAC,CACgD,CAAC;SAAA,CACtD;IARD,CAQC,CACF,CAAC;AAEF,IAAO,IAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC;QAC3C,IAAI,QAAA;QACJ,IAAI,QAAA;QACJ,SAAS,aAAA;QACT,OAAO,WAAA;KACR,CAAC,CAAC;;IC5BH,IAAM,KAAK,GAAG;QACZ,WAAW,aAAA;QACX,eAAe,iBAAA;QACf,YAAY,cAAA;QACZ,aAAa,eAAA;QACb,cAAc,gBAAA;QACd,YAAY,cAAA;QACZ,YAAY,cAAA;QACZ,gBAAgB,kBAAA;QAChB,cAAc,gBAAA;KACf,CAAC;IAEF,IAAM,UAAU,GAAG4B,QAAQ,CAAC,KAAK,CAAC,CAAC;IAEnC,IAAM,QAAQ,GAAG,UAAC,IAAY;QAC5B,IAAI,KAAK,CAAC;QAEV,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC1C,KAAK,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YACxC,IAAI,KAAK;gBAAE,OAAOpC,OAAO,CAAC,OAAO,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;SAC1D;QACD,OAAO,IAAI,CAAC;IACd,CAAC,CAAC;IAEF,IAAM,eAAe,GAAGgC,cAAK,CAA2B,UAAC,KAAK,EAAE,IAAI;QAClE,OAAA,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,UAAA,IAAI;YAC3B,IAAA,eAAuD,EAArD,sBAAmB,EAAnB,wCAAmB,EAAE,oBAAiB,EAAjB,sCAAgC,CAAC;YAC9D,IAAI,CAAC,cAAc,IAAI,CAAC,YAAY;gBAAE,OAAO,IAAI,CAAC;YAClD,OAAO,KAAK,CAAC,QAAQ,CAAC,KAAK,EAAE,cAAc,EAAK,YAAY,aAAU,CAAC,CAAC;SACzE,CAAC;IAJF,CAIE,CACH,CAAC;IAEF,IAAM,YAAY,GAAGA,cAAK,CAAkB,UAAC,KAAK,EAAE,IAAI;QACtD,IAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC;QAE5B,IAAI,CAAC,IAAI;YAAE,MAAM,IAAI,KAAK,CAAC,+BAA6B,IAAM,CAAC,CAAC;QAEhE,OAAO,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,UAAC,QAAyB;YACpE,IAAI,IAAI,GAAG,QAAQ,CAAC;YAEpB,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,KAAK,SAAS,EAAE;gBACjC,IAAI,GAAGhC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAACA,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;aAC1F;iBAAM;gBACL,IAAI,GAAGA,OAAO,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;aACxC;YAED,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;gBACxC,IAAI,GAAGA,OAAO,CAAC,YAAY,EAAE,QAAM,IAAI,CAAC,WAAW,YAAS,EAAE,IAAI,CAAC,CAAC;aACrE;YAED,OAAO,IAAI,CAAC;SACb,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AAEH,IAAO,IAAM,WAAW,gBACnB,KAAK,IACR,KAAK,OAAA;QACL,QAAQ,UAAA;QACR,eAAe,iBAAA;QACf,YAAY,cAAA,GACb,CAAC;;IClEF;QAUE,sBAAY,IAAY,EAAE,MAAqB;YAC7C,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;YACnB,IAAI,CAAC,SAAS,GAAG,MAAM,GAAG,MAAM,CAAC,SAAS,GAAG,EAAE,CAAC;YAChD,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;YAClB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,IAAI,CAAC,IAAI,GAAG,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YACvC,IAAI,CAAC,IAAI,GAAG,WAAW,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;YACvC,IAAI,CAAC,YAAY,GAAG,MAAM,GAAG,MAAM,CAAC,YAAY,GAAG,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;YAC7E,IAAI,CAAC,iBAAiB,GAAG,MAAM;kBAC3B,MAAM,CAAC,iBAAiB;kBACxB,OAAO,CACLqE,MAAM,CACJnE,QAAQ,CACN6B,QAA0E,EAC1E,EAAsB,CACvB,EACD,WAAW,CAAC,QAAQ,EACpBD,QAAQ,CAACJ,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CACpC,CACF,CAAC;SACP;QAED,qCAAc,GAAd,UAAe,KAAe;YAA9B,iBA4BC;YA3BC,IAAI,CAAC,IAAI,CAAC,IAAI;gBAAE,OAAO,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;YAC3C,OAAO,IAAI,CAAC,IAAI;iBACb,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC;iBAC/B,IAAI,CAAC,UAAC,IAAqB;gBAC1B,KAAI,CAAC,IAAI,GAAG,IAAI,CAAC;gBACjB,IAAM,KAAK,GAAG3B,QAAQ,CAAC,EAAE,EAAE,CAAC,YAAY,EAAE,cAAc,CAAC,EAAE,IAAI,CAAC,CAAC;gBACjE,IAAM,YAAY,GAAGM,SAAS,CAAC,CAAC,KAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;gBACnD,KAAI,CAAC,QAAQ,GAAG,YAAY,CAAC,GAAG,CAC9B,UAAA,IAAI,IAAI,OAAA,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,IAAI,YAAY,CAAC,IAAI,EAAE,KAAI,CAAC,CAAC,GAAA,CACtF,CAAC;gBACF,IAAI,CAAC,KAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;oBACzB,OAAO,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CACtEgE,MAAM,CACJ,KAAI,CAAC,YAAY,EACjBK,IAAI,EACJ,KAAI,CAAC,iBAAiB,CACvB,CACF,CAAC;iBACH;gBACD,OAAO,OAAO,CAAC,GAAG,CAAmB,KAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,cAAc,CAAC,KAAK,CAAC,GAAA,CAAC,CAAC,CAAC,IAAI,CACxF,KAAI,CAAC,iBAAiB,CACvB,CAAC;aACH,CAAC;iBACD,IAAI,CAAC,UAAC,IAAsB;gBAC3B,KAAI,CAAC,OAAO,GAAG7C,SAAS,CAACH,KAAK,CAAC,WAAW,CAAC,MAAM,CAAyB,EAAE,IAAI,CAAC,CAAC;gBAClF,OAAO,IAAI,CAAC;aACb,CAAC,CAAC;SACN;QAEK,8BAAO,GAAb,UAAc,KAAe,EAAE,EAAU;;;;;;4BACvC,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gCAAE,sBAAO,IAAI,EAAC;4BAC1C,IAAI,EAAE,EAAE,IAAI,IAAI,CAAC,OAAO,CAAC;gCAAE,sBAAO,KAAK,EAAC;4BAClC,QAAQ,GAAG,aAAa,CAAC,WAAW,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;4BACvD,qBAAM,QAAQ,CAAC,EAAE,CAAC,EAAA;;4BAAxB,IAAI,EAAE,SAAkB,CAAC;gCAAE,sBAAO,KAAK,EAAC;4BAElC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;4BACvC,IAAI,CAAC,QAAQ,CAAC,MAAM;gCAAE,sBAAO,IAAI,EAAC;4BACzB,CAAC,GAAG,CAAC;;;kCAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,CAAA;4BAC7B,qBAAM,QAAQ,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,EAAA;;4BAAxC,IAAI,SAAoC;gCAAE,sBAAO,IAAI,EAAC;;;4BADnB,CAAC,EAAE,CAAA;;gCAIxC,sBAAO,KAAK,EAAC;;;;SACd;QAED,0BAAG,GAAH,UAAI,KAAe,EAAE,IAAS;YAA9B,iBAUC;YAVoB,qBAAA,EAAA,SAAS;YAC5B,OAAO,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,UAAA,IAAI;gBACzC,IAAM,UAAU,GAAqBX,KAAK,CAAC,UAAA,EAAE,IAAI,OAAA,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,QAAQ,CAAC,GAAA,EAAE,KAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBAC3F,IAAM,QAAQ,GAAG,UAAC,EAAU,IAAK,OAAA,KAAI,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,GAAA,CAAC;gBAEzD,OAAO,aAAa,CAAC,cAAc,CAAC,KAAK,EAAE,KAAI,CAAC,IAAI,EAAM,UAAU,QAAK,IAAI,gBACxE,IAAI,IACP,QAAQ,UAAA,IACR,CAAC;aACJ,CAAC,CAAC;SACJ;QACH,mBAAC;IAAD,CAAC,IAAA;;QChFY,OAAO,gBACf,WAAW,CAAC,KAAK,IACpB,WAAW,aAAA;QACX,WAAW,aAAA;QACX,YAAY,cAAA,EACZ,WAAW,EAAE,WAAW,CAAC,WAAW,EACpC,UAAU,EAAE,WAAW,CAAC,UAAU,EAClC,GAAG,EAAE,WAAW,CAAC,GAAG,EACpB,YAAY,EAAE,WAAW,CAAC,QAAQ,EAClC,eAAe,EAAE,WAAW,CAAC,eAAe,EAC5C,YAAY,EAAE,WAAW,CAAC,YAAY,GACvC;;ICxBD;QAQE,oBAAY,IAAS,EAAE,MAAW,EAAE,SAAc;YAA3B,uBAAA,EAAA,WAAW;YAAE,0BAAA,EAAA,cAAc;YAChD,IAAI,CAAC,IAAI,GAAG,WAAW,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;YAC3C,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;YACjB,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;YACrB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;YACvB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;SAC5B;QAED,2BAAM,GAAN;YACE,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,IAAI,IAAI,CAAC,YAAY,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;SAClF;QAED,6BAAQ,GAAR,UAAS,EAAU;YACjB,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC;SAC7E;QAED,4BAAO,GAAP,UAAQ,EAAU,EAAE,KAAa;YAAb,sBAAA,EAAA,aAAa;YAC/B,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;gBAAE,OAAO;YAC9B,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;;YAEzD,IAAI,CAAC,WAAW,EAAE,CAAC;SACpB;QAED,4BAAO,GAAP;YACE,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,IAAI,EAAE,CAAC;SACzD;;QAGK,gCAAW,GAAjB;;;;SAAsB;;QAGtB,0BAAK,GAAL,UAAM,GAAQ,KAAI;QACpB,iBAAC;IAAD,CAAC,IAAA;;ICnCD,SAAe,WAAW,CAAC,KAAe,EAAE,OAAe;;;;;;wBACzD,IAAI,CAAC,OAAO;4BAAE,sBAAO,EAAE,EAAC;wBAClB,QAAQ,GAAa,EAAE,CAAC;wBAC0C,qBAAM,OAAO,CAAC,GAAG,CAAC;gCACxF,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE,OAAO,CAAC;gCAC/B,KAAK,CAAC,WAAW,CAAC,KAAK,EAAE,OAAO,CAAC;6BAClC,CAAC,EAAA;;wBAHI,KAAkE,SAGtE,EAHK,IAAI,QAAA,EAAE,MAAM,QAAA;wBAInB,IAAI,CAAC,IAAI;4BAAE,sBAAO,EAAE,EAAC;wBACf,IAAI,GAAG,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBAChC,QAAQ,GAAG,aAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;wBACxC,KAAK,GAAG,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC;6BACpC,IAAI,EAAE;6BACN,WAAW,EAAE,CAAC;8BAEb,IAAI,KAAK,YAAY,CAAA,EAArB,wBAAqB;wBACjB,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;wBACpC,QAAQ,GAAGd,SAAS,CACxBI,SAAS,CAAC,CAAC,MAAM,CAAC,CAAC,EACnBP,QAAQ,EACR,UAAA,CAAC,IAAI,QAAC,OAAO,CAAC,KAAK,QAAQ,GAAG,EAAE,GAAG,CAAC,IAAC,EACrCU,QAAQ,CAAC,EAAE,EAAE,UAAU,CAAC,CACzB,CAAC,MAAM,CAAC,CAAC;wBAEV,IAAI,KAAK;4BAAE,QAAQ,CAAC,IAAI,CAAC,QAAM,KAAO,CAAC,CAAC;wBACxC,IAAI,KAAK,KAAK,KAAK;4BAAE,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;wBAC7C,IAAI,MAAM;4BAAE,QAAQ,CAAC,IAAI,CAAC,aAAW,MAAQ,CAAC,CAAC;wBAC/C,IAAI,QAAQ,EAAE;4BACZ,QAAQ,CAAC,IAAI,CAAC,WAAS,QAAQ,eAAY,CAAC,CAAC;4BAC7C,QAAQ,CAAC,IAAI,CAAC,WAAS,QAAQ,cAAW,CAAC,CAAC;yBAC7C;wBAED,QAAQ,CAAC,OAAO,CAAC,UAAA,WAAW,IAAI,OAAA,QAAQ,CAAC,IAAI,CAAC,WAAS,WAAW,eAAY,CAAC,GAAA,CAAC,CAAC;;;8BACxE,IAAI,KAAK,SAAS,CAAA,EAAlB,wBAAkB;wBACrB,IAAI,GAAG,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBAChC,SAAS,GAAG,aAAa,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;wBAC1C,SAAS,GAAG,aAAa,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;wBAEhD,IAAI,IAAI;4BAAE,QAAQ,CAAC,IAAI,CAAC,aAAW,IAAI,cAAW,CAAC,CAAC;wBACpD,IAAI,KAAK;4BAAE,QAAQ,CAAC,IAAI,CAAC,iBAAe,KAAO,CAAC,CAAC;wBACjD,IAAI,KAAK,KAAK,KAAK;4BAAE,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;6BAElD,SAAS,EAAT,wBAAS;wBACc,qBAAM,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE,SAAS,CAAC,EAAA;;wBAA1D,gBAAgB,GAAG,SAAuC;wBAC1D,eAAe,GAAG,aAAa,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;wBAEjE,IAAI,eAAe,EAAE;4BACb,WAAW,GAAG,aAAa,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;4BACzD,QAAQ,CAAC,IAAI,CAAC,WAAS,eAAe,sBAAmB,CAAC,CAAC;4BAC3D,IAAI,WAAW,KAAK,YAAY,EAAE;gCAChC,QAAQ,CAAC,IAAI,CAAC,WAAS,eAAe,uBAAoB,CAAC,CAAC;6BAC7D;iCAAM,IAAI,WAAW,KAAK,SAAS,EAAE;gCACpC,QAAQ,CAAC,IAAI,CAAC,WAAS,eAAe,sBAAmB,CAAC,CAAC;6BAC5D;yBACF;;;wBAGH,IAAI,QAAQ,EAAE;4BACZ,QAAQ,CAAC,IAAI,CAAC,WAAS,QAAQ,cAAW,CAAC,CAAC;4BAC5C,QAAQ,CAAC,IAAI,CAAC,WAAS,QAAQ,cAAW,CAAC,CAAC;4BAC5C,IAAI,SAAS;gCAAE,QAAQ,CAAC,IAAI,CAAC,WAAS,QAAQ,cAAW,CAAC,CAAC;;yBAE5D;;;wBACI,IAAI,IAAI,KAAK,SAAS,EAAE;4BAC7B,IAAI,KAAK;gCAAE,QAAQ,CAAC,IAAI,CAAC,aAAW,KAAO,CAAC,CAAC;4BAC7C,IAAI,KAAK,KAAK,KAAK;gCAAE,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;yBACnD;;4BAED,sBAAO,QAAQ,EAAC;;;;KACjB;IAED,SAAe,eAAe,CAAC,KAAe,EAAE,OAAe;;;;;;;wBAC7D,IAAI,CAAC,OAAO;4BAAE,sBAAO;wBACf,IAAI,GAAG,WAAW,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;wBACb,qBAAM,WAAW,CAAC,KAAK,EAAE,OAAO,CAAC,EAAA;;wBAAtD,QAAQ,GAAa,SAAiC;wBAC5D,IAAI,CAAC,QAAQ,CAAC,MAAM;4BAAE,sBAAO;;4BAG3B,EAAE,EAAE,OAAO;4BACX,QAAQ,UAAA;;wBACD,qBAAM,OAAO,CAAC,GAAG,CACtBJ,SAAS,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,UAAO,EAAc;oCAAb,YAAI,EAAE,cAAM;;;;;;sDACnD,IAAI;gDACJ,qBAAM,MAAM,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,CAAC,EAAA;oDAFuB;oDAEzD,SAAkC;oDACnC;;;;6BAAA,CAAC,CACH,EAAA;4BARH,uBAGE,QAAK,GAAE,SAKN;iCACD;;;;KACH;IAED,IAAM,uBAAuB,GAAG,UAAC,iBAAsB;QACrD,IAAM,EAAE,GAAGI,QAAQ,CAAC,EAAE,EAAE,IAAI,EAAE,iBAAiB,CAAC,CAAC;QACjD,IAAM,QAAQ,GAAaA,QAAQ,CAAC,EAAE,EAAE,UAAU,EAAE,iBAAiB,CAAC,CAAC;QACvE,IAAM,KAAK,GAAuBA,QAAQ,CAAC,EAAE,EAAE,OAAO,EAAE,iBAAiB,CAAC,CAAC;QAC3E,IAAM,OAAO,GAAG,EAAE,CAAC;QAEnB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACxC,IAAM,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;YAE5B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC/B,IAAA,aAA4B,EAA3B,gBAAQ,EAAE,aAAiB,CAAC;gBAEnC,OAAO,CAAC,IAAI,CAAC,CAAI,OAAO,SAAI,QAAU,EAAE,CAAC,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;aACzD;SACF;QAED,OAAO,OAAO,CAAC;IACjB,CAAC,CAAC;IAEF;QAA2BmE,gCAAU;QAArC;;SA+DC;QA9DO,kCAAW,GAAjB;;;;;;;4BACE,IAAI,IAAI,CAAC,YAAY;gCAAE,sBAAO;4BACxB,EAAE,IAAI,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;4BAChD,IAAI,CAAC,EAAE;gCAAE,sBAAO;4BAEV,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;;;;4BAG/B,UAAQ,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;4BAC7B,qBAAM,eAAe,CAAC,OAAK,EAAE,EAAE,CAAC,EAAA;;4BAA9C,WAAW,GAAG,SAAgC;4BAC9C,UAAU,GAAU,uBAAuB,CAAC,WAAW,CAAC,CAAC;;4BAG/D,qBAAM,OAAO,CAAC,GAAG,CACf,UAAU,CAAC,GAAG,CAAC,UAAM,IAAI;;;;;gDAChB,WAAW,GAAgD,IAAI,GAApD,EAAE,YAAY,GAAkC,IAAI,GAAtC,CAAuC;gDACjE,IAAI,GAAG,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;gDAClD,qBAAM,OAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,EAAA;;gDAAvC,QAAQ,GAAG,SAA4B;gDAChC,qBAAM,WAAW,CAAC,IAAI,CAAC,QAAQ,EAAE,YAAY,EAAE,EAAE,CAAC,EAAA;;gDAAzD,IAAI,GAAG,SAAkD;gDAC/D,IAAI,CAAC,IAAI;oDAAE,sBAAO;gDAClB,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;gDACnC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;;;;qCACnC,CAAC,CACH,EAAA;;;4BAVD,SAUC,CAAC;;;;4BAEF,OAAO,CAAC,KAAK,CAAC,eAAe,EAAE,GAAC,CAAC,KAAK,IAAI,GAAC,CAAC,CAAC;;;4BAGzC,OAAO,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;4BACrC,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC,OAAO,GAAG,SAAS,IAAI,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC;4BACxE,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;;4BAEvB,IAAI,CAAC,WAAW,EAAE,CAAC;;;;;SACpB;QAED,4BAAK,GAAL,UAAM,GAAQ;YAAd,iBA0BC;YAzBC1E,SAAS,CACPc,KAAK,CAAC6D,KAAK,CAAC,UAAC,EAA8B;oBAA7B,UAAE,EAAE,aAAK;gBAAyB,OAAA,EAAE,IAAI,KAAI,CAAC,OAAO,CAAC,EAAE,EAAE,KAAK,CAAC;aAAA,CAAC,CAAC,EAC/E9C,QAAQ,CAACJ,KAAK,CAAC,CAAC,CAAoB,CAAC,EACrCX,KAAK,CAAC,UAAC,IAAY;gBACjB,IAAM,IAAI,GAAGhB,QAAQ,CAAC,EAAE,EAAE,CAAC,KAAK,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC;gBACxD,IAAM,MAAM,GAAGqC,QAAQ,CAAC,IAAI,CAAC;qBAC1B,IAAI,EAAE;qBACN,GAAG,EAAE,CAAC;gBACT,IAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;gBACjC,IAAM,GAAG,GAAG,GAAG,GAAG,MAAM,CAAC;gBACzB,IAAI,GAAG,GAAG,MAAM,CAAC,kBAAkB;oBAAE,OAAO,EAAE,CAAC;gBAC/C,IAAM,UAAU,GAAG,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBAClD,IAAM,cAAc,GAAG,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBAChE,IAAM,WAAW,GAAG,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBAC7D,IAAM,OAAO,GAAW5B,QAAQ,CAC9B,EAAE,EACF,SAAS,EACT,UAAU,IAAI,cAAc,IAAI,WAAW,CAC5C,CAAC;gBAEF,OAAO,CAAC,OAAO,EAAE,CAAC,WAAW,CAAC,CAAC;aAChC,CAAC,EACFV,QAAQ,EACRU,QAAQ,CAAC,EAAE,EAAE,KAAK,CAAC,CACpB,CAAC,GAAG,CAAC,CAAC;SACR;QACH,mBAAC;IAAD,CA/DA,CAA2B,UAAU,GA+DpC;AAED,QAAa,OAAO,GAAG;QACrB,KAAK,EAAE,YAAY;QACnB,eAAe,iBAAA;KAChB;;ICpLD,IAAMqE,UAAQ,GAAG5E,SAAS,CACxBc,KAAK,CAACiC,MAAM,CAAC,EACb9B,OAAO,CAAC,GAAG,CAAC,EACZD,SAAS,CAAC,SAAS,CAAC,UAAU,EAAE,EAAE,CAAC,EACnCiD,WAAW,CAAC,EAAE,CAAC,EACfxC,KAAK,CAAC,CAAC,CAA+B,EACtCR,OAAO,CAAC,IAAI,CAAC,CACd,CAAC;IAEF,IAAM,GAAG,GAAG,UAAC,SAAuB;QAClC,OAAAhB,QAAQ,CACN,UAAC,MAAM,EAAE,EAAE;YACT,IAAM,IAAI,GAAGH,QAAQ,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,MAAM,CAAC,EAAE,SAAS,CAAC,CAAC;YACnD,IAAM,QAAQ,GAAGA,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,UAAU,CAAC,EAAE,SAAS,CAAC,CAAC;YAC/D,IAAM,SAAS,GAAG,UAAU,CAACA,QAAQ,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,WAAW,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC;YAEzE,IAAI,CAAC2C,MAAM,CAAC,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC;gBAAE,OAAO,MAAM,CAAC;YACvD,IAAM,SAAS,IAAI,QAAQ,SAAKmC,UAAQ,CAAC,IAAI,CAAC,GAAE,EAAE,EAAC,CAAC;YAEpD,OAAO5B,WAAW,CAAC,SAAS,EAAE,SAAS,IAAI,CAAC,EAAE,MAAM,CAAC,CAAC;SACvD,EACD,EAAE,EACF3C,MAAM,CAAC,SAAS,CAAC,CAClB;IAbD,CAaC,CAAC;AAEJ,QAAa,cAAc,GAAG,EAAE,QAAQ,YAAA,EAAE,GAAG,KAAA,EAAE;;IC7B/C,wBAyFA;IA/EA,IAAM,QAAQ,GAAG0B,cAAK,CAAC,UAAO,KAAK,EAAE,OAAO;;;;;oBAC1C,IAAI,CAAC,OAAO;wBAAE,sBAAO,IAAI,EAAC;oBACc,qBAAMc,YAAG,CAAC;4BAChD,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE;4BACjE,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE;4BACnE,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE;4BACrE,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE;yBACnE,CAAC,EAAA;;oBALI,KAAkC,SAKtC,EALK,EAAE,QAAA,EAAE,IAAI,QAAA,EAAE,OAAO,QAAA,EAAE,UAAU,QAAA;oBAMlB,qBAAM,KAAK,CAAC,kBAAkB,CAAC,KAAK,EAAE,UAAU,CAAC,EAAA;;oBAA7D,SAAS,GAAG,SAAiD;oBAC7D,MAAM,GAAwB;wBAClC,EAAE,IAAA;wBACF,IAAI,MAAA;wBACJ,OAAO,SAAA;wBACP,OAAO,EAAE,UAAU,CAAC,MAAM;wBAC1B,KAAK,EAAE,EAAE,GAAG,IAAI;qBACjB,CAAC;oBAEF,IAAI,SAAS,EAAE;wBACP,UAAU,GAAG,cAAc,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;wBACjD,IAAIxC,MAAM,CAAC,UAAU,CAAC,CAAC,MAAM;4BAAE,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;qBAC7E;oBACD,sBAAO,MAAM,EAAC;;;SACf,CAAC,CAAC;IAEH;QAA6BqE,kCAAU;QAAvC;;SAoDC;QAnDO,oCAAW,GAAjB;;;;;;4BACE,IAAI,IAAI,CAAC,YAAY;gCAAE,sBAAO;4BACxB,OAAO,IAAI,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;4BAC/C,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;4BACtC,IAAI,CAAC,OAAO;gCAAE,sBAAO;4BACf,UAAU,GAAG,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,OAAO,SAAA,EAAE,SAAS,WAAA,EAAE,CAAC,CAAC;;;;4BAGxE,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;4BAC1B,qBAAM,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,IAAI,EAAE,EAAA;;4BAAnD,cAAc,GAAG,SAAkC;4BACnC,qBAAM,QAAQ,CAAC,KAAK,EAAE,OAAO,CAAC,EAAA;;4BAA9C,aAAa,GAAG,SAA8B;4BAC9C,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,cAAc,EAAE,aAAa,CAAC,CAAC;4BACzD,IAAI7E,QAAQ,CAAC,IAAI,CAAC,CAAC,MAAM;gCAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;;;;4BAEnE,OAAO,CAAC,KAAK,CAAC,iBAAiB,EAAE,GAAC,CAAC,KAAK,IAAI,GAAC,CAAC,CAAC;;;4BAGjD,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;;4BAEvB,IAAI,CAAC,WAAW,EAAE,CAAC;;;;;SACpB;QAED,8BAAK,GAAL,UAAM,GAAQ;YAAd,iBA4BC;YA3BCG,SAAS,CACPc,KAAK,CAAC6D,KAAK,CAAC,UAAC,EAA8B;oBAA7B,UAAE,EAAE,aAAK;gBAAyB,OAAA,EAAE,IAAI,KAAI,CAAC,OAAO,CAAC,EAAE,EAAE,KAAK,CAAC;aAAA,CAAC,CAAC,EAC/E9C,QAAQ,CAACJ,KAAK,CAAC,CAAC,CAAoB,CAAC,EACrCX,KAAK,CAAC,UAAC,IAAY;gBACjB,IAAM,IAAI,GAAGhB,QAAQ,CAAC,EAAE,EAAE,CAAC,KAAK,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC;gBACxD,IAAM,MAAM,GAAGqC,QAAQ,CAAC,IAAI,CAAC;qBAC1B,IAAI,EAAE;qBACN,GAAG,EAAE,CAAC;gBACT,IAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;gBACjC,IAAM,GAAG,GAAG,GAAG,GAAG,MAAM,CAAC;gBACzB,IAAI,GAAG,GAAG,MAAM,CAAC,kBAAkB;oBAAE,OAAO,EAAE,CAAC;gBAC/C,IAAM,UAAU,GAAG,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBAClD,IAAM,YAAY,GAAG,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBAC3D,IAAM,cAAc,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBAC/D,IAAM,gBAAgB,GAAG,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBACnE,IAAM,aAAa,GAAG,MAAM,CAAC,aAAa,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBAC7D,IAAM,OAAO,GAAW5B,QAAQ,CAC9B,EAAE,EACF,SAAS,EACT,UAAU,IAAI,YAAY,IAAI,cAAc,IAAI,gBAAgB,IAAI,aAAa,CAClF,CAAC;gBAEF,OAAO,CAAC,OAAO,EAAE,EAAE,YAAY,IAAI,cAAc,IAAI,gBAAgB,IAAI,aAAa,CAAC,CAAC,CAAC;aAC1F,CAAC,EACFV,QAAQ,EACRU,QAAQ,CAAC,EAAE,EAAE,KAAK,CAAC,CACpB,CAAC,GAAG,CAAC,CAAC;SACR;QACH,qBAAC;IAAD,CApDA,CAA6B,UAAU,GAoDtC;AAED,QAAa,SAAS,GAAG,EAAE,KAAK,EAAE,cAAc,EAAE,KAAK,EAAE,QAAQ,EAAE;;ICpFnE;QAIE,gBAAY,IAAS;YACnB,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;YACnB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAChD;QAED,oBAAG,GAAH,UAAI,OAAsB;YACxB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SAC7B;QAED,sBAAK,GAAL,UAAM,GAAQ;YACZ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE;gBAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;SAC5E;QACH,aAAC;IAAD,CAAC,IAAA;;ICbD,SAAS,IAAI,CAAC,GAAQ,EAAE,MAAgB;QAAhB,uBAAA,EAAA,WAAgB;QACtC,IAAM,iBAOU,EANd,aAAa,EAAb,kCAAa,EACb,yBAAyB,EAAzB,8CAAyB,EACzB,aAAa,EAAb,kCAAa,EACb,oBAAoB,EAApB,yCAAoB,EACpB,eAAe,EAAf,oCAAe,EACf,qFACc,CAAC;QACjB,IAAM,IAAI,GAAQ,EAAE,MAAM,QAAA,EAAE,CAAC;QAE7B,IAAI,CAAC,KAAK,EAAE;YACV,IAAM,GAAG,cAAK,YAAY,EAAE,CAAC,CAAC,YAAY,EAAE,MAAM,EAAE,CAAC,CAAC,OAAO,IAAK,IAAI,CAAE,CAAC;YAEzE,IAAI,OAAO;gBAAE,GAAG,CAAC,YAAY,GAAG,KAAK,CAAC;YACtC,IAAI,CAAC,iBAAiB;gBAAE,GAAG,CAAC,EAAE,CAAC,KAAK,EAAE,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC;YACrE,IAAI,GAAG,CAAC,OAAO;gBAAE,GAAG,CAAC,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YAC9C,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC;YACpB,IAAI,GAAG,CAAC,YAAY;gBAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,oBAAoB,EAAE,UAAC,CAAM,IAAK,OAAA,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,GAAA,CAAC,CAAC;YACjF,IAAI,KAAK,EAAE;gBACT,IAAM,SAAS,GAAG,cAAM,OAAA,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,GAAA,CAAC;gBAE9D,SAAS,EAAE,CAAC;aACb;SACF;QAED,IAAI,MAAc,CAAC;QACnB,IAAI,CAAC,MAAM,GAAG,cAAM,QAAC,MAAM,GAAG,MAAM,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,IAAC,CAAC;QAC1D,IAAI,CAAC,QAAQ,GAAG,UAAC,IAAS,IAAK,OAAA,KAAK,CAAC,WAAW,CAAC,IAAI,EAAE,IAAI,CAAC,GAAA,CAAC;QAC7D,IAAI,CAAC,OAAO,GAAG,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAC5C,IAAI,CAAC,MAAM,GAAG,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC1C,IAAI,CAAC,KAAK,GAAG,cAAc,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QACxC,IAAI,CAAC,MAAM,GAAG,cAAM,OAAA,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,GAAA,CAAC;QAChD,IAAI,CAAC,UAAU,GAAG,cAAM,OAAA,cAAc,CAAC,UAAU,CAAC,IAAI,CAAC,GAAA,CAAC;QACxD,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QACjC,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACnC,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7B,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QACvC,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7B,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QAErB,IAAI,CAAC,KAAK,GAAG,UAAC,SAAkC;YAAlC,0BAAA,EAAA,cAAmB,OAAO,EAAE,IAAI,EAAE;YAC9C,OAAA,IAAI,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC;SAAA,CAAC;QAC5D,IAAI,CAAC,QAAQ,GAAG,UAAC,SAAkC;YAAlC,0BAAA,EAAA,cAAmB,OAAO,EAAE,IAAI,EAAE;YACjD,OAAA,IAAI,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,IAAI,SAAS,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC;SAAA,CAAC;QAC9D,OAAO,IAAI,CAAC;IACd,CAAC;AAED,QAAa,IAAI,GAAG;QAClB,IAAI,MAAA;KACL;;IC1DD,wBAmLA;IA5KA,IAAMsE,UAAQ,GAAG1B,WAAW,CAAC;QAC3B,SAAS,EAAE,UAAC,EAIX;gBAHC,cAAyC,EAA/B,gBAAuB,EAAvB,4CAAuB,EAAE,cAAI;YAGnC,QAAC;gBACL,OAAO,EAAE,UAAC,KAAe,IAAK,OAAA,KAAK,CAAC,QAAQ,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAC,GAAA;aACpE;SAAC;KACH,CAAC,CAAC;IAEH,IAAM,gBAAgB,GAAG,UAAC,IAAY,EAAE,MAAY;QAClD,IAAI,CAAC,IAAI,EAAE;YACT,OAAO;gBACL,OAAO,EAAEpB,cAAK,CAACR,QAAQ,CAACS,gBAAO,CAAC,EAAE,CAAC,CAAC,CAAC;gBACrC,OAAO,EAAED,cAAK,CAACR,QAAQ,CAACS,gBAAO,CAAC,EAAE,CAAC,CAAC,CAAC;gBACrC,KAAK,EAAED,cAAK,CAACR,QAAQ,CAACS,gBAAO,CAAC,WAAW,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAC3D,GAAG,EAAED,cAAK,CAACR,QAAQ,CAACS,gBAAO,CAAC,EAAE,CAAC,CAAC,CAAC;aAClC,CAAC;SACH;QAED,IAAM,IAAI,GAAG,IAAI,YAAY,CAAC,IAAI,CAAC,CAAC;QACpC,IAAM,SAAS,GAAGD,cAAK,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,SAAO,IAAM,CAAC,CAAC;QAE5D,OAAO;YACL,OAAO,EAAE,UAAC,KAAe,IAAK,OAAA,cAAc,CAAC,KAAK,EAAE,IAAI,EAAE,MAAM,CAAC,GAAA;YACjE,OAAO,EAAEA,cAAK,CAAC,UAAA,KAAK,IAAI,OAAA,OAAO,CAAC,eAAe,CAAC,KAAK,EAAE,IAAI,CAAC,GAAA,EAAE,aAAW,IAAM,CAAC;YAChF,KAAK,EAAEA,cAAK,CAAC,UAAA,KAAK,IAAI,OAAA,OAAO,CAAC,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,GAAA,CAAC;YACxD,GAAG,EAAEA,cAAK,CAAC,UAAC,KAAK,EAAE,IAAS;gBAAT,qBAAA,EAAA,SAAS;gBAAK,OAAA,SAAS,CAAC,KAAK,EAAEoB,WAAW,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;aAAA,CAAC;SAC9E,CAAC;IACJ,CAAC,CAAC;IAEF,IAAM,cAAc,GAAG,UAAO,KAAe,EAAE,IAAY,EAAE,MAAY;;;;;oBACjE,KAAK,GAAG,gBAAgB,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;oBACvC,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC;wBAC1B,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC;wBAClB,KAAK,CAAC,GAAG,CAAC,KAAK,EAAE,EAAE,CAAC;wBACpB,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC;qBACH,CAAC,CAAC;oBAC2B,qBAAM,OAAO,EAAA;;oBAAzD,MAA4C,SAAa,CAAgC,EAAxF,IAAI,QAAA,EAAE,GAAG,QAAA;oBAEd,IAAI,CAAC,IAAI;wBAAE,IAAI,GAAG,WAAW,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;oBACvC,KAAK,GAAGrD,QAAQ,CAAC,EAAE,EAAE,CAAC,SAAS,EAAE,OAAO,EAAE,KAAK,CAAC,EAAE,IAAI,CAAC,CAAC;yBAC1D,KAAK,CAAC,MAAM,EAAZ,wBAAY;oBACd,qBAAM,OAAO,CAAC,GAAG,CACf,KAAK,CAAC,GAAG,CAAC,UAAC,EAAU;4BACnB,OAAA,KAAK,CAAC,eAAe,CAAC,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,SAAS,IAAI,MAAM,CAAC,SAAS,CAAC;yBAAA,CACrE,CACF,EAAA;;oBAJD,SAIC,CAAC;;wBAGJ,qBAAM,OAAO,CAAC,GAAG,CACf,GAAG,CAAC,GAAG,CAAC,UAAA,EAAE,IAAI,OAAA,KAAK,CAAC,eAAe,CAAC,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,SAAS,IAAI,MAAM,CAAC,SAAS,CAAC,GAAA,CAAC,CACpF,EAAA;;oBAFD,SAEC,CAAC;yBAEE,IAAI,CAAC,SAAS,EAAd,wBAAc;oBACV,QAAQ,GAAG,QAAM,IAAI,CAAC,SAAS,UAAO,CAAC;0BAEzC,QAAQ,KAAK,IAAI,CAAA,EAAjB,wBAAiB;oBAAE,qBAAM,cAAc,CAAC,KAAK,EAAE,QAAM,IAAI,CAAC,SAAS,UAAO,EAAE,EAAE,CAAC,EAAA;;oBAA5D,SAA4D,CAAC;;wBAGtF,sBAAO,KAAK,CAAC,QAAQ,EAAE,EAAC;;;SACzB,CAAC;IAEF,IAAM,OAAO,GAAG,UAAC,EAKX;QALW,mBAAA,EAAA,OAKX;QAJJ,IAAA,cAA2B,EAA3B,wCAA2B,EAC3B,kBAAqC,EAArC,8CAAqC,EACrC,YAAyB,EAAzB,wCAAyB,EACzB,mDAAO;QACE,qBACN,IAAI,IACP,SAAS,EAAE,UAAC,EAGX;oBAFC,cAAsF,EAA5E,cAAsB,EAAtB,2CAAsB,EAAE,kBAA8B,EAA9B,mDAA8B,EAAE,YAAkB,EAAlB,uCAAkB,EACpF,aAAuB,EAAvB,qCAAuB;gBACnB,OAAA,gBAAgB,CAAC,MAAI,MAAM,SAAI,UAAU,SAAI,IAAM,EAAE,WAAW,CAAC;aAAA,KACvE;KAAA,CAAC;IAEH,IAAM,aAAa,GAAG,UAAC,EAKjB;QALiB,mBAAA,EAAA,OAKjB;QAJJ,IAAA,cAA2B,EAA3B,AACA,kBAAqC,EAArC,AACA,YAA0B,EAA1B,yCAA0B,EAC1B,mDAAO;QACE,qBACN,IAAI,IACP,SAAS,EAAE,UAAC,EAAkD;oBAAtC,mBAAS,EAAT,8BAAS,EAAI,aAAuB,EAAvB,qCAAuB;gBAC1D,OAAA,gBAAgB,CACd,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC;oBACvC,OAAO,EAAE,IAAI;oBACb,IAAI,EAAES,QAAQ,CAAC,WAAW,EAAE,MAAM,EAAE,WAAW,CAAC;iBACjD,CAAC,EACFR,OAAO,CAAC,OAAO,EAAE,IAAI,EAAE,WAAW,CAAC,CACpC;aAAA,KACH;KAAA,CAAC;IAEH,IAAM,YAAY,GAAG,UAAC,EAKhB;QALgB,mBAAA,EAAA,OAKhB;QAJJ,IAAA,YAA6B,EAA7B,4CAA6B,EAC7B,gBAA8B,EAA9B,yCAA8B,EAC9B,YAA6B,EAA7B,4CAA6B,EAC7B,+CAAO;QACE,qBACN,IAAI,IACP,SAAS,EAAE,UAAC,EAGX;oBAFC,cAA8E,EAApE,gBAA0B,EAA1B,+CAA0B,EAAE,YAAkB,EAAlB,uCAAkB,EAAE,YAAkB,EAAlB,uCAAkB,EAC5E,aAAuB,EAAvB,qCAAuB;gBAEvB,OAAA,gBAAgB,CACd,WAAW,CAAC,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC;oBACrC,QAAQ,EAAE,QAAQ,IAAI,MAAM,CAAC,KAAK;oBAClC,IAAI,MAAA;oBACJ,IAAI,MAAA;iBACL,CAAC,EACF,WAAW,CACZ;aAAA,KACH;KAAA,CAAC;IAEH,IAAM,kBAAkB,GAAG,UAAC,EAK3B;QAJC,IAAA,YAA6B,EAA7B,4CAA6B,EAC7B,gBAA8B,EAA9B,yCAA8B,EAC9B,YAAyB,EAAzB,wCAAyB,EACzB,+CAAO;QACH,qBACD,IAAI,IACP,SAAS,EAAE,UAAC,EAGX;oBAFC,cAAyF,EAA/E,YAAS,EAAT,8BAAS,EAAE,gBAA0B,EAA1B,+CAA0B,EAAE,YAAkB,EAAlB,uCAAkB,EAAE,YAAkB,EAAlB,uCAAkB,EACvF,aAAuB,EAAvB,qCAAuB;gBAEvB,IAAM,SAAS,GAAG,WAAW,CAAC,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC;oBACvD,QAAQ,EAAE,QAAQ,IAAI,MAAM,CAAC,KAAK;oBAClC,IAAI,MAAA;oBACJ,IAAI,MAAA;iBACL,CAAC,CAAC;gBACH,IAAM,WAAW,GAAG,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC;oBAC3D,OAAO,EAAE,IAAI;oBACb,IAAI,MAAA;iBACL,CAAC,CAAC;gBAEH,IAAM,IAAI,GAAG,IAAI,YAAY,CAAC,WAAW,CAAC,CAAC;gBAC3C,IAAM,QAAQ,GAAGgC,cAAK,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,SAAO,WAAa,CAAC,CAAC;gBAElE,OAAO;oBACL,KAAK,EAAEA,cAAK,CACV,UAAA,KAAK,IAAI,OAAA,OAAO,CAAC,YAAY,CAAC,KAAK,EAAE,SAAS,EAAE,WAAW,CAAC,GAAA,EAC5D,UAAQ,SAAW,CACpB;oBACD,GAAG,EAAE,QAAQ;oBACb,OAAO,EAAEA,cAAK,CAAC,UAAA,KAAK,IAAI,OAAA,cAAc,CAAC,KAAK,EAAE,WAAW,EAAE,WAAW,CAAC,GAAA,CAAC;iBACzE,CAAC;aACH,KACD;KAAA,CAAC;IAEH,IAAM,OAAO,GAAG,UAAC,EAA2E;QAA3E,mBAAA,EAAA,OAA2E;QAAzE,IAAA,YAAyB,EAAzB,wCAAyB,EAAE,YAA8B,EAA9B,6CAA8B,EAAE,mCAAO;QAAY,qBAC5F,IAAI,IACP,SAAS,EAAE,UAAC,EAAiF;oBAA/E,cAAiE,EAAvD,gBAAa,EAAb,kCAAa,EAAE,YAAkB,EAAlB,uCAAkB,EAAE,YAAkB,EAAlB,uCAAkB,EAAI,aAAU,EAAV,+BAAU;gBACzF,OAAA,gBAAgB,CAAC,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,QAAQ,UAAA,EAAE,IAAI,MAAA,EAAE,IAAI,MAAA,EAAE,CAAC,EAAE,KAAK,CAAC;aAAA,KAC7F;KAAA,CAAC;IAEH,IAAM,KAAK,GAAG,UAAC,EAA2E;QAA3E,mBAAA,EAAA,OAA2E;QAAzE,IAAA,YAAyB,EAAzB,wCAAyB,EAAE,YAA8B,EAA9B,6CAA8B,EAAE,mCAAO;QAAY,qBAC1F,IAAI,IACP,SAAS,EAAE,UAAC,EAAiF;oBAA/E,gBAAa,EAAb,kCAAa,EAAE,cAAkD,EAAxC,YAAkB,EAAlB,uCAAkB,EAAE,YAAkB,EAAlB,uCAAkB,EAAI,aAAU,EAAV,+BAAU;gBACzF,OAAA,gBAAgB,CAAC,WAAW,CAAC,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,QAAQ,UAAA,EAAE,IAAI,MAAA,EAAE,IAAI,MAAA,EAAE,CAAC,EAAE,KAAK,CAAC;aAAA,KAC3F;KAAA,CAAC;AAEH,QAAa,IAAI,GAAG;QAClB,gBAAgB,kBAAA;QAChB,cAAc,gBAAA;QACd,QAAQ,YAAA;QACR,aAAa,eAAA;QACb,OAAO,SAAA;QACP,YAAY,cAAA;QACZ,kBAAkB,oBAAA;QAClB,OAAO,SAAA;QACP,KAAK,OAAA;KACN;;ACpKD,sBAAe,IAAI,CAAC,IAAI,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;"}